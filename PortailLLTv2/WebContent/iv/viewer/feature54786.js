actuate.util.Package.define("actuate.iv.ui.dialog.style");actuate.iv.ui.dialog.style.IVFormattingRule=function(N,U){this.styleModel=new actuate.iv.ui.dialog.StyleModel();this.conditionModel=new actuate.iv.ui.dialog.ConditionModel();this.manager=N;this.ruleNumber=U;this.ruleBlock=document.getElementById(arguments[2]);this.deleteRuleButton=document.getElementById(arguments[3]);this.columnName=document.getElementById(arguments[4]);var A=arguments[5];var C=arguments[6];var Q=arguments[7];var I=arguments[8];var M=arguments[9];var K=arguments[10];var T=arguments[11];var B=arguments[12];var R=arguments[13];var E=arguments[14];var P=arguments[15];var F=arguments[16];var J=arguments[17];var D=arguments[18];var S=arguments[19];var G=arguments[20];var L=arguments[21];var O=arguments[22];this.conditionSelectionView=new actuate.iv.ui.dialog.ConditionSelectionView(Q,I,M,K,S,G,L,O);this.stylePreviewView=new actuate.iv.ui.dialog.StylePreviewView(C);actuate.util.Event.observe(this.deleteRuleButton,"click",actuate.Method.bind(this.__neh_deleteRule,this),false);Q.registerEventHandler("select",actuate.Method.bind(this.__neh_conditionColumnChange,this));I.registerEventHandler("select",actuate.Method.bind(this.__neh_operatorChange,this));actuate.util.Event.observe(document.getElementById(D),"click",actuate.Method.bind(this.__neh_formatClick,this),false);actuate.util.Event.observe(document.getElementById(S),"click",actuate.Method.bind(this.__neh_value1Click,this),false);actuate.util.Event.observe(document.getElementById(G),"click",actuate.Method.bind(this.__neh_value2Click,this),false);var H=actuate.Method.bindAsEventListener(this.manager.__neh_keyup,this);};actuate.iv.ui.dialog.style.IVFormattingRule.prototype={setData:function(E){var B=E.condition.operands;var A=[];for(var C=0;C<B.length;C++){if(B[C].dataField){A[C]="["+B[C].dataField+"]";}else{A[C]=B[C].literal;}}while(A.length<2){A.push(null);}var D=actuate.util.Utility.getLocalizedString("conditionFormatDialog.text.nullValue");this.conditionModel.setValues(E.condition.row,E.condition.operator,A[0]==null?D:A[0],A[1]==null?D:A[1]);this.conditionSelectionView.setValues(this.conditionModel.getConditionColumnValue(),this.conditionModel.getOperator(),this.conditionModel.getValue1(),this.conditionModel.getValue2());this.conditionModel.setNumberOfParams(this.conditionSelectionView.getNumberOfParams());this.styleModel.setFont(E.effect);this.stylePreviewView.showPreview(this.styleModel);this.manager.ruleChange();},setBoundDataColumns:function(B,A){this.conditionModel.setDefaultBoundDataColumn(A);this.conditionSelectionView.setConditionColumnOptions(B);this.__neh_conditionColumnChange();},reset:function(){this.styleModel.reset();this.conditionModel.reset();this.conditionSelectionView.reset(this.conditionModel);this.conditionSelectionView.showOprandBoxes(false,false);this.stylePreviewView.showPreview(this.styleModel);},resetWithOperator:function(){this.conditionModel.reset();this.conditionModel.setConditionColumnValue(this.conditionSelectionView.getConditionColumnValue());this.conditionModel.setDataType(this.conditionSelectionView.getConditionColumnDataType());this.conditionModel.setOperatorByDataType();this.conditionSelectionView.reset(this.conditionModel);this.styleModel.reset();this.stylePreviewView.showPreview(this.styleModel);this.manager.ruleChange();},clearStyleModelRollbackState:function(){this.styleModel.clearRollbackState();},rollbackStyleModel:function(){this.styleModel.rollback();this.updatePreview();},updatePreview:function(){this.stylePreviewView.showPreview(this.styleModel);this.manager.ruleChange();},show:function(){this.ruleBlock.style.display="block";this.isVisible=true;},hide:function(){this.ruleBlock.style.display="none";this.isVisible=false;},moveToEnd:function(){this.ruleBlock.parentNode.appendChild(this.ruleBlock);},__neh_deleteRule:function(A){this.manager.deleteRule(this.ruleNumber);},__neh_formatClick:function(){this.styleModel.setRollbackState();this.manager.requestFormatDialog(this.styleModel);},__neh_value1Click:function(){this.inputSelectionNum=1;this.conditionModel.setValue1(this.conditionSelectionView.getValue1Value());this.conditionModel.setDataType(this.conditionSelectionView.getConditionColumnDataType());var A=this.conditionModel.getValue1();var B=this.getSetValueFunction(1);this.handleValueClick(A,B);},__neh_value2Click:function(){this.inputSelectionNum=2;this.conditionModel.setValue2(this.conditionSelectionView.getValue2Value());this.conditionModel.setDataType(this.conditionSelectionView.getConditionColumnDataType());var A=this.conditionModel.getValue2();var B=this.getSetValueFunction(2);this.handleValueClick(A,B);},getSetValueFunction:function(A){var B=this.conditionModel;var C=this.conditionSelectionView;if(A==2){return{setValues:function(D){B.setValue2(D);C.setValue2Value(B.getValue2());this.setValues=null;}};}else{return{setValues:function(D){B.setValue1(D);C.setValue1Value(B.getValue1());this.setValues=null;}};}},handleValueClick:function(A,E){var D=this.conditionModel.getConditionColumnValue();var B=this.conditionModel.getDataType();var C=this.conditionModel.getOperator();this.manager.requestValueDialog(D,A,B,E,C);},__neh_operatorChange:function(){this.conditionModel.setOperator(this.conditionSelectionView.getOperatorValue());this.conditionModel.setNumberOfParams(this.conditionSelectionView.getNumberOfParams());this.handleOperatorChange();},beforeApply:function(){this.conditionModel.setValue1(this.conditionSelectionView.getValue1Value());this.conditionModel.setValue2(this.conditionSelectionView.getValue2Value());},handleOperatorChange:function(){this.conditionModel.setValue1(this.conditionSelectionView.getValue1Value());this.conditionModel.setValue2(this.conditionSelectionView.getValue2Value());this.conditionModel.setUnusedEntryValuesToDefault();this.conditionSelectionView.resetValues(this.conditionModel.getValue1(),this.conditionModel.getValue2());this.conditionSelectionView.showOprandBoxes();this.manager.ruleChange();},__neh_conditionColumnChange:function(){this.handleConditionColumnChange();},handleConditionColumnChange:function(){this.conditionModel.reset();this.conditionModel.setConditionColumnValue(this.conditionSelectionView.getConditionColumnValue());this.conditionModel.setDataType(this.conditionSelectionView.getConditionColumnDataType());this.conditionModel.setOperatorByDataType();this.conditionSelectionView.setValues(this.conditionModel.getConditionColumnValue(),this.conditionModel.getOperator(),this.conditionModel.getValue1(),this.conditionModel.getValue2());this.manager.ruleChange();},isRuleConditionSet:function(){var B=this.conditionModel.getOperator();if(B!=""){var A=this.conditionModel.getNumberOfParams();var C=false;switch(A){case 2:if(this.conditionModel.getValue2()==""){break;}case 1:if(this.conditionModel.getValue1()==""){break;}case 0:C=true;}}return C;},isValid:function(){return this.conditionModel.isValid();},isRuleEmpty:function(){return this.conditionModel.isDefault()&&this.styleModel.isDefault();},conditionEquals:function(A){return this.conditionModel.getConditionColumnValue()==A.conditionModel.getConditionColumnValue()&&this.conditionModel.getOperator()==A.conditionModel.getOperator()&&this.conditionModel.getValue1()==A.conditionModel.getValue1()&&this.conditionModel.getValue2()==A.conditionModel.getValue2();},createEmptyColDefNode:function(C){var B=actuate.util.XmlDom.createElement(C,actuate.Constant.tag.ColumnDef);var A=actuate.util.XmlDom.createElement(C,actuate.Constant.tag.Index);var D=C.createTextNode(this.manager.getColumnIndex());A.appendChild(D);B.appendChild(A);return B;},createColumnDefNode:function(H){var O=actuate.util.XmlDom.createElement(H,actuate.Constant.tag.ColumnDef);var B=actuate.util.XmlDom.createElement(H,actuate.Constant.tag.Index);var E=H.createTextNode(this.manager.getColumnIndex());B.appendChild(E);O.appendChild(B);var I=actuate.util.XmlDom.createElement(H,actuate.Constant.tag.FormatRuleSet);O.appendChild(I);var L=actuate.util.XmlDom.createElement(H,actuate.Constant.tag.FormatRule);I.appendChild(L);var N=actuate.util.XmlDom.createElement(H,actuate.Constant.tag.FormatRuleCondition);var M=actuate.util.XmlDom.createElement(H,actuate.Constant.tag.FormatRuleEffect);L.appendChild(N);L.appendChild(M);var C,E;if(!this.conditionModel.isDefaultOperator()){C=actuate.util.XmlDom.createElement(H,actuate.Constant.tag.ColumnName);N.appendChild(C);var A=actuate.util.XmlDom.createElement(H,actuate.Constant.tag.NAME);C.appendChild(A);E=H.createTextNode(this.conditionModel.getConditionColumnValue());A.appendChild(E);}if(this.conditionModel.getOperator()!=this.conditionModel.operatorDefault){C=actuate.util.XmlDom.createElement(H,actuate.Constant.tag.FilterOp);var D=this.conditionModel.getOperator();if(D==actuate.Constant.DesignChoice.FILTER_OPERATOR_EQ&&this.conditionModel.getValue1()==""&&this.conditionModel.getDataType()==actuate.Constant.DataType.STRING){D=actuate.Constant.DesignChoice.FILTER_OPERATOR_NULL;this.conditionModel.setOperator("is-null");this.conditionModel.setNumberOfParams(0);this.handleOperatorChange();}else{if(D==actuate.Constant.DesignChoice.FILTER_OPERATOR_NE&&this.conditionModel.getValue1()==""&&this.conditionModel.getDataType()==actuate.Constant.DataType.STRING){D=actuate.Constant.DesignChoice.FILTER_OPERATOR_NOT_NULL;this.conditionModel.setOperator("not-null");this.conditionModel.setNumberOfParams(0);this.handleOperatorChange();}}E=H.createTextNode(D);C.appendChild(E);N.appendChild(C);}var J=this.conditionModel.getConditionColumnValue();var K=[this.conditionModel.getValue1(),this.conditionModel.getValue2()];var G=this.conditionModel.getNumberOfParams();for(var F=0;F<G;F++){this.createFilterOperand(H,N,K[F],J);}if(this.styleModel.getFontFamily()!=this.styleModel.fontFamilyDefault){C=actuate.util.XmlDom.createElement(H,actuate.Constant.tag.FAMILY);E=H.createTextNode(this.styleModel.getFontFamily());C.appendChild(E);M.appendChild(C);}if(this.styleModel.getFontSize()!=this.styleModel.fontSizeDefault){C=actuate.util.XmlDom.createElement(H,actuate.Constant.tag.SIZE);if(this.styleModel.getFontSize().toLowerCase()=="auto"){E=H.createTextNode(this.styleModel.getFontSize());}else{E=H.createTextNode(this.styleModel.getFontSize()+this.styleModel.getFontSizeUnit());}C.appendChild(E);M.appendChild(C);}if(this.styleModel.getColor()!=this.styleModel.colorDefault){C=actuate.util.XmlDom.createElement(H,actuate.Constant.tag.Color);E=H.createTextNode(this.styleModel.getColor());C.appendChild(E);M.appendChild(C);}if(this.styleModel.getBackgroundColor()!=this.styleModel.backgroundColorDefault){C=actuate.util.XmlDom.createElement(H,actuate.Constant.tag.BackgroundColor);E=H.createTextNode(this.styleModel.getBackgroundColor());C.appendChild(E);M.appendChild(C);}C=actuate.util.XmlDom.createElement(H,actuate.Constant.tag.Bold);E=H.createTextNode(this.styleModel.getIsBold()+"");C.appendChild(E);M.appendChild(C);C=actuate.util.XmlDom.createElement(H,actuate.Constant.tag.Italic);E=H.createTextNode(this.styleModel.getIsItalic()+"");C.appendChild(E);M.appendChild(C);C=actuate.util.XmlDom.createElement(H,actuate.Constant.tag.Underline);E=H.createTextNode(this.styleModel.getIsUnderline()+"");C.appendChild(E);M.appendChild(C);return(O);},createFilterOperand:function(H,K,J,D){var I=this.manager.isUseAsBinding(J,D);var C,F;if(I){C=actuate.util.XmlDom.createElement(H,actuate.Constant.tag.FilterOperand);K.appendChild(C);var G=actuate.util.XmlDom.createElement(H,actuate.Constant.tag.DataField);C.appendChild(G);var B=actuate.util.XmlDom.createElement(H,actuate.Constant.tag.NAME);G.appendChild(B);var E=this.manager.formatLiteralAsBindingName(J);F=H.createTextNode(E);B.appendChild(F);}else{C=actuate.util.XmlDom.createElement(H,actuate.Constant.tag.FilterOperand);K.appendChild(C);var A=actuate.util.XmlDom.createElement(H,actuate.Constant.tag.LITERAL);C.appendChild(A);if(actuate.util.Utility.isArray(J)){J=actuate.util.Json.makeArray(J);}F=H.createTextNode(J);A.appendChild(F);}},stripWhitespace:function(B){var A=B.replace(/\s/g,"");return A;},getOperatorText:function(){return this.conditionSelectionView.getOperatorText();}};