actuate.util.Package.define("actuate.iv.ui.dialog.exportReport");actuate.iv.ui.dialog.exportReport.IVExportReportDialog=actuate.Class.create();actuate.iv.ui.dialog.exportReport.IVExportReportDialog.prototype=actuate.Class.extend(new actuate.iv.ui.dialog.AbstractIVDialog(),{_classname:"actuate.iv.ui.dialog.exportReport.IVExportReportDialog",_htmlElements:{"_ExportReportFormat":null,"_ExportReportPageStyle":null},_renderOptionGroups:[],_formatStores:{},_choice:null,_defaultChoice:null,_bookmark:null,_width:(actuate.util.browser&&(actuate.util.browser.isIPhone||actuate.util.browser.isIPod||actuate.util.browser.isAndroidPhone))?310:350,_bindData:null,initialize:function(){var A=this._getId(this._classname);this._applyHtmlElementsNames(A);actuate.iv.ui.dialog.AbstractIVDialog.prototype.initialize.call(this,A);this._idExportFormatSelect=new actuate.uiadapter.ComboBox({editable:false,width:165,modal:true});this._idExportFormatSelect.render(document.getElementById(this._htmlElements["_ExportReportFormat"]));this._initTemplates();this._eh_ExportFormatClick_c=actuate.Method.bind(this._eh_ExportFormatClick,this);this._idExportFormatSelect.registerEventHandler("select",this._eh_ExportFormatClick_c);this._choice=null;this._defaultChoice=null;},_bind:function(F){this._bindData=F;if(!F||!F.exportReportOptions||F.exportReportOptions.length<=0){return ;}var I=F.exportReportOptions;var A=new Array();var O=new Array();var N=new Array();var K=actuate.util.browser&&actuate.util.browser.useMobile();var J=0;for(var G=0;G<I.length;G++){var B=I[G].outputFormat;if(B!="CSV"&&B!="PSV"&&B!="TSV"){if(!K){if(B.toUpperCase()=="DOC"){A[J]=actuate.util.Utility.getLocalizedString("exportReportDialog.text.exportReportWordDOC");O[A[J]]=B;N[A[J]]=I[G];J++;}else{if(B.toUpperCase()=="XLSX"){A[J]=actuate.util.Utility.getLocalizedString("exportReportDialog.text.exportReportExcelXLSX");O[A[J]]=B;N[A[J]]=I[G];J++;}else{if(B.toUpperCase()=="PPT"){A[J]=actuate.util.Utility.getLocalizedString("exportReportDialog.text.exportReportPowerpoint");O[A[J]]=B;N[A[J]]=I[G];J++;}else{if(B.toUpperCase()=="PS"){A[J]=actuate.util.Utility.getLocalizedString("exportReportDialog.text.exportReportPostscript");O[A[J]]=B;N[A[J]]=I[G];J++;}else{if(B.toUpperCase()=="DOCX"){A[J]=actuate.util.Utility.getLocalizedString("exportReportDialog.text.exportReportDOCX");O[A[J]]=B;N[A[J]]=I[G];J++;}else{if(B.toUpperCase()=="PPTX"){A[J]=actuate.util.Utility.getLocalizedString("exportReportDialog.text.exportReportPPTX");O[A[J]]=B;N[A[J]]=I[G];J++;}else{if(B.toUpperCase()=="AFP"){A[J]=actuate.util.Utility.getLocalizedString("exportReportDialog.text.exportReportAFP");O[A[J]]=B;N[A[J]]=I[G];J++;}else{if(B.toUpperCase()=="PDF"){A[J]=actuate.util.Utility.getLocalizedString("exportReportDialog.text.exportReportPDF");O[A[J]]=B;N[A[J]]=I[G];J++;}else{if(B.toUpperCase()=="XLS"){A[J]=actuate.util.Utility.getLocalizedString("exportReportDialog.text.exportReportExcelXLS");O[A[J]]=B;N[A[J]]=I[G];J++;}else{if(B.toUpperCase()=="XHTML"){A[J]=B.toUpperCase();O[A[J]]=B;N[A[J]]=I[G];J++;}else{A[J]=B.toUpperCase();O[A[J]]=B;N[A[J]]=I[G];J++;}}}}}}}}}}}else{if(B.toUpperCase()=="PDF"){A[J]=actuate.util.Utility.getLocalizedString("exportReportDialog.text.exportReportPDF");O[A[J]]=B;N[A[J]]=I[G];J++;}else{if(B.toUpperCase()=="XLS"){A[J]=actuate.util.Utility.getLocalizedString("exportReportDialog.text.exportReportExcelXLS");O[A[J]]=B;N[A[J]]=I[G];J++;}}}}}A.sort();for(var G=0;G<A.length;G++){this._renderOptionGroups[G]=new actuate.iv.ui.dialog.exportReport.IVRenderOptionGroup(this._instance,O[A[G]],A[G],N[A[G]],this._idPageStyleInfo);}for(var G=0;G<this._renderOptionGroups.length;G++){var L=this._renderOptionGroups[G].getFormatName();if(L.toUpperCase()=="XLS"||L.toUpperCase()=="XLSX"){if(this._renderOptionGroups[G].renderOptionsList[2]){var H=this._renderOptionGroups[G].renderOptionsList[2]._checkboxInstance;if(H){H.registerEventHandler("check",this._eh_EnablePivotTableCheckboxClick);}}}var D=this._renderOptionGroups[G].getRenderOptions();for(var C=0;C<D.length;C++){D[C].setDefaultValue();}}this._bookmark=F.bookmark;this._formatStores.all=[];this._formatStores.FlashCharts=[];this._formatStores.FlashGadgets=[];this._formatStores.GeneralFlash=[];this._formatStores.Html5Gadgets=[];for(var G=0;G<A.length;G++){var M=A[G];this._formatStores.all.push([O[M],M]);if(M=="PDF"){this._formatStores.FlashCharts.push([O[M],M]);this._formatStores.FlashGadgets.push([O[M],M]);this._formatStores.GeneralFlash.push([O[M],M]);}}var E=this._formatStores[this._elementType]||this._formatStores.all;if("FlashGadgets"==this._elementType){if(this._isHtml5Gadgets()){E=this._formatStores.all;}}this._idExportFormatSelect.setStore(E);for(var G=0;G<E.length;G++){if(E[G][0]==F.defaultFormat){this._defaultChoice=G;break;}}this._idExportFormatSelect.setSelectedIndex(this._defaultChoice);this._defaultSettings(F.defaultFormat);},_isHtml5Gadgets:function(){var A=this._viewer.apiInstance.getCurrentPageContent();var C=A.getGadgetByBookmark(this._viewer.eventDispatcher.focusId);if(C){var D=C.getHtmlDom();if(D){var B=D.getElementsByTagName("OBJECT");if(B&&B.length>0){return false;}else{return true;}}}return false;},_eh_EnablePivotTableCheckboxClick:function(){var A=this._renderOptionGroups[this._choice].renderOptionsList[2]._checkboxInstance;var B=this._renderOptionGroups[this._choice].renderOptionsList[3]._checkboxInstance;if(actuate.util.Utility.isIE&&!actuate.util.Utility.isIE9){if(!A.isChecked()){B.setValue(true);B.enable();}else{B.setValue(false);B.disable();}}else{if(!A.isChecked()){B.setValue(false);B.disable();}else{B.setValue(true);B.enable();}}},_localBind:function(C){this._bind(this._bindData);this._bookmark=C.bookmark;var B=this._formatStores[C.type]||this._formatStores.all;if("FlashGadgets"==C.type){if(this._isHtml5Gadgets()){B=this._formatStores.all;}}this._idExportFormatSelect.setStore(B);for(var A=0;A<B.length;A++){if(B[A][0]==C.defaultFormat){this._defaultChoice=A;break;}}this._idExportFormatSelect.setSelectedIndex(this._defaultChoice);this._defaultSettings(C.defaultFormat);},_initTemplates:function(){this._idPageStyleInfo=document.createElement("div");var A=new actuate.uiadapter.FieldSet({collapsible:true,collapsed:true,title:actuate.util.Utility.getLocalizedString("exportReportDialog.text.pageSetting"),autoHeight:true,defaultType:"textfield",contentEl:this._idPageStyleInfo});A.render(this._htmlElements["_ExportReportPageStyle"]);var B=actuate.Method.bind(this.adjustSize,this);A.registerEventHandler("collapse",B);A.registerEventHandler("expand",B);},_eh_ExportFormatClick:function(){if(this._elementType=="FlashCharts"){this._choice=3;}else{this._choice=this._idExportFormatSelect.getSelectedIndex();}for(var A=0;A<this._renderOptionGroups.length;A++){if(A==this._choice){this._renderOptionGroups[A].disableGroupRenderOptions(false,this._bookmark);}else{this._renderOptionGroups[A].disableGroupRenderOptions(true,this._bookmark);}}if(this._idExportFormatSelect.getValue().toUpperCase()==="XLS"||this._idExportFormatSelect.getValue().toUpperCase()==="XLSX"){if(this._renderOptionGroups[this._choice].renderOptionsList[2]){var B=this._renderOptionGroups[this._choice].renderOptionsList[2]._checkboxInstance;var D=this._renderOptionGroups[this._choice].renderOptionsList[3]._checkboxInstance;function C(E){if(!B.isChecked()){D.setValue(false);D.disable();}else{D.setValue(true);D.enable();}}B.registerEventHandler("check",C);}}this.adjustSize();},_defaultSettings:function(C){for(var B=0;B<this._renderOptionGroups.length;B++){var A=this._renderOptionGroups[B];if(A.getFormatName()==C){A.disableGroupRenderOptions(false,this._bookmark);this._choice=B;}else{A.disableGroupRenderOptions(true,this._bookmark);}}},_okPress:function(){var F=this._renderOptionGroups[this._choice].getObjectArray();var D=this._viewer?this._viewer.totalPage:0;var C=0;F.push({name:"format",value:this._idExportFormatSelect.getValue()});if(this._bookmark){F.push({name:"bookmark",value:this._bookmark});}for(var E=0;E<F.length;E++){if(F[E].name.indexOf("PageRange")>-1){var B=F[E].value;var A=null;if(B.indexOf(",")>-1){A=B.split(",");}else{A=new Array(1);if(B!=""){A[0]=B;}else{A[0]="1-"+this._viewer.totalPage;F[E].value=A[0];}}for(var E=0;E<A.length;E++){if(A[E]!=null){A[E]=A[E].replace(/^\s*|\s*$/g,"");}var G=this._validatePageNumbers(A[E]);if(G!="valid"){this._viewer.eventDispatcher.broadcastEvent(actuate.iv.core.iVEvent.__E_WARN,G);return false;}}C=Math.max(C,this._getMaxPage(A));}}if(this._bindData&&this._bindData.pageLimit>0&&C>this._bindData.pageLimit&&D>this._bindData.pageLimit){this._popupConfirmDialog(actuate.util.Utility.getLocalizedString("exportReportDialog.warning.pageLimit",this._bindData.pageLimit),actuate.Method.createDelegate(function(H){if(H=="yes"){this._viewer.eventDispatcher.broadcastEvent(actuate.iv.core.iVEvent.__E_APPLY_EXPORTREPORT,F);this._hide();}},this));}else{this._viewer.eventDispatcher.broadcastEvent(actuate.iv.core.iVEvent.__E_APPLY_EXPORTREPORT,F);this._hide();}this._hideSelectPanel();},_cancelPress:function(){this._hideSelectPanel();},_hideSelectPanel:function(){var A=actuate.util.browser&&actuate.util.browser.useMobile();if(A){this._idExportFormatSelect.hide();}},_afterHide:function(){this._renderOptionGroups[this._choice].disableGroupRenderOptions(true);},__getHelpTopic:function(){return"iv_exportreport";},getRenderOption:function(){return this._renderOptionGroups;},_validatePageNumbers:function(B){var C=this._viewer.totalPage;var A=null;var F=false;var G="valid";if(B.indexOf("-")>-1){A=B.split("-");if(A.length>2){G=actuate.util.Utility.getLocalizedString("error.printDialog.oneDashInRange");return G;}F=true;}else{A=new Array(1);A[0]=B;}for(var D=0;D<A.length;D++){if(A[D]!=null){A[D]=A[D].replace(/^\s*|\s*$/g,"");}if(!isFinite(A[D]*1)||Math.floor(A[D])!=A[D]||A[D].indexOf(".")!=-1){G=actuate.util.Utility.getLocalizedString("error.printDialog.pageNumberPositiveInteger");return G;}else{if(A[D]*1<1*1||A[D]*1>C*1){var E=actuate.util.Utility.getLocalizedString("error.printDialog.invalidPageRange");C=(new String(C)).replace(/^\s*|\s*$/g,"");E=E.replace("{variable1}",1);E=E.replace("{variable2}",C);return E;}}}if(F){if(A[0]*1>A[1]*1){G=actuate.util.Utility.getLocalizedString("error.printDialog.reversePageRange")+" ("+B+")";return G;}}return G;},_getMaxPage:function(B){var E=0;if(B!=null&&B.length>0){for(var D=0;D<B.length;D++){if(B[D].indexOf("-")>-1){var A=B[D].split("-");for(var C=0;C<A.length;C++){if(A[C]){var F;try{F=parseInt(actuate.util.String.trim(A[C]),10);}catch(G){continue;}E=Math.max(E,F);}}}else{if(B[D]){try{E=Math.max(E,parseInt(actuate.util.String.trim(B[D]),10));}catch(G){continue;}}}}}return E;}});