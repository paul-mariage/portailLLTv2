actuate.util.Package.define("actuate.iv.ui.dialog.style");actuate.iv.ui.dialog.style.IVConditionalFormattingDialog=actuate.Class.create();actuate.iv.ui.dialog.style.IVConditionalFormattingDialog.prototype=actuate.Class.extend(new actuate.iv.ui.dialog.AbstractIVDialog(),{_classname:"actuate.iv.ui.dialog.style.IVConditionalFormattingDialog",_width:437,_htmlElements:{"_buttonAddRule":null},_selectControlsArray:null,_ids:{},initialize:function(){this._generateConstants();var B=this._getId(this._classname);this._applyHtmlElementsNames(B);actuate.iv.ui.dialog.AbstractIVDialog.prototype.initialize.call(this,B);this.maxNumRules=3;this.numRulesShown=0;this.ruleBlocks=[];this._selectControlsArray=new Array();var H=0;for(var G=1;G<this.maxNumRules+1;G++){var F=document.getElementById(this._ids["r"+G].conditionColumn);var E=new actuate.uiadapter.ComboBox({editable:false,width:200});E.render(F);this._selectControlsArray[H]=E;H=H+1;var D=document.getElementById(this._ids["r"+G].operator);var C=new actuate.uiadapter.ComboBox({editable:false,width:200});C.render(D);this._selectControlsArray[H]=C;var I=actuate.Class.extendClass(actuate.uiadapter.TextField,{getValue:function(){if(!this._isMobile){if(actuate.util.Utility.isArray(this.textfield.value)){return this.textfield.value;}}return this.textfield.getValue();}});var K=new I({cls:"value "+actuate.iv.constant.CSS_INPUTBOX});var J=new actuate.uiadapter.TextField({cls:"value "+actuate.iv.constant.CSS_INPUTBOX});K.render(document.getElementById(this._ids["r"+G].value1));J.render(document.getElementById(this._ids["r"+G].value2));H=H+1;var A=new actuate.iv.ui.dialog.style.IVFormattingRule(this,(G-1),this._ids["r"+G].ruleBlock,this._ids["r"+G].deleteRule,this._ids["r"+G].columnMenu,this._ids["r"+G].previewBox,this._ids["r"+G].previewText,E,C,K,J,this._ids["r"+G].font,this._ids["r"+G].size,this._ids["r"+G].color,this._ids["r"+G].backgroundColor,this._ids["r"+G].bold,this._ids["r"+G].italic,this._ids["r"+G].underline,this._ids["r"+G].formatBtn,this._ids["r"+G].changeValueBtn1,this._ids["r"+G].changeValueBtn2,this._ids["r"+G].value1Label,this._ids["r"+G].value2Label);this.ruleBlocks.push(A);}this.selectBoxesFocused=false;this.buttonAddRule=document.getElementById(this._htmlElements["_buttonAddRule"]);this.enableAddRuleButton(false);this.__neh_buttonAddRule_c=actuate.Method.bind(this.__neh_buttonAddRule,this);actuate.util.Event.observe(this.buttonAddRule,"click",this.__neh_buttonAddRule_c,false);this.updateFontPreview_c=actuate.Method.bind(this.updateFontPreview,this);this.revertFontSettings_c=actuate.Method.bind(this.revertFontSettings,this);},_generateConstants:function(){for(var A=1;A<=3;A++){this._ids["r"+A]={};this._ids["r"+A].ruleBlock="conditionFormatDialog_id_r"+A+"_ruleBlock";this._ids["r"+A].deleteRule="conditionFormatDialog_id_r"+A+"_deleteRule";this._ids["r"+A].columnMenu="conditionFormatDialog_id_r"+A+"_columnMenu";this._ids["r"+A].previewBox="conditionFormatDialog_id_r"+A+"_previewBox";this._ids["r"+A].previewText="conditionFormatDialog_id_r"+A+"_previewText";this._ids["r"+A].conditionColumn="conditionFormatDialog_id_r"+A+"_conditionColumn";this._ids["r"+A].operator="conditionFormatDialog_id_r"+A+"_operator";this._ids["r"+A].value1="conditionFormatDialog_id_r"+A+"_value1";this._ids["r"+A].value2GUI="conditionFormatDialog_id_r"+A+"_value2GUI";this._ids["r"+A].value2="conditionFormatDialog_id_r"+A+"_value2";this._ids["r"+A].font="conditionFormatDialog_id_r"+A+"_font";this._ids["r"+A].size="conditionFormatDialog_id_r"+A+"_size";this._ids["r"+A].color="conditionFormatDialog_id_r"+A+"_color";this._ids["r"+A].backgroundColor="conditionFormatDialog_id_r"+A+"_backgroundColor";this._ids["r"+A].bold="conditionFormatDialog_id_r"+A+"_bold";this._ids["r"+A].italic="conditionFormatDialog_id_r"+A+"_italic";this._ids["r"+A].underline="conditionFormatDialog_id_r"+A+"_underline";this._ids["r"+A].formatBtn="conditionFormatDialog_id_r"+A+"_formatBtn";this._ids["r"+A].changeValueBtn1="conditionFormatDialog_id_r"+A+"_changeValueBtn1";this._ids["r"+A].changeValueBtn2="conditionFormatDialog_id_r"+A+"_changeValueBtn2";this._ids["r"+A].value1Label="conditionFormatDialog_id_r"+A+"_value1Label";this._ids["r"+A].value2Label="conditionFormatDialog_id_r"+A+"_value2Label";}},ruleChange:function(){this.setAddRuleButton();this.handleDialogResize();},__neh_buttonAddRule:function(A){actuate.util.Event.stop(A);if(this.buttonAddRule.className=="iv_dialog_link_enabled"){this.showNextRule();}},setAddRuleButton:function(){if(this.numRulesShown==this.maxNumRules){this.enableAddRuleButton(false);return ;}for(var A=0;A<this.numRulesShown;A++){if(this.ruleBlocks[A].isRuleEmpty()){this.enableAddRuleButton(false);return ;}}if(this.numRulesShown>0){this.enableAddRuleButton(true);}},showNextRule:function(){if(this.numRulesShown==this.maxNumRules){return ;}this.ruleBlocks[this.numRulesShown].show();this.ruleBlocks[this.numRulesShown].resetWithOperator();this.numRulesShown++;this.setAddRuleButton();this.handleDialogResize();},deleteRule:function(D){if(this.numRulesShown==1){this.ruleBlocks[0].reset();this.setAddRuleButton();this.handleDialogResize();return ;}var C;for(var B=0;B<this.maxNumRules;B++){if(this.ruleBlocks[B].ruleNumber==D){C=B;}}if(C==this.numRulesShown-1){this.ruleBlocks[C].reset();this.ruleBlocks[C].hide();this.numRulesShown--;this.setAddRuleButton();this.handleDialogResize();return ;}var A=this.ruleBlocks[C];for(var B=C+1;B<this.ruleBlocks.length;B++){this.ruleBlocks[B-1]=this.ruleBlocks[B];this.ruleBlocks[B-1].moveToEnd();}this.ruleBlocks[this.ruleBlocks.length-1]=A;this.ruleBlocks[this.ruleBlocks.length-1].moveToEnd();this.ruleBlocks[this.ruleBlocks.length-1].reset();this.ruleBlocks[this.ruleBlocks.length-1].hide();this.ruleBlocks[0].show();this.numRulesShown--;this.setAddRuleButton();this.handleDialogResize();},requestFormatDialog:function(B){var A=this;actuate.resource.module.feature.require([{module:"actuate.dialog",feature:"FONT_DIALOG"}],function(){var C=actuate.dialog.FontDialog.getInstance();C.setStyleModel(B);C.registerEventHandler(actuate.dialog.impl.EventConstants.ON_DIALOG_OK,A.updateFontPreview_c);C.registerEventHandler(actuate.dialog.impl.EventConstants.ON_DIALOG_CANCEL,A.revertFontSettings_c);C.show();});},requestValueDialog:function(G,B,C,H,E){this.setterFunction=H;var F=this.checkForPossibleBindingName(B);var D={};if(F){var A=this.formatLiteralAsBindingName(B);D.inputLiteral=A;D.isPotentialBinding=true;D.bindingLiteral=B;}else{D.inputLiteral=B;D.isPotentialBinding=false;D.bindingLiteral=null;}D.bindingName=G;D.dataType=C;D.conditionOperator=E;this._viewer.eventDispatcher.fireEvent(actuate.iv.core.iVEvent.__E_VALUE_DIALOG,D);},handleDialogResize:function(){for(var A=0;A<this.ruleBlocks.length;A++){if(this.ruleBlocks[A].isVisible){if(this.numRulesShown>1||this.ruleBlocks[A].conditionModel.operator){this.enableDeleteRuleButton(true,A);}else{this.enableDeleteRuleButton(false,A);}}else{this.enableDeleteRuleButton(false,A);}}this.adjustSize();},_localBind:function(F){this.enableAddRuleButton(false);var D=F[actuate.model.Constant.MetadataType.ELEMENT];this.boundDataColumns=D.getBindingsArray();this.selectedColumn=F.selectedBinding.name;var C=F.selectedBinding;var E=C.displayName;var H=this.getRulesOnColumn(F);this.setColumnDisplayName("conditionFormatDialog_id_columnHeader",E);var A=actuate.dialog.FontOptions;for(var B=0;B<this.ruleBlocks.length;B++){this.ruleBlocks[B].setBoundDataColumns(this.boundDataColumns,C);this.ruleBlocks[B].reset();this.ruleBlocks[B].moveToEnd();this.ruleBlocks[B].hide();}this.numRulesShown=0;for(var B=0;B<H.length&&B<this.maxNumRules;B++){var G=H[B];this.numRulesShown++;this.ruleBlocks[B].setData(H[B].filterRule);this.ruleBlocks[B].show();this.enableDeleteRuleButton(true,B);}if(H.length==0){this.numRulesShown++;this.ruleBlocks[0].show();this.ruleBlocks[0].resetWithOperator();if(this.ruleBlocks[0].getOperatorText()){this.enableDeleteRuleButton(true,0);}}},getRulesOnColumn:function(B){var A=B[actuate.model.Constant.MetadataType.FORMAT_RULES];if(!A){return[];}var F=A[B.selectedBinding.name];if(!F){return[];}var E=[];for(var D=0;D<F.length;D++){var C=new Object();C.filterRule=F[D];E.push(C);}return E;},setColumnDisplayName:function(B,A){actuate.util.XmlDom.setTextContent(document.getElementById(B),A);},getColumnIndex:function(){return"";},enableAddRuleButton:function(A){if(A){this.buttonAddRule.className="iv_dialog_link_enabled";}else{this.buttonAddRule.className="iv_dialog_link_disabled";}},enableDeleteRuleButton:function(A,B){if(A){this.ruleBlocks[B].deleteRuleButton.className="iv_dialog_link_enabled";}else{this.ruleBlocks[B].deleteRuleButton.className="iv_dialog_link_disabled";}},_okPress:function(){this.syncRuleblockModel();var A=this.isValid();if(A!=actuate.iv.ui.dialog.ConditionConstants.VALID){this._viewer.eventDispatcher.broadcastEvent(actuate.iv.core.iVEvent.__E_WARN,A);return ;}for(var C=0;C<this.numRulesShown;C++){var F=this.ruleBlocks[C];for(var B=C+1;B<this.ruleBlocks.length;B++){if(F.isRuleEmpty()){continue;}var E=this.ruleBlocks[B];if(F.conditionEquals(E)){this._viewer.eventDispatcher.broadcastEvent(actuate.iv.core.iVEvent.__E_WARN,actuate.util.Utility.getLocalizedString("conditionFormatDialog.duplicateConditions"));return ;}}}var D=this.createSoapRequest();this._viewer.eventDispatcher.fireEvent(actuate.iv.core.iVEvent.__E_APPLY_FORMAT_RULE,D);this._hide();},__getHelpTopic:function(){return"iv_conditional_formatting";},isValid:function(){var A=actuate.iv.ui.dialog.ConditionConstants.VALID;for(var B=0;B<this.numRulesShown;B++){if(!this.ruleBlocks[B].isRuleEmpty()){A=this.getLocalizedErrorMessage(this.ruleBlocks[B].isValid());if(A!=actuate.iv.ui.dialog.ConditionConstants.VALID){return this.ruleBlocks[B].getOperatorText()+" : "+A;}}}return A;},getLocalizedErrorMessage:function(A){if(A==actuate.iv.ui.dialog.ConditionConstants.CONDCOLUMN_ERROR){return actuate.util.Utility.getLocalizedString("conditionFormatDialog.condColumn_error");}if(A==actuate.iv.ui.dialog.ConditionConstants.OPERATOR_ERROR){return actuate.util.Utility.getLocalizedString("conditionFormatDialog.operator_error");}if(A==actuate.iv.ui.dialog.ConditionConstants.PARAM_ERROR){return actuate.util.Utility.getLocalizedString("conditionFormatDialog.param_error");}return actuate.iv.ui.dialog.ConditionConstants.VALID;},syncRuleblockModel:function(){for(var A=0;A<this.ruleBlocks.length;A++){if(!this.ruleBlocks[A].isRuleEmpty()){this.ruleBlocks[A].beforeApply();}}},updateFontPreview:function(){for(var A=0;A<this.ruleBlocks.length;A++){this.ruleBlocks[A].updatePreview();this.ruleBlocks[A].clearStyleModelRollbackState();}},revertFontSettings:function(){for(var A=0;A<this.ruleBlocks.length;A++){this.ruleBlocks[A].rollbackStyleModel();}},cancelValueDialog:function(){},applyValueDialogChanges:function(A){var B;if(A[0]==null){B=this.formatBindingNameAsLiteral(A[1]);}else{B=A[0];}this.setterFunction.setValues(B);},formatBindingNameAsLiteral:function(A){return"["+A+"]";},formatLiteralAsBindingName:function(A){var B=A;if(!actuate.util.Utility.isArray(A)){B=B.replace(/^\[|\]$/g,"");}return B;},checkForPossibleBindingName:function(B){if(actuate.util.Utility.isArray(B)){return true;}var A=B.match(/^\[.*\]$/);if(A){return true;}},isUseAsBinding:function(D,F){var H=this.checkForPossibleBindingName(D);if(H){var I=this.formatLiteralAsBindingName(D);var A=null;var B=null;for(var E=0;E<this.boundDataColumns.length;E++){var G=this.boundDataColumns[E];if(G.name==I){A=G;}if(G.name==F){B=G;}if(A!=null&&B!=null){break;}}if(A!=null&&B!=null){var C=B.matchFilterDataType(A);return C;}}return false;},createSoapRequest:function(){var E=actuate.util.XmlDom.createXMLDom(actuate.util.Constants.soap.NAMESPACE_ACTUATE10,actuate.Constant.tag.Data);var A=actuate.util.XmlDom.createElement(E,actuate.Constant.tag.COLUMNDEFS);E.documentElement.appendChild(A);var F=true;for(var C=0;C<this.numRulesShown;C++){if(!this.ruleBlocks[C].isRuleEmpty()){var D=this.ruleBlocks[C].createColumnDefNode(E);var B=this.createBoundDataColumnNode(E);D.appendChild(B);A.appendChild(D);F=false;}}if(F){var B=this.createBoundDataColumnNode(E);var D=this.ruleBlocks[0].createEmptyColDefNode(E);D.appendChild(B);A.appendChild(D);}return E;},createBoundDataColumnNode:function(C){var A=actuate.util.XmlDom.createElement(C,actuate.Constant.tag.BOUNDDATACOLUMN);var B=actuate.util.XmlDom.createElement(C,actuate.Constant.tag.NAME);A.appendChild(B);var D=C.createTextNode(this.selectedColumn);B.appendChild(D);return A;},__neh_gainFocus:function(A){this.selectBoxesFocused=true;},loseFocus:function(){this.selectBoxesFocused=false;},createMoreValuesRequest:function(E){var B=new actuate.data.BoundDataColumn();B.setName(this.selectedColumn);var C=new actuate.data.TableColumnDefinition();C.setIid(E);C.setBoundDataColumn(B);var A=new actuate.data.ColumnDefinitionGroup();A.addTableColumnDefinition(C);var D=actuate.util.XmlDom.createXMLDom(actuate.util.Constants.soap.NAMESPACE_ACTUATE10,"Data");D.documentElement.appendChild(A.getSoapRequest(D,"ColumnDefs"));return D;}});