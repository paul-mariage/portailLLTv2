actuate.util.Package.define("actuate.applybutton.impl");actuate.applybutton.impl.ApplyButton=actuate.Class.extendClass(actuate.common.Gadget,{_validEvents:["trigger","onSessionTimeout"],_name:null,_gadgetId:null,_dataObjectType:null,_metadata:null,_container:null,_rendered:false,_width:200,_height:100,_service:null,_reportContext:null,_panel:null,_applyButton:null,_mask:null,displayName:null,initialize:function(A){this._eventHandlers=[];if(A){this._reportContext=A.reportContext;this._name=A.name;this._gadgetId=A.gadgetId;}this._rendered=false;this._updateService();this.__triggerCallback_c=actuate.Method.bind(this.__triggerCallback,this);},getName:function(){return this._name;},render:function(A){if(!this._rendered){this._beforeRender();this._container=A;var B={width:"100%",cls:"gadget-chrome-applyButtonDiv",bodyCfg:{tag:"center"},items:[this._getApplyControlSection()]};this._panel=new actuate.widget.panel.Panel(B);this._panel.render(A);this._applyButton.render();this._afterRender();this._rendered=true;}this.refresh();},_getApplyControlSection:function(){this._applyButton=new actuate.widget.button.Button({id:this.getButtonElementId(),xtype:"button",style:"padding-top:3px",text:this.displayName,_onMouseOver:function(){},_onFocus:function(){},cls:"actuate-widget-applybutton",handler:actuate.Method.bind(this.onApply,this)});return{items:[this._applyButton]};},getButtonElementId:function(){return this.getName()+"_"+"applyButton";},onApply:function(){var A=[];var B=new actuate.common.SoapRequest(this._service);B.addOperation(this._gadgetId,"Gadget","TriggerApplyButton",[null,A]);this.lightUp(false);this._sendRequest(B,this.__triggerCallback_c);},lightUp:function(B){var A=this._applyButton.getEl();if(!A){return ;}if(B){A.addClass("actuate-widget-btn-lightUp");}else{A.removeClass("actuate-widget-btn-lightUp");}},refresh:function(){if(this._applyButton){this._applyButton.setText(this.displayName);}},setDisplayName:function(A){this.displayName=A;this.refresh();},getDisplayName:function(){return this.displayName;},remove:function(){if(this._rendered){this._panel.destroy();this._rendered=false;}},_destroy:function(){this._rendered=false;if(this._panel){this._panel.removeAll();this._panel.destroy();this._panel.getEl().remove();this._panel=null;}},destroy:function(){this._destroy();},_beforeRender:function(){},_afterRender:function(){this._panel.addClass("actuate-widget-panel-btns-center");},isPending:function(){return !this._service.__isChannelAvailable();},__createTools:function(){return null;},_render:function(A){},_sendRequest:function(C,D,A){var B=new actuate.applybutton.impl.ApplyButtonRequest(this._service);B.processEvent(this,C,D,A);},_updateService:function(){if(!this._reportContext){return ;}if(!this._service){this._service=new actuate.applybutton.impl.ApplyButtonService(this._id,this);this._service.documentModel=actuate.model.DocumentModel.getInstance();}this._service.setRequestUrl(this._reportContext.createSoapUrl("iv"));this._service.setBaseUrl(this._reportContext.getIportalUrl());},__getRequestOperands:function(){return[];},_createOperationData:function(B){var A=actuate.util.XmlDom;var D=A.createXMLDom(actuate.util.Constants.soap.NAMESPACE_ACTUATE10,actuate.Constant.tag.Data);var C=A.createElement(D,actuate.Constant.tag.Json);var E=D.createTextNode(B);C.appendChild(E);D.documentElement.appendChild(C);return D;},setReportContext:function(A){this._reportContext=A;if(this._service){this._updateService();}if(this._rendered){this.refresh();}},setSize:function(B,A){this._width=B||this._width;this._height=A||this._height;this.__updateSize();},__updateSize:function(){if(this._panel){this._panel.setSize(this._width,this._height);}},__triggerCallback:function(){this.fireEvent("trigger");},sessionTimeout:function(){this.fireEvent(actuate.applybutton.impl.EventConstants.ON_SESSION_TIMEOUT);},setMask:function(A){this._mask=A;}});actuate.util.Package.define("actuate.applybutton.impl");actuate.applybutton.impl.ApplyButtonException=actuate.Class.create();actuate.applybutton.impl.ApplyButtonException.prototype=actuate.Class.extend(new actuate.Exception(),{_element:null,initialize:function(A,E,D,B,C){actuate.Exception.prototype.initialize.call(this,A,E,D,B);this._element=C;},getElement:function(){return this._element;},getErrorMessage:function(){return this.getMessage();},_getName:function(){return"actuate.applybutton.ApplyButtonException";}});actuate.util.Package.define("actuate.applybutton.impl");actuate.applybutton.impl.ApplyButtonService=actuate.Class.extendClass(actuate.common.Service,{initialize:function(B,A){actuate.applybutton.impl.ApplyButtonService.superclass.initialize.call(this,B,A);this.maxChannel=1;},processBind:function(A,B,C){A.apiInstance.__bind(B);},showProgressIndicator:function(){var A=this._baseUrl+actuate.util.Constants.LOC_IMG_PROGRESS_ANIMATION;if(this.apiInstance._mask){this.apiInstance._mask.__showMask();}},hideProgressIndicator:function(){if(this.apiInstance._mask){this.apiInstance._mask.__hideMask();}},triggerSessionTimeout:function(){actuate.applybutton.impl.ApplyButtonService.superclass.triggerSessionTimeout.call(this);this.apiInstance.sessionTimeout();}});actuate.util.Package.define("actuate.applybutton.impl");actuate.applybutton.impl.ApplyButtonRequest=actuate.Class.extendClass(actuate.common.GenericRequest,{_applyButton:null,initialize:function(A){actuate.applybutton.impl.ApplyButtonRequest.superclass.initialize.call(this,A);},processEvent:function(B,C,D,A){if(this._busy){return ;}this._applyButton=B;this._finishCallback=D;this._errorCallback=A;this._ajaxResponse=null;if(!C.isEmpty()){if(this._service.showProgressIndicator){this._service.showProgressIndicator();}this._setBusy(true);this._connect(C);}this._processResponses();return false;},_processResponses:function(){if(this._ajaxRequestFinished==false){return ;}if(this._service.hideProgressIndicator){this._service.hideProgressIndicator();}this._setBusy(false);try{if(this._ajaxResponse){this._processAjaxResponse();}}catch(A){if(this._errorCallback){this._errorCallback(A);return ;}else{throw A;}}},_getSoapResponse:function(){return new actuate.applybutton.impl.ApplyButtonSoapResponse(this._service,this._applyButton);}});actuate.util.Package.define("actuate.applybutton.impl");actuate.applybutton.impl.ApplyButtonSoapResponse=actuate.Class.create();actuate.applybutton.impl.ApplyButtonSoapResponse.prototype=actuate.Class.extend(new actuate.common.GenericResponse(),{_applyButton:null,initialize:function(A,B){this._applyButton=B;actuate.common.GenericResponse.prototype.initialize.call(this,A);},_getResponseHandler:function(){return new actuate.applybutton.impl.ApplyButtonSoapResponseHandler(this._service,this._applyButton);},_getSoapFaultHandler:function(){return new actuate.applybutton.impl.SelectorSoapFaultHandler(this._service);}});actuate.util.Package.define("actuate.applybutton.impl");actuate.applybutton.impl.ApplyButtonSoapFaultHandler=actuate.Class.create();actuate.applybutton.impl.ApplyButtonSoapFaultHandler.prototype=actuate.Class.extend(new actuate.common.SoapResponseHandler(),{initialize:function(A){actuate.common.SoapResponseHandler.prototype.initialize.call(this,A);},process:function(A,D){var B=A.getElementsByTagName("faultstring");if(B[0]&&B[0].firstChild){var C=this._service.apiInstance._getEventHandlers(actuate.applybutton.impl.EventConstants.ON_EXCEPTION);if(!(C&&C.length>0)){actuate.widget.MessageBox.show({msg:B[0].firstChild.data,buttons:actuate.widget.MessageBox.OK,icon:actuate.widget.MessageBox.ERROR});}}}});actuate.util.Package.define("actuate.applybutton.impl");actuate.applybutton.impl.ApplyButtonSoapResponseHandler=actuate.Class.extendClass(actuate.common.SoapResponseHandler,{_applyButton:null,initialize:function(A,B){this._applyButton=B;actuate.applybutton.impl.ApplyButtonSoapResponseHandler.superclass.initialize.call(this,A);},process:function(A,B){this._processUpdateData(A.getElementsByTagName("UpdateData"),B);if(B){B();}},_processUpdateData:function(H,I){if(!H){return ;}for(var D=0;D<H.length;D++){var G=H[D].getElementsByTagName("Target");if(!G||G.length<=0){continue;}var E=H[D].getElementsByTagName("Data");if(!E||E.length<=0){continue;}var F=E[0].getElementsByTagName("RedirectURL");if(F.length>0){this._service.triggerSessionTimeout();continue;}var B=G[0].firstChild.data;if(B=="CommandStack"){var K=E[0];if(K){var A=K.getElementsByTagName("Json");if(A.length>0){K=actuate.util.Utility.parseJson(A[0]);actuate.common.CacheManager.COMMAND_STACK_LENGTH=K.currentRecord;actuate.common.CacheManager.COMMAND_STACK_RECORD=K.stackLength;}}continue;}var J=(B=="ApplyButton")&&this._service;if(!J){continue;}if(J.processBind){var C=E[0];if(C){var A=C.getElementsByTagName("Json");if(A.length>0){C=actuate.util.Utility.parseJson(A[0]);}}J.processBind(this._service,C,I);}}}});actuate.util.Package.define("actuate.applybutton.impl");actuate.applybutton.impl.EventConstants={ON_SESSION_TIMEOUT:"onSessionTimeout",ON_EXCEPTION:"onException",ON_TRIGGER:"onTrigger"};