actuate.util.Package.define("actuate.dialog.impl.helper.selectorbuilder");actuate.dialog.impl.helper.selectorbuilder.MultiSelectorDataTab=actuate.Class.extendClass(actuate.dialog.impl.helper.AbstractDataTabDialog,{_dialogName:"selectorBuilder.dataTab",_classname:"actuate.dialog.MultiSelectorDataTab",_type:null,_dataType:null,_dataFormat:null,_data:null,_dataText:null,_displayText:null,_sortText:null,_sortDirectionCombo:null,_operator:null,_operatorCombo:null,_operatorComboStore:null,_dataSets:null,_cubes:null,_filter:null,_parameterBasedSelector:false,_dataManagerSoap:null,_marginDelta:0,_heightDelta:0,_arbitraryValues:false,_multiValues:true,_indexCount:0,_dataIcons:[{type:null,iconCls:"actuate_data_column_image"},{type:"dimensions",iconCls:"actuate_dimensions_image"},{type:"sharedDimension",iconCls:"actuate_shared_dimension_image"},{type:"measures",iconCls:"actuate_measures_image"},{type:"dimension",iconCls:"actuate_dimension_image"},{type:"level",iconCls:"actuate_level_image"},{type:"measure",iconCls:"actuate_measure_image"},{type:"category",iconCls:"actuate_category_image"},{type:"string",iconCls:"actuate_data_column_string_image"},{type:"integer",iconCls:"actuate_data_column_number_image"},{type:"float",iconCls:"actuate_data_column_number_image"}],initialize:function(){if(actuate.util.browser.isIE9Flag){this._marginDelta=1;this._heightDelta=2;}else{if(actuate.util.browser.isChrome){}else{if(actuate.util.browser.isSafari){this._marginDelta=3;}}}actuate.dialog.impl.helper.selectorbuilder.MultiSelectorDataTab.superclass.initialize.apply(this,arguments);this.__removeButtonClick_c=actuate.Method.bind(this._removeButtonClick,this);var A=this._getId(this._classname);this._initContent();this._panel=new actuate.widget.panel.Panel(this._initPanel());this._multiValues=true;},_initializeControlStatus:function(){this._validateControlArray=[];this._validateControlArray.push(this._dataText);},_initPanel:function(){var B=actuate.util.Utility;this._createDataRecord(0);this._createDataRecord(1);this.__initDataSourceCombo();var A={title:actuate.util.Utility.getLocalizedString("selectorBuilder.dataTab.data"),header:false,style:"background:transparent;",border:false,layout:"column",items:[{border:false,layout:"form",defaults:{width:360},labelWidth:138,items:[this.__dataSourceCombo,{border:false,layout:"form",width:513,items:[{layout:"column",border:false,items:[{width:205,xtype:"label",style:"text-color:black;font-weight:bold;border:1px solid #CCCCCC;text-align:left;background:none repeat scroll 0 0 #EFF1F2;padding-left:5px;height:17px;",text:actuate.util.Utility.getLocalizedString("selectorBuilder.multidataTab.field")},{width:205,xtype:"label",style:"text-color:black;font-weight:bold;border:1px solid #CCCCCC;border-left:none;text-align:left;background:none repeat scroll 0 0 #EFF1F2;padding-left:5px;height:17px;",text:actuate.util.Utility.getLocalizedString("selectorBuilder.multidataTab.displayField")},{width:80,xtype:"label",style:"text-color:black;font-weight:bold;border:1px solid #CCCCCC;border-left:none;text-align:left;background:none repeat scroll 0 0 #EFF1F2;padding-left:5px;height:17px;",text:actuate.util.Utility.getLocalizedString("selectorBuilder.multidataTab.sortDirection")},{width:20,xtype:"label",style:"text-color:black;font-weight:bold;border:1px solid #CCCCCC;border-left:none;text-align:left;background:none repeat scroll 0 0 #EFF1F2;padding-left:5px;height:17px;",text:"  "}]},{border:false,colspan:4,id:"multiselector_data_table",items:[{layout:"column",border:false,items:[{width:205,border:false,style:"height:17px;",items:[this._dataText[0]]},{width:205,border:false,style:"height:17px;",items:[this._displayText[0]]},{width:80,style:"height:17px;",border:false,items:[this._sortDirectionCombo[0]]},{width:20,border:false,style:"border:1px solid #CCCCCC;padding-left:1px;padding-right:1px;"+"height:"+(17+this._heightDelta)+"px",items:[this._removeButton[0]]}]},{layout:"column",border:false,items:[{width:205,border:false,style:"height:17px;",items:[this._dataText[1]]},{width:205,border:false,style:"height:17px;",items:[this._displayText[1]]},{width:80,style:"height:17px;",border:false,items:[this._sortDirectionCombo[1]]},{width:20,border:false,style:"border:1px solid #CCCCCC;padding-left:1px;padding-right:1px;"+"height:"+(17+this._heightDelta)+"px",items:[this._removeButton[1]]}]}]},{xtype:"label",style:"text-align:left;color:gray;",text:actuate.util.Utility.getLocalizedString("selectorBuilder.multidataTab.maximum")}]}]}]};return A;},_removeDataRecord:function(A){if(A>=0){var B=actuate.widget.ComponentMgr.get("multiselector_data_table");this._removeRecord(A);B.remove(B.items.items[A],true);this._parentDialog._fixDropShadow();if(this._parentDialog._formatPanel&&this._parentDialog._formatPanel._removeFormatRecord){this._parentDialog._formatPanel._removeFormatRecord(A);}}},_removeRecord:function(A){this._treeStore.splice(A-1,1);this._treeStore2.splice(A-1,1);this._dataText.splice(A-1,1);this._displayText.splice(A-1,1);this._sortDirectionStore.splice(A-1,1);this._sortDirectionCombo.splice(A-1,1);this._removeButton.splice(A-1,1);},_addDataRecord:function(A){if(A<8){this._createDataRecord(A);var B=actuate.widget.ComponentMgr.get("multiselector_data_table");B.insert(A,{layout:"column",border:false,items:[{width:205,border:false,items:[this._dataText[A]]},{width:205,border:false,items:[this._displayText[A]]},{width:80,border:false,items:[this._sortDirectionCombo[A]]},{width:20,border:false,style:"border:1px solid #CCCCCC;padding-left:1px;padding-right:1px;height:"+(17+this._heightDelta)+"px",items:[this._removeButton[A]]}]});this._parentDialog._window._doLayout();this._parentDialog._fixDropShadow();this._resetDataRecord(A);if(A>0){this._removeButton[A].registerEventHandler("click",this.__removeButtonClick_c,false);}}},_createDataRecord:function(A){if(!this._treeStore){this._treeStore=[];}this._treeStore[A]=new actuate.widget.custom.TreeCombo.TreeComboStore(new actuate.widget.data.SimpleStore({fields:["object","text","title"]}));if(!this._treeStore2){this._treeStore2=[];}this._treeStore2[A]=new actuate.widget.custom.TreeCombo.TreeComboStore(new actuate.widget.data.SimpleStore({fields:["object","text","title"]}));if(!this._sortDirectionStore){this._sortDirectionStore=[];}if(!this._dataText){this._dataText=[];}this._dataText[A]=new actuate.widget.custom.TreeCombo.TreeComboBox({style:"",cls:"actuate-form-paddingleft",width:198-this._marginDelta,triggerClass:"actuate-form-trigge",editable:false,forceSelection:true,valueField:"object",displayField:"text",titleField:"title",autoExpand:true,icons:this._dataIcons,sortInfo:{folderSort:true,field:"text",direction:"ASC"},showTooltip:true,store:this._treeStore[A]});this._dataText[A].registerEventHandler("select",actuate.Method.bind(this._eh_changeDataTree,this));this._dataText[A].registerEventHandler("beforeselect",actuate.Method.bind(this._canDataFieldBeSelected,this));if(!this._displayText){this._displayText=[];}this._displayText[A]=new actuate.widget.custom.TreeCombo.TreeComboBox({style:"",cls:"actuate-form-paddingleft",width:198-this._marginDelta,triggerClass:"actuate-form-trigger",editable:false,forceSelection:true,valueField:"object",displayField:"text",autoExpand:true,icons:this._dataIcons,sortInfo:{folderSort:true,field:"text",direction:"ASC"},showTooltip:true,store:this._treeStore2[A]});this._displayText[A].registerEventHandler("select",actuate.Method.bind(this._eh_changeDataTree,this));this._displayText[A].registerEventHandler("beforeselect",actuate.Method.bind(this._canDataFieldBeSelected,this));this._sortDirectionStore[A]=new actuate.widget.data.SimpleStore({fields:["value","text"],data:[["none",actuate.util.Utility.getLocalizedString("common.dataTab.sort.none")],["asc",actuate.util.Utility.getLocalizedString("common.dataTab.sort.ascending")],["desc",actuate.util.Utility.getLocalizedString("common.dataTab.sort.descending")]]});if(!this._sortDirectionCombo){this._sortDirectionCombo=[];}this._sortDirectionCombo[A]=new actuate.widget.form.ComboBox({index:this._indexCount++,editable:false,forceSelection:true,store:this._sortDirectionStore[A],value:"none",valueField:"value",displayField:"text",cls:"actuate-form-paddingleft",style:"",triggerClass:"actuate-form-trigger",width:75-this._marginDelta});if(!this._removeButton){this._removeButton=[];}var B=new actuate.widget.Template('<button style="height:17px;'+"background: transparent url(iportal/jsapi/actuate/dialog/images/remove.png) "+'no-repeat;" type="{1}">{0}</button>');this._removeButton[A]=new actuate.uiadapter.Button({index:this._indexCount++,_template:B,cls:"actuate_table_builder_up_down_buttons",width:"17px",disabledClass:"actuate_table_builder_up_down_buttons_disabled",disabled:true});},_canDataFieldBeSelected:function(B,A){if(A&&A.data&&A.data.object){return actuate.dialog.impl.helper.selectorbuilder.MultiSelectorDataTab.superclass._eh_onBeforeSelect.call(this,B,A.data.object.node);}return true;},_removeButtonClick:function(I){var D=this._removeButton.length;var O={};for(var F=D-1;F>-1;F--){if(this._dataText[F].getValue()&&this._dataText[F].getValue().id!=""){O[F]={};O[F].sortDirection=this._sortDirectionCombo[F].getValue();O[F].binding=this._dataText[F].getValue().realId;O[F].displayColumn=this._displayText[F].getValue().realId;O[F].dataFormat=this._parentDialog._formatPanel._dataFormat[F];O[F].formatType=this._parentDialog._formatPanel._formatType[F];}}var Q=this._removeButton.length-1;for(var H=0;H<D;H++){if(I.index==this._removeButton[H].buttonEl.index){Q=H;break;}}for(var G=D-1;G>-1;G--){this._removeDataRecord(G);}var M=this.__dataSourceCombo.getValue();var L=M.dimensions||M.measures;this._addDataRecord(0);this._addDataRecord(1);for(var C=0;C<D;C++){var B=C;if(C==Q){continue;}else{if(C>Q){B=C-1;}}if(O[C]){var A=this._dataText[0].store.data.items;if(B>0){this._addDataRecord(B+1);}var N=O[C].binding;var K=O[C].displayColumn;if(A){var P=2;for(var E in A){var M=A[E].id;if(N==M){this._dataText[B].setValueById(A[E].id);if(L||!K){this._displayText[B].setValueById(K);if(B>0){this._removeButton[B].enable();}}if(--P<=0){break;}}if(!L&&K==M){this._displayText[B].setValueById(A[E].id);if(B>0){this._removeButton[B].enable();}if(--P<=0){break;}}}}if(O[C].sortDirection){this._sortDirectionCombo[B].setValue(O[C].sortDirection||"none");}if(O[C].dataFormat&&O[C].formatType){var J={};J.value=O[C].dataFormat;J.type=O[C].formatType;this._parentDialog._formatPanel._updateFormatRecord(B,(K==null||K=="")?N:K,J,L);}}}},_initOperatorStore:function(){var D=this._type;var C=this._dataType;var E=this._multiValues;var B=actuate.util.Utility;if(!C){C="string";}if(C=="string"&&D=="slider"){this._multiValues=E=false;}var A=["Eq"];if((D=="list"&&E)||D=="checkBox"){A=["In"];}else{if(D=="slider"&&E){A=["Between"];}}},_initTree:function(C){var B=[{type:null,iconCls:"actuate_data_column_image"},{type:"dimensions",iconCls:"actuate_dimensions_image"},{type:"sharedDimension",iconCls:"actuate_shared_dimension_image"},{type:"measures",iconCls:"actuate_measures_image"},{type:"dimension",iconCls:"actuate_dimension_image"},{type:"level",iconCls:"actuate_level_image"},{type:"measure",iconCls:"actuate_measure_image"},{type:"string",iconCls:"actuate_data_column_string_image"},{type:"integer",iconCls:"actuate_data_column_number_image"},{type:"float",iconCls:"actuate_data_column_number_image"}];var A=new actuate.widget.tree.TreePanel({index:this._indexCount++,el:"tree-div",autoScroll:true,style:"margin-bottom: 5px;",width:200,height:150,rootVisible:false,containerScroll:true,store:C,icons:B,pathSeparator:"|"});return A;},_initButtons:function(){var A=actuate.util.Utility;var B=[];this._okBtn=new actuate.uiadapter.Button({text:A.getLocalizedString("baseDialog.button.ok")});this._cancelBtn=new actuate.uiadapter.Button({text:A.getLocalizedString("baseDialog.button.cancel")});B.push(this._okBtn);B.push(this._cancelBtn);return B;},_eh_changeDataTree:function(A,F){if(!F||!F.data||!F.data.object){return ;}var D=F.data.object.text;var C=F.data.object.realId;var G=F.data.object.pattern;this._dataFormat=F.data.object.format;for(var B=0;B<this._dataText.length;B++){if(A==this._dataText[B]){this._dataType=F.data.object.type;this._displayText[B].setValueById(this._dataText[B].getValue().id);if(B>0){this._removeButton[B].enable();}if(this._parentDialog._formatPanel&&this._parentDialog._formatPanel._updateFormatRecord){this._parentDialog._formatPanel._updateFormatRecord(B,(this._displayText[B].getValue()==null||this._displayText[B].getValue()=="")?this._dataText[B].getValue():this._displayText[B].getValue(),this._dataFormat,this._isDataCubeSelected());}if(B==this._dataText.length-1){this._addDataRecord(B+1);}}}for(var E=0;E<this._displayText.length;E++){if(A==this._displayText[E]){if(this._parentDialog._formatPanel&&this._parentDialog._formatPanel._updateFormatRecord){this._parentDialog._formatPanel._updateFormatRecord(E,(this._displayText[E]&&this._displayText[E].getValue)?(this._displayText[E].getValue()==null?this._dataText[E].getValue():this._displayText[E].getValue()):((this._dataText[E]&&this._dataText[E].getValue)?this._dataText[E].getValue():null),this._dataFormat,this._isDataCubeSelected());}}}this._parentDialog._fixDropShadow();this.__selectionChangedHandler();},__onSelectDataSource:function(){this.__clearFilter();this._clearFieldsAndDisplay();this._updateTree();actuate.dialog.impl.helper.selectorbuilder.MultiSelectorDataTab.superclass.__onSelectDataSource.call(this);},_clearFieldsAndDisplay:function(){if(this._dataText){for(var B=0;B<this._dataText.length;B++){this._setFieldValue(this._dataText[B],null);}}if(this._displayText){for(var A=0;A<this._displayText.length;A++){this._setFieldValue(this._displayText[A],null);}}},_preHide:function(){this.__clearFilter();this._type=null;this._datamartName=null;this._multiValues=true;for(var A=this._dataText.length-1;A>=0;A--){this._removeDataRecord(A);}this._addDataRecord(0);this._addDataRecord(1);},_updateControls:function(){this.__dataSourceCombo.show();for(var A=0;A<this._dataText.length;A++){this._dataText[A].show();}for(var A=0;A<this._displayText.length;A++){this._displayText[A].show();}for(var A=0;A<this._sortDirectionCombo.length;A++){this._sortDirectionCombo[A].show();}},_updateTree:function(){var E=this.__dataSourceCombo.getValue();var A=E.dimensions||E.measures;var D=this._dataText.length;for(var B=D-1;B>-1;B--){this._removeDataRecord(B);}this._addDataRecord(0);this._addDataRecord(1);for(var C=0;C<this._dataText.length;C++){if(E){this._treeStore[C]._innerStore.removeAll();this.__setTreeStoreValues(this._treeStore[C]._innerStore,E);}this._dataText[C].expandDeep=this._isDataModelSelected()?1:null;this._dataText[C].refresh();}if(A){for(var C=0;C<this._displayText.length;C++){this._displayText[C].disable();}}else{for(var C=0;C<this._treeStore2.length;C++){this._treeStore2[C]._innerStore.removeAll();if(E){this.__setTreeStoreValues(this._treeStore2[C]._innerStore,E);}this._displayText[C].expandDeep=this._isDataModelSelected()?1:null;this._displayText[C].enable();this._displayText[C].refresh();}}this._parentDialog._fixDropShadow();return E;},__createRecord:function(A,L,E,O,D,J){var F=A;var M=D||this._isDisabled(A,L);var I=A.dataType;var C=A.fullName||A.name;var N=A.displayName||A.name;var H=A.pattern;var K=A.dataFormat?A.dataFormat:{value:{dataType:null,category:"Unformatted"}};if(K&&K.value){K.value.dataType=I;}if(A.levels){if(A.shared){I="sharedDimension";}else{I="dimension";}}else{if(A.measures){I="measure";}}var B;if(C){var G=C;if(E||O){C=(E||O)+"::"+C;}if(N){F={id:C,realId:G,text:N,pattern:H,format:K,type:I,parentId:E||O,disabled:M};if(F&&L&&!L.getById(F.id)){L.add(new L.recordType({value:F.id,text:J?F.realId:F.text,object:F},F.id));}}}return F.id;},_resetDataRecord:function(B){this._dataText[B].clear();this._displayText[B].clear();this._dataText[B].expandDeep=this._isDataModelSelected()?1:null;this._displayText[B].expandDeep=this._isDataModelSelected()?1:null;var C=this.__dataSourceCombo.getValue();var A=C.dimensions||C.measures;if(C){this._treeStore[B]._innerStore.removeAll();this.__setTreeStoreValues(this._treeStore[B]._innerStore,C);}this._dataText[B].refresh();if(A){this._displayText[B].disable();}else{this._treeStore2[B]._innerStore.removeAll();if(C){this.__setTreeStoreValues(this._treeStore2[B]._innerStore,C);}this._displayText[B].refresh();this._displayText[B].enable();}this._parentDialog._fixDropShadow();return C;},_isDisabled:function(B){if(actuate.dialog.impl.helper.selectorbuilder.SelectorDataTab.superclass._isDisabled.apply(this,arguments)){return true;}if(B&&(B.type=="measure"||B.type=="measures")){return true;}var A={"slider":["float","decimal","integer","currency"],"calendar":["date","date-time"]}[this._type];if(B&&B.dataType){return B.dataType=="blob"||(A&&actuate.util.Utility.arrayIndexOf(A,B.dataType.toLowerCase())<0);}return false;},_loadParameter:function(C){this._clearControls();var H="";var A="";var G="";if(C.parameter){H=C.parameter.dashboardFile;A=C.parameter.parameterName;G=C.parameter.cascadingGroupName||null;this._dataType=C.parameter.dataType;this._controlType=C.parameter.controlType;this._datamartName=C.parameter.datamartName;this._supportNoValue=C.parameter.isNoValueSupported;}else{H=C.Base.dashboardFile;A=C.Base.binding;G=C.Base.cascadingGroupName||null;this._dataType=C.Base.dataType;this._controlType=C.Base.controlType;this._datamartName=C.Base.datamartName;}if(G){A=G+"/"+A;}var F=actuate.util.Utility.getFileExtension(H).toLowerCase();var B="";var E="";if(F=="datadesign"){B=actuate.util.Utility.getLocalizedString("selectorBuilder.dataTab.dataDesign");E=actuate.util.Utility.getLocalizedString("selectorBuilder.dataTab.dataDesignParameter");}else{B=actuate.util.Utility.getLocalizedString("selectorBuilder.dataTab.report");E=actuate.util.Utility.getLocalizedString("selectorBuilder.dataTab.reportParameter");}this._reportText.setLabel(B);this._parameterText.setLabel(E);this._reportText.setValue(H);this._parameterText.setValue(A);var D={value:{dataType:this._dataType,category:"Unformatted"}};this.fireEvent("fieldchanged",{format:D});},_loadReportData:function(A){this._hasNewDatamart=false;this._data=A;this._clearControls();this.__showAllDataSources();this._updateTree();if(A.Filter){this._filter=A.Filter;}},_loadSelectorData:function(E){if(!(E&&E.Base)){return ;}this.setType(E.Base.type,false);var M=E.Base.bindings;this._bindings=M;var B=E.Base.dataObjectType;if(!B){return ;}this._operator=E.Base.operator;this._initOperatorStore();var I=false;if(B=="cube"){I=true;}if(E.DataSet&&E.DataSet.dataMart){this.__selectDataSource(E.DataSet,"dataset");this.__onSelectDataSource();}else{if(E.Cube&&E.Cube.dataMart){this.__selectDataSource(E.Cube,"cube");this.__onSelectDataSource();}}this._updateTree();var D=E.Base.displayColumn;var G=E.Base.pattern;var A=this._dataText[0].store.data.items;if(M){for(var F=0;F<M.length;F++){if(F>0&&F<8&&!this._dataText[F+1]){this._addDataRecord(F+1);}var K=M[F].binding;var H=M[F].displayColumn||M[F].name||J;if(A){var L=2;for(var C in A){var J=A[C].id;if(K==J){this._dataText[F].setValueById(A[C].id);if(F>0){this._removeButton[F].enable();}if(I||!H){this._displayText[F].setValueById(H);}if(--L<=0){break;}}if(!I&&H==J){this._displayText[F].setValueById(A[C].id);if(--L<=0){break;}}}}if(M[F].sortDirection){this._sortDirectionCombo[F].setValue(M[F].sortDirection||"none");}this._parentDialog._formatPanel._updateFormatRecord(F,(this._displayText[F].getValue()==null||this._displayText[F].getValue()=="")?this._dataText[F].getValue():this._displayText[F].getValue(),M[F].dataFormat,I);}}if(E.Filter){this._filter=E.Filter;}this._parentDialog._fixDropShadow();},_isParameterBasedSelector:function(A){if(A&&A.parameter){return true;}if(A&&A.Base&&A.Base.parameterName){return true;}return false;},loadData:function(A){if(A&&A.DataMarts){this._loadReportData(A);}else{if(A&&A.Base){this._loadSelectorData(A);}}},_getData:function(E,A,C){if(E&&A&&C){var D;switch(C){case"dataset":D=E.dataSets;break;case"cube":D=E.cubes;break;case"parameter":D={name:this.getLocalizedString("parameters"),parameters:E.parameters};break;}if(D){for(var B=0;B<D.length;B++){D[B].datamart=E;A.push(D[B]);}}}},_clearControls:function(){this.__dataSourceCombo.clear();if(this._dataText){for(var A=0;A<this._dataText.length;A++){this._setFieldValue(this._dataText[A],null);}}if(this._displayText){for(var B=0;B<this._displayText.length;B++){this._setFieldValue(this._displayText[B],null);}}if(this._sortDirectionCombo){for(var C=0;C<this._sortDirectionCombo.length;C++){this._sortDirectionCombo[C].setValue("none");}}this._filterSoap=null;this._measureFilterSoap=null;this._filter=null;this._dataManagerSoap=null;},_changeFilterPanel:function(B){if(this._parentDialog._filterPanel){var C={};var A=this.__getSelectedDataSourceInfo();if(A){C.dataObject=[A[1],A[4],A[3]];C.dataObjectSoap=this.createDataSetSoap(A);C.dataMartSoap=this._dataManagerSoap;C.clearFilterUI=this._clearFilterUI;C.target="Selector";}if(this._filter){C.Filter=this._filter;}this._parentDialog._filterPanel.loadData(C);}},createDataSetSoap:function(){var I=actuate.util.XmlDom.createXMLDom(actuate.util.Constants.soap.NAMESPACE_ACTUATE10,actuate.Constant.tag.Data);var C=this.__dataSourceCombo.getValue();var E=this._isDataCubeSelected();var N=this._isDataSetSelected();var H=this._parameterBasedSelector;var F=C.dataSourceName;F=F?F:"";var L=C?C.name:null;var J=C.dataMartName;if(E){G=actuate.util.XmlDom.createElement(I,"Cube");var B=actuate.util.XmlDom.createElement(I,"Name");var D=I.createTextNode(L);B.appendChild(D);G.appendChild(B);}else{if(N){var G=actuate.util.XmlDom.createElement(I,"DataSetDef");var B=actuate.util.XmlDom.createElement(I,"Name");var D=I.createTextNode(L);B.appendChild(D);G.appendChild(B);}}var A=actuate.util.XmlDom.createElement(I,"DataSource");var M=actuate.util.XmlDom.createElement(I,"DisplayName");D=I.createTextNode(F);M.appendChild(D);A.appendChild(M);if(J!=null){var K=actuate.util.XmlDom.createElement(I,"DataMartName");D=I.createTextNode(J);K.appendChild(D);A.appendChild(K);}G.appendChild(A);return G;},getDataSelection:function(){var B={};if(this._parameterBasedSelector){var D=this._reportText.getValue();var C=actuate.util.Utility.getFileExtension(D).toLowerCase();if(C=="datadesign"){B.type="datamartParameter";B.datamartName=D;}else{B.type="reportParameter";B.reportName=D;}B.parameterName=this._parameterText.getValue();}else{if(this._isDataSetSelected()){B.type="dataset";B.dataSourceName=this.__dataSourceCombo.getValue().name;for(var A=0;A<this._dataText.length-1;A++){if(!B.columnName){B.columnName=this._dataText[A].getRawValue();}if(!B.columnDisplayName){B.columnDisplayName=this._dataText[A].getRawValue();}}}else{if(this._isDataCubeSelected()){B.type="cube";B.dataSourceName=this.__dataSourceCombo.getValue().name;for(var A=0;A<this._dataText.length-1;A++){if(!B.levelName){B.levelName=this._dataText[A].getValue()?this._dataText[A].getValue().realId:null;}if(!B.columnDisplayName){B.columnDisplayName=this._dataText[A].getValue()?this._dataText[A].getValue().text:null;}}}}}B.dataType=this._dataType;return B;},createSoapNode:function(F,E){if(E){var Y=this._isDataCubeSelected();var W=this._isDataSetSelected();var D=this._parameterBasedSelector;var L=actuate.util.XmlDom.createElement(E,"Name");var Q;if(W||Y){var K;var B=actuate.util.XmlDom.createElement(E,"BoundDataColumnList");var Z=[];for(var G=0;G<this._dataText.length;G++){var R=this._sortDirectionCombo[G].getValue();if(!K){K=actuate.util.XmlDom.createElement(E,"SortDefinitionList");}var J=actuate.util.XmlDom.createElement(E,"SortDefinition");var O=actuate.util.XmlDom.createElement(E,"SortDir");O.appendChild(E.createTextNode(R));J.appendChild(O);K.appendChild(J);if(this._dataText[G].getValue()&&this._dataText[G].getValue().id!=""){Z.push(this._dataText[G].getValue().realId);if(!Y){Z.push(this._displayText[G].getValue().realId);}else{Z.push(this._dataText[G].getValue().realId);}}}if(K){E.documentElement.appendChild(K);}for(var S=0;S<Z.length;S++){var X=actuate.util.XmlDom.createElement(E,"BoundDataColumn");var L=actuate.util.XmlDom.createElement(E,"Name");if(Z[S]){L.appendChild(E.createTextNode(Z[S]));}X.appendChild(L);B.appendChild(X);}E.documentElement.appendChild(B);this.__addFilterSoap(E.documentElement);if(W){Q=actuate.util.XmlDom.createElement(E,"DataSetDef");}else{if(Y){Q=actuate.util.XmlDom.createElement(E,"Cube");}}if(Q){var T=actuate.util.XmlDom.createElement(E,"Name");var H=this.__dataSourceCombo.getValue();var a=H?H.name:null;T.appendChild(E.createTextNode(a));Q.appendChild(T);}}if(Q){var P=actuate.util.XmlDom.createElement(E,"DataSource");var H=this.__dataSourceCombo.getValue();var A="";if(D){A=this._reportText.getValue();if(this._datamartName){var V=actuate.util.XmlDom.createElement(E,"DataMartName");V.appendChild(E.createTextNode(this._datamartName));P.appendChild(V);}}else{if(H){A=H.dataSourceName;A=A?A:"";var V=actuate.util.XmlDom.createElement(E,"DataMartName");V.appendChild(E.createTextNode(H.dataMartName));P.appendChild(V);var M=this.__getSelectedDataSourceInfo();var I=M[4];if(I){var N=(I.toLowerCase()=="data")?actuate.dialog.impl.constant.DataMartAccessType.LATEST:actuate.dialog.impl.constant.DataMartAccessType.TRANSIENT;var C=actuate.util.XmlDom.createElement(E,"Type");C.appendChild(E.createTextNode(N));P.appendChild(C);}}}if(A){var U=actuate.util.XmlDom.createElement(E,"Name");U.appendChild(E.createTextNode(A));P.appendChild(U);}Q.appendChild(P);E.documentElement.appendChild(Q);}}actuate.dialog.impl.helper.selectorbuilder.MultiSelectorDataTab.superclass.createSoapNode.apply(this,arguments);},createJsonData:function(){return null;},validate:function(){var D=this._isDataCubeSelected();var E=this._isDataSetSelected();var C=null;if(!(D||E)){C=actuate.util.Utility.getLocalizedString("common.dataTab.noDataSourceError");}if(this._dataText.length>0){C=actuate.util.Utility.getLocalizedString("selectorBuilder.dataTab.field.errorMessage");for(var B=0;B<this._dataText.length-1;B++){if((this._dataText[B]&&this._dataText[B].getValue())){C=null;}}}if(this._dataText.length>1){for(var B=0;B<this._dataText.length-1;B++){for(var A=B+1;A<this._dataText.length;A++){if((this._dataText[B].getValue().realId==this._dataText[A].getValue().realId)&&(this._dataText[B].getValue().realId&&this._dataText[A].getValue().realId)){C=actuate.util.Utility.getLocalizedString("selectorBuilder.dataTab.field.duplicate.errorMessage");}}}}if(C){actuate.widget.MessageBox.show({title:actuate.util.Utility.getLocalizedString("selectorDialog.alertTitle"),msg:C,buttons:actuate.widget.MessageBox.OK});return false;}return true;},setType:function(A,B){this._type=A;if(B){this._updateTree();}this._initOperatorStore();},getType:function(){return this._type;},setMultiValues:function(A){if(A!=this._multiValues){this._multiValues=A;this._initOperatorStore();}},getSelectedDataType:function(){return this._dataType;},_setFieldValue:function(D,B){var E=null;var F=null;var A=null;var C=null;if(B){F=B.id;A=B.pattern;C=B.format?B.format:{value:{}};}E=this._getTextFromId(F);D.setValue(E);D.realId=F;if(C&&C.value){if(!C.value.dataType){C.value.dataType=this._dataType;}if(!C.value.category){C.value.category="Unformatted";}}this.fireEvent("fieldchanged",{binding:F,pattern:A,format:C});},_getTextFromId:function(G){if(!G){return null;}var C=this.__dataSourceCombo.getValue();var B=[C.columns,C.dimensions,C.measures,C.parameters];for(var A=0;A<B.length;A++){var F=this._getTextFromArray(B[A],G);if(F){return F;}if(B[A]&&actuate.util.Utility.isArray(B[A])){var E=B[A];for(k=0;k<E.length;k++){var D=[E[k].levels,E[k].measures];for(j=0;j<D.length;j++){var F=this._getTextFromArray(D[j],G);if(F){return F;}}}}}},_getTextFromArray:function(B,E){if(!B){return null;}for(var C=0;C<B.length;C++){var A=B[C].fullName||B[C].name;var D=B[C].displayName||B[C].name;if(A==E){return D;}}return null;},__addDataIntoTreeStore:function(B,A){if(A&&B&&!(B.value&&B.value.dataType=="blob")){if(!B.format){B.format={value:{dataType:B.type,category:"Unformatted"}};}B.object=B;B.title=this._getTooltip(B);B.disabled=this._isDisabled(B,A);A.add(new A.recordType(B,B.id));}}});