actuate.util.Package.define("actuate.dialog.impl.helper.crosstabbuilder");actuate.dialog.impl.helper.crosstabbuilder.CrosstabDataTab=actuate.Class.extendClass(actuate.dialog.impl.helper.AbstractDataTabDialog,{_classname:"actuate.dialog.impl.helper.crosstabbuilder.CrosstabDataTab",_crosstab:null,_cube:null,formatPanel:null,_selectedIid:null,_dataManagerSoap:null,_filter:null,_hasNewDatamart:false,_isLinkedDataset:false,_height:680,UP_DOWN_BUTTON_CLS:"actuate_table_builder_up_down_buttons actuate_crosstab_builder_up_down_buttons",MOVE_BUTTON_CLS:"actuate_table_builder_up_down_buttons actuate_crosstab_builder_move_buttons",UP_ENABLE_ICON:"iportal/common/images/up-arrow.png",UP_DISABLE_ICON:"iportal/common/images/up-arrow-disabled.png",DOWN_ENABLE_ICON:"iportal/common/images/down-arrow.png",DOWN_DISABLE_ICON:"iportal/common/images/down-arrow-disabled.png",LEFT_ENABLE_ICON:"iportal/common/images/left-arrow.png",RIGHT_ENABLE_ICON:"iportal/common/images/right-arrow.png",_TOOLTIP:{UP:actuate.util.Utility.getLocalizedString("crosstabBuilderDialog.tooltip.up"),DOWN:actuate.util.Utility.getLocalizedString("crosstabBuilderDialog.tooltip.down"),ADD:actuate.util.Utility.getLocalizedString("crosstabBuilderDialog.tooltip.add"),REMOVE:actuate.util.Utility.getLocalizedString("crosstabBuilderDialog.tooltip.remove")},initialize:function(){this.id=this._getId(this._classname);this._util=actuate.util.Utility;this._title=this._util.getLocalizedString("crosstabBuilderDialog.dataTab.title");this._crosstab=null;this._selectedIid=null;this._dataManagerSoap=null;actuate.dialog.impl.helper.AbstractTabDialog.prototype.initialize.call(this);this.__initDataSourceCombo();this._hyperlinkCheckbox=actuate.widget.ComponentMgr.get("actuate_dialog_CrosstabDataTab_hyperlinkCheckbox");this._panel.on("activate",actuate.Method.bind(this.onActivate,this));},_initContent:function(){var E=this;var J="";this._cubeCombo=new actuate.widget.custom.TreeCombo.TreeComboBox({editable:false,width:321,forceSelection:true,autoExpand:true,valueField:"value",displayField:"title",titleField:"title",icons:this.__dataSourceIcons,sortInfo:{folderSort:true,field:"text",direction:"ASC"},showTooltip:true,store:new actuate.widget.custom.TreeCombo.TreeComboStore(this.__dataSourceComboStore)});var H=new actuate.widget.form.FieldSet({collapsible:true,title:this._util.getLocalizedString("crosstabBuilderDialog.dataTab.cube"),checkboxToggle:false,defaults:{border:false,header:false,layout:"table",bodyStyle:"padding:2px;"},cls:"actuate-widget-panle-zero-margin-top",listeners:{collapse:function(){if(E._parentDialog&&E._parentDialog.adjustSize){E._parentDialog.adjustSize();}},expand:function(){if(E._parentDialog&&E._parentDialog.adjustSize){E._parentDialog.adjustSize();}}},items:[{items:[{xtype:"label",text:this._util.getLocalizedString("crosstabBuilderDialog.dataTab.cubeLabel"),style:J},this._cubeCombo]},{items:[{id:"actuate_dialog_CrosstabDataTab_hyperlinkCheckbox",xtype:"checkbox",checked:false,boxLabel:this._util.getLocalizedString("common.dataTab.useHyperlink"),style:J}]}]});this._componentArray.push(H);var D=[];var N="<img src='"+actuate.widget.BLANK_IMAGE_URL+"' name='crosstabRow' class='actuate_crosstab_builder_row_image'/>";var G="<img src='"+actuate.widget.BLANK_IMAGE_URL+"' name='crosstabColumn' class='actuate_crosstab_builder_column_image'/>";var M=[{type:0,iconCls:"actuate_column_image"},{type:"folder",iconCls:"actuate_folder_image"},{type:"dimensions",iconCls:"actuate_dimensions_image"},{type:"dimension",iconCls:"actuate_dimension_image"},{type:"sharedDimension",iconCls:"actuate_shared_dimension_image"},{type:"level",iconCls:"actuate_level_image"},{type:"attribute",iconCls:"actuate_attribute_image"},{type:"measures",iconCls:"actuate_measures_image"},{type:"measure",iconCls:"actuate_measure_image"}];this.dimensionTreeLabel=new actuate.widget.form.Label({text:this._util.getLocalizedString("crosstabBuilderDialog.dataTab.dataLabel"),style:J});var K=new actuate.widget.tree.TreePanel({rowspan:4,autoScroll:true,width:262,height:275,rootVisible:false,containerScroll:true,dataStore:new actuate.widget.tree.TreeStore([]),selModel:new actuate.widget.tree.MultiSelectionModel(),icons:M});this._rightButtonRows=new actuate.uiadapter.Button({cls:this.MOVE_BUTTON_CLS,icon:this.RIGHT_ENABLE_ICON,disabled:true,tooltipType:"title",tooltip:this._TOOLTIP.ADD});this._leftButtonRows=new actuate.uiadapter.Button({cls:this.MOVE_BUTTON_CLS,icon:this.LEFT_ENABLE_ICON,disabled:true,tooltipType:"title",tooltip:this._TOOLTIP.REMOVE});var C=new actuate.widget.tree.TreePanel({autoScroll:true,width:262,height:115,rootVisible:false,containerScroll:true,dataStore:new actuate.widget.tree.TreeStore([]),selModel:new actuate.widget.tree.MultiSelectionModel(),icons:M});this._upButtonRows=new actuate.uiadapter.Button({cls:this.UP_DOWN_BUTTON_CLS,icon:this.UP_DISABLE_ICON,tooltipType:"title",tooltip:this._TOOLTIP.UP});this._downButtonRows=new actuate.uiadapter.Button({cls:this.UP_DOWN_BUTTON_CLS,icon:this.DOWN_DISABLE_ICON,tooltipType:"title",tooltip:this._TOOLTIP.DOWN});this._rightButtonColumns=new actuate.uiadapter.Button({cls:this.MOVE_BUTTON_CLS,icon:this.RIGHT_ENABLE_ICON,disabled:true,tooltipType:"title",tooltip:this._TOOLTIP.ADD});this._leftButtonColumns=new actuate.uiadapter.Button({cls:this.MOVE_BUTTON_CLS,icon:this.LEFT_ENABLE_ICON,disabled:true,tooltipType:"title",tooltip:this._TOOLTIP.REMOVE});var L=new actuate.widget.tree.TreePanel({autoScroll:true,width:262,height:115,rootVisible:false,containerScroll:true,dataStore:new actuate.widget.tree.TreeStore([]),selModel:new actuate.widget.tree.MultiSelectionModel(),icons:M});this._upButtonColumns=new actuate.uiadapter.Button({cls:this.UP_DOWN_BUTTON_CLS,icon:this.UP_DISABLE_ICON,tooltipType:"title",tooltip:this._TOOLTIP.UP});this._downButtonColumns=new actuate.uiadapter.Button({cls:this.UP_DOWN_BUTTON_CLS,icon:this.DOWN_DISABLE_ICON,tooltipType:"title",tooltip:this._TOOLTIP.DOWN});this.dimensionsFieldSet=new actuate.widget.form.FieldSet({collapsible:true,title:this._util.getLocalizedString("crosstabBuilderDialog.dataTab.dimensions"),cls:"actuate-widget-panle-zero-margin-top",layout:"table",layoutConfig:{columns:4},listeners:{collapse:function(){if(E._parentDialog&&E._parentDialog.adjustSize){E._parentDialog.adjustSize();}},expand:function(){if(E._parentDialog&&E._parentDialog.adjustSize){E._parentDialog.adjustSize();}}},items:[{colspan:2,border:false,items:[this.dimensionTreeLabel]},{layout:"table",colspan:2,border:false,items:[{html:N,border:false},{xtype:"label",text:this._util.getLocalizedString("crosstabBuilderDialog.dataTab.row"),style:J}]},K,{border:false,items:[this._rightButtonRows,this._leftButtonRows]},C,{border:false,items:[this._upButtonRows,this._downButtonRows]},{colspan:3,height:20,border:false},{xtype:"label",text:""},{layout:"table",colspan:2,border:false,items:[{html:G,border:false},{xtype:"label",text:this._util.getLocalizedString("crosstabBuilderDialog.dataTab.column"),style:J}]},{border:false,items:[this._rightButtonColumns,this._leftButtonColumns]},L,{border:false,items:[this._upButtonColumns,this._downButtonColumns]}]});D.push(this.dimensionsFieldSet);var F="<img src='"+actuate.widget.BLANK_IMAGE_URL+"' name='crosstabSummary' class='actuate_crosstab_builder_summary_image'/>";this.measureTreeLabel=new actuate.widget.form.Label({text:this._util.getLocalizedString("crosstabBuilderDialog.dataTab.dataLabel"),style:J});var I=new actuate.widget.tree.TreePanel({autoScroll:true,width:262,height:85,rootVisible:false,containerScroll:true,dataStore:new actuate.widget.tree.TreeStore([]),selModel:new actuate.widget.tree.MultiSelectionModel(),icons:M});this._rightButtonMeasures=new actuate.uiadapter.Button({cls:this.MOVE_BUTTON_CLS,icon:this.RIGHT_ENABLE_ICON,disabled:true,tooltipType:"title",tooltip:this._TOOLTIP.ADD});this._leftButtonMeasures=new actuate.uiadapter.Button({cls:this.MOVE_BUTTON_CLS,icon:this.LEFT_ENABLE_ICON,disabled:true,tooltipType:"title",tooltip:this._TOOLTIP.REMOVE});var B=new actuate.widget.tree.TreePanel({autoScroll:true,width:262,height:85,rootVisible:false,containerScroll:true,dataStore:new actuate.widget.tree.TreeStore([]),selModel:new actuate.widget.tree.MultiSelectionModel(),icons:M});this._upButtonMeasures=new actuate.uiadapter.Button({cls:this.UP_DOWN_BUTTON_CLS,icon:this.UP_DISABLE_ICON,tooltipType:"title",tooltip:this._TOOLTIP.UP});this._downButtonMeasures=new actuate.uiadapter.Button({cls:this.UP_DOWN_BUTTON_CLS,icon:this.DOWN_DISABLE_ICON,tooltipType:"title",tooltip:this._TOOLTIP.DOWN});this.measuresFieldSet=new actuate.widget.form.FieldSet({collapsible:true,title:this._util.getLocalizedString("crosstabBuilderDialog.dataTab.measures"),cls:"actuate-widget-panle-zero-margin-top",layout:"table",layoutConfig:{columns:4},listeners:{collapse:function(){if(E._parentDialog&&E._parentDialog.adjustSize){E._parentDialog.adjustSize();}},expand:function(){if(E._parentDialog&&E._parentDialog.adjustSize){E._parentDialog.adjustSize();}}},items:[{colspan:2,border:false,items:[this.measureTreeLabel]},{layout:"table",colspan:2,border:false,items:[{html:F,border:false},{xtype:"label",text:this._util.getLocalizedString("crosstabBuilderDialog.dataTab.summary"),style:J}]},I,{border:false,items:[this._rightButtonMeasures,this._leftButtonMeasures]},B,{border:false,items:[this._upButtonMeasures,this._downButtonMeasures]}]});D.push(this.measuresFieldSet);var A=new actuate.widget.panel.Panel({header:false,plain:true,border:false,title:this._title,autoHeight:true,items:D});this.linkedDatasetLabel=new actuate.widget.form.Label({text:this._util.getLocalizedString("crosstabBuilderDialog.dataTab.dataLabel"),height:10,style:J});this._linkedDatasetTree=new actuate.widget.tree.TreePanel({rowspan:4,autoScroll:true,width:262,height:400,rootVisible:false,containerScroll:true,dataStore:new actuate.widget.tree.TreeStore([]),selModel:new actuate.widget.tree.MultiSelectionModel(),icons:M});this.linkedDataPanel=new actuate.widget.panel.Panel({header:false,plain:true,border:false,layout:"table",layoutConfig:{columns:2},items:[{style:"width:15px;",border:false},{border:false,items:[{style:"height:18px;",border:false},this.linkedDatasetLabel,this._linkedDatasetTree]}]});this.dataPanelContainer=new actuate.widget.form.FieldSet({header:false,layout:"table",layoutConfig:{columns:2},items:[this.linkedDataPanel,A]});this._componentArray.push(this.dataPanelContainer);this._dimensionsTree=K;this._rowsTree=C;this._columnsTree=L;this._measuresTree=I;this._selectedMeasuresTree=B;this._dimensionsTree.registerEventHandler("click",actuate.Method.bind(this._dimensionsTreeClick,this),false);this._rowsTree.registerEventHandler("click",actuate.Method.bind(this._rowsTreeClick,this),false);this._columnsTree.registerEventHandler("click",actuate.Method.bind(this._columnsTreeClick,this),false);this._measuresTree.registerEventHandler("click",actuate.Method.bind(this._measuresTreeClick,this),false);this._selectedMeasuresTree.registerEventHandler("click",actuate.Method.bind(this._selectedMeasuresTreeClick,this),false);this._linkedDatasetTree.registerEventHandler("click",actuate.Method.bind(this._linkedDataSetTreeClick,this),false);this._rightButtonRows.registerEventHandler("click",actuate.Method.bind(this._rightButtonRowsClick,this),false);this._leftButtonRows.registerEventHandler("click",actuate.Method.bind(this._leftButtonRowsClick,this),false);this._upButtonRows.registerEventHandler("click",actuate.Method.bind(this._upButtonRowsClick,this),false);this._downButtonRows.registerEventHandler("click",actuate.Method.bind(this._downButtonRowsClick,this),false);this._rightButtonColumns.registerEventHandler("click",actuate.Method.bind(this._rightButtonColumnsClick,this),false);this._leftButtonColumns.registerEventHandler("click",actuate.Method.bind(this._leftButtonColumnsClick,this),false);this._upButtonColumns.registerEventHandler("click",actuate.Method.bind(this._upButtonColumnsClick,this),false);this._downButtonColumns.registerEventHandler("click",actuate.Method.bind(this._downButtonColumnsClick,this),false);this._rightButtonMeasures.registerEventHandler("click",actuate.Method.bind(this._rightButtonMeasuresClick,this),false);this._leftButtonMeasures.registerEventHandler("click",actuate.Method.bind(this._leftButtonMeasuresClick,this),false);this._upButtonMeasures.registerEventHandler("click",actuate.Method.bind(this._upButtonMeasuresClick,this),false);this._downButtonMeasures.registerEventHandler("click",actuate.Method.bind(this._downButtonMeasuresClick,this),false);},resize:function(H){if(!H){return ;}var F=H.width;if(F>650){var G=(F-130)/2;this._dimensionsTree.setWidth(G);this._rowsTree.setWidth(G);this._columnsTree.setWidth(G);this._measuresTree.setWidth(G);this._selectedMeasuresTree.setWidth(G);this._linkedDatasetTree.setWidth(G);this._cubeCombo.setWidth(F/2);}var B=H.height;if(B>611){var D=B-200;var E=D*0.7;var C=D*0.2;var A=D*0.29;this._dimensionsTree.setHeight(E);this._measuresTree.setHeight(C);this._selectedMeasuresTree.setHeight(C);this._rowsTree.setHeight(A);this._columnsTree.setHeight(A);this._linkedDatasetTree.setHeight(D);}},__createDataSourceCombo:function(){return this._cubeCombo;},onActivate:function(){var A=this._parentDialog.getWindow();A.setHeight(this._height);},loadData:function(B,A){this._hyperlinkCheckbox.disable();this._hyperlinkCheckbox.setValue(false);this._hasNewDatamart=false;this.formatPanel=A;if(B.Element&&B.Element.iid){this._selectedIid=B.Element.iid;}else{this._selectedIid=null;}if(B&&B.displayAttributeItem!=undefined){this.displayAttributeItem=B.displayAttributeItem;}if(B&&B.DataMarts){this._data=B;this.__showAllDataSources();if(this._parentDialog&&this._parentDialog._consumer&&this._parentDialog._consumer._service&&this._parentDialog._consumer._service._instanceId){this._resetContent();this.__onSelectDataSource();return ;}}this._resetContent();if(this._data&&this._data.DataMarts&&this._data.DataMarts.length>0){this._crosstab=null;if(B.DACrosstab){this._crosstab=B.DACrosstab;}if(B.Cube){if(!B.Cube.dataObject){B.Cube.dataObject=B.Cube.cubeName;}if(B.Cube.details.subType=="linkedcube"){B.Cube.dataObjectType="dataset";}this.__selectDataSource(B.Cube,"cube");this._cube=B.Cube;}this.__onSelectDataSource();if(B.Filter){this._filter=B.Filter;this._changeFilterPanel();}}},__addToDataSourceStore:function(B,D,E){if(D=="dataset"){var A=[];for(var C=0;C<B.length;C++){if(B[C].isLinkedDataModel){A.push(B[C]);}}if(A.length>0){actuate.dialog.impl.helper.crosstabbuilder.CrosstabDataTab.superclass.__addToDataSourceStore.call(this,A,D,E);}}else{if(D=="cube"||D=="datamart"){actuate.dialog.impl.helper.crosstabbuilder.CrosstabDataTab.superclass.__addToDataSourceStore.call(this,B,D,E);}}},_isSelectedCubeData:function(){var A=this.__dataSourceCombo.getValue();if(!A||A.id=="newData"){return false;}return true;},__getDefaultSelectionID:function(E){var F=E;if(!F||F.length<=0){F=this._data?this._data.DataMarts:null;}if(F&&F.length>0){var G=F[0];var B=G.cubes;var D=G.dataSets;var A;if(D&&D.length>0){for(var C=0;C<D.length;C++){if(D[C].isLinkedDataModel){A=this.__createDataSourceRecord(D[C],"dataset",G);break;}}}if(!A&&B&&B.length>0){A=this.__createDataSourceRecord(B[0],"cube",G);}return A?A.id:null;}},_isExistedCube:function(B){if(!B||!this._cube||!this._cube.dataMart){return false;}var C=B[2]+"."+B[4]+"-"+B[1].name;var A=this._cube.dataMart.fileName+"."+this._cube.dataMart.extension+"-"+this._cube.dataObject;if(C==A){return true;}return false;},_updateContent:function(L){if(!L){return ;}this._resetContent();var G={};var H={};var B=L[1];if(this._crosstab&&this._cube&&this._isExistedCube(L)){this._updateCrosstabDimensions(this._rowsTree,this._crosstab.rows,G);this._updateCrosstabDimensions(this._columnsTree,this._crosstab.columns,G);var A=this._crosstab.measures;var C=this._selectedMeasuresTree.getRootNode();if(A&&A.length>0){for(var E=0;E<A.length;E++){var J=A[E].name;var I=this.__getMeasureFromCube(J,B);H[J]=J;var D=C.appendChild({id:escape(J),type:"measure",title:J,text:J,aggrFunctionValue:I.aggregationFunction,uiProvider:actuate.widget.custom.CrosstabBuilderTreeNodeUI});D.ui.showDropDownArrow(false);}this._selectedMeasuresTree.expandAll();}}this._updateCubeDimensions(this._dimensionsTree,B.dimensions,G);var K=B.measures;if(K&&K.length>0){for(var F=0;F<K.length;F++){var A=K[F].measures;var C=this._measuresTree.getRootNode();if(A&&A.length>0){for(var E=0;E<A.length;E++){if(A[E].isVisible==false){continue;}var J=A[E].name;C.appendChild({id:escape(J),title:J,text:J,type:"measure",disabled:(H[J]!=null),aggregationFunction:A[E].aggregationFunction});}}}}this._measuresTree.expandAll();},__getMeasureFromCube:function(E,B){if(B&&E){var A=B.measures;if(A&&A.length>0){for(var D=0;D<A.length;D++){var F=A[D].measures;if(F&&F.length>0){for(var C=0;C<F.length;C++){if(E==F[C].name){return F[C];}}}}}}return null;},_updateCrosstabDimensions:function(Q,A,G){if(!Q){return ;}if(A&&A.length>0){for(var H=0;H<A.length;H++){var F=A[H];var O=F.dimensionName;var P=F.levels;var N=G[O];if(!N){N=new actuate.util.HashMap();G[O]=N;}var I=Q.getRootNode().appendChild({id:escape(O),text:O,type:F.shared?"sharedDimension":"dimension"});if(P&&P.length>0){for(var E=0;E<P.length;E++){var B=P[E].fullName;var K=P[E].levelName;var J=P[E].cubeLevelIndex;var M=I.appendChild({id:escape(B),text:K,type:"level"});M.cubeLevelIndex=J;var L=[];N.put(K,L);var D=P[E].attributes;if(D){for(var C=0;C<D.length;C++){M.appendChild({text:D[C].name,type:"attribute",itemId:D[C].itemId});L.push(D[C].name);}}}}}}this._expandDimensionTree(Q);},_updateCubeDimensions:function(K,G,E){if(!K){return ;}if(G&&G.length>0){for(var O=0;O<G.length;O++){var Q=G[O];var P=Q.name;var H=Q.levels;var D=E[P];var A=K.getRootNode().appendChild({id:escape(P),text:P,type:Q.shared?"sharedDimension":"dimension"});if(H&&H.length>0){var C=-1;for(var M=0;M<H.length;M++){var R=H[M].fullName;var J=H[M].name;C++;var B=A.appendChild({id:escape(R),text:J,type:"level",disabled:(D&&D.containsKey(J))});B.cubeLevelIndex=C;var F=D?D.get(J):null;var I=H[M].attributes;if(I){for(var L=0;L<I.length;L++){var N=I[L].name;B.appendChild({text:N,type:"attribute",disabled:F&&actuate.util.Utility.arrayContains(F,N)});}}}}this._resetParentNodeEnableState(A);}}this._expandDimensionTree(K);},_expandDimensionTree:function(A){if(this.displayAttributeItem==true){A.expandAll();}else{A.getRootNode().expand();for(var B=0;B<A.getRootNode().childNodes.length;B++){A.getRootNode().childNodes[B].expand();}}},_afterHide:function(){this._resetContent();this.__dataSourceCombo.clear();this.__dataSourceCombo.setValue("");this._dataManagerSoap=null;this._crosstab=null;this._cube=null;},_resetContent:function(){this._resetTree(this._dimensionsTree);this._resetTree(this._rowsTree);this._resetTree(this._columnsTree);this._resetTree(this._measuresTree);this._resetTree(this._selectedMeasuresTree);this._resetTree(this._linkedDatasetTree);this._rightButtonRows.setDisabled(true);this._rightButtonColumns.setDisabled(true);this._leftButtonRows.setDisabled(true);this._leftButtonColumns.setDisabled(true);this._rightButtonMeasures.setDisabled(true);this._leftButtonMeasures.setDisabled(true);this._hyperlinkCheckbox.disable();this._hyperlinkCheckbox.setValue(false);this._upButtonRows.setDisabled(true);this._upButtonRows.setIcon(this.UP_DISABLE_ICON);this._downButtonRows.setDisabled(true);this._downButtonRows.setIcon(this.DOWN_DISABLE_ICON);this._upButtonColumns.setDisabled(true);this._upButtonColumns.setIcon(this.UP_DISABLE_ICON);this._downButtonColumns.setDisabled(true);this._downButtonColumns.setIcon(this.DOWN_DISABLE_ICON);this._upButtonMeasures.setDisabled(true);this._upButtonMeasures.setIcon(this.UP_DISABLE_ICON);this._downButtonMeasures.setDisabled(true);this._downButtonMeasures.setIcon(this.DOWN_DISABLE_ICON);this._isLinkedDataset=false;this.updateDataPanelUI();this.__clearFilter();},_resetTree:function(A){var B=A.getRootNode();if(B){B.clear();}A.dataStore=new actuate.widget.tree.TreeStore([]);A.getSelectionModel().clearSelections(true);},_handleDragdrop:function(B,C,A,D){},__onSelectDataSource:function(){this.__clearFilter();this._resetContent();var B=this.__getSelectedDataSourceInfo();if(B){if(B[1].isLinkedDataModel){this._isLinkedDataset=true;this._updateLinkedDatasetContent(B);}else{this._updateContent(B);}this._checkHyperlink();var A=this._crosstab&&this._cube&&this._isExistedCube(B);if(this.formatPanel){var C={};if(A){C.DACrosstab=this._crosstab;}this.formatPanel.loadData(C);}}this._clearFilterUI=true;actuate.dialog.impl.helper.crosstabbuilder.CrosstabDataTab.superclass.__onSelectDataSource.call(this);},getDataSelection:function(){var A=this.__getSelectedDataSourceInfo();if(A&&A[1]){return{dataSourceName:A[1].name};}return null;},_getDefaultID:function(C){var D=C;if(!D||D.length<=0){D=this._data?this._data.DataMarts:null;}if(D&&D.length>0){var E=D[0];var B=E.cubes;var A;if(B&&B.length>0){A=this._createDataSourceRecord(B[0],"cube",E);}return A?A.id:null;}},_checkHyperlink:function(){var I=this.__getSelectedDataSourceInfo();if(!I||!I[1]){return ;}if(this._crosstab){if(this._crosstab.useDefaultHyperlink==false){this._hyperlinkCheckbox.setValue(false);}else{this._hyperlinkCheckbox.setValue(true);}}else{this._hyperlinkCheckbox.setValue(true);}var G=false;var C=I[1];var A=C.dimensions;if(A){var F=false;for(var E=0;E<A.length;E++){if(F){break;}var H=A[E].levels;if(H){for(var D=0;D<H.length;D++){if(H[D]&&H[D].hasAction){G=true;F=true;break;}}}}}var B=C.measures;if(B){for(var E=0;E<B.length;E++){if(B[E]&&B[E].hasAction){G=true;break;}}}if(G){this._hyperlinkCheckbox.enable();}else{this._hyperlinkCheckbox.disable();this._hyperlinkCheckbox.setValue(false);}},_dimensionsTreeClick:function(A,B){this._rightButtonRows.setDisabled(true);this._rightButtonColumns.setDisabled(true);if(A){if(this.__allowMoveDimension(this._dimensionsTree,this._rowsTree,A,B)){this._rightButtonRows.setDisabled(false);}if(this.__allowMoveDimension(this._dimensionsTree,this._columnsTree,A,B)){this._rightButtonColumns.setDisabled(false);}}},__toggleDimensionRightButtons:function(A){this._rightButtonRows.setDisabled(true);this._rightButtonColumns.setDisabled(true);if(A){if(!this._isLinkedDataset){if(this.__allowMoveDimension(this._dimensionsTree,this._rowsTree)){this._rightButtonRows.setDisabled(false);}if(this.__allowMoveDimension(this._dimensionsTree,this._columnsTree)){this._rightButtonColumns.setDisabled(false);}}else{if(this.__allowMoveDimension(this._linkedDatasetTree,this._rowsTree)){this._rightButtonRows.setDisabled(false);}if(this.__allowMoveDimension(this._linkedDatasetTree,this._columnsTree)){this._rightButtonColumns.setDisabled(false);}}}},_rowsTreeClick:function(A,B){this.__toggleLeftButtonRows(A);this.__toggleUpDownButton(this._rowsTree,A,B);},__toggleUpDownButton:function(B,E,F){var G=this.__getSelectedNodes(B,E,F);var C=(G&&G.length>0);if(C){var A=G[0].parentNode;for(var D=1;D<G.length;D++){if(G[D].parentNode!=A){C=false;break;}}if(C){C=A.childNodes.length>1;}}if(C){C=G[0].attributes.type!="level";}if(C){if(B==this._rowsTree){this.__enableUpDownIcon(G,A,this._upButtonRows,this._downButtonRows);}else{if(B==this._columnsTree){this.__enableUpDownIcon(G,A,this._upButtonColumns,this._downButtonColumns);}else{if(B==this._selectedMeasuresTree){this.__enableUpDownIcon(G,A,this._upButtonMeasures,this._downButtonMeasures);}}}}else{if(B==this._rowsTree){this._upButtonRows.setDisabled(true);this._upButtonRows.setIcon(this.UP_DISABLE_ICON);this._downButtonRows.setDisabled(true);this._downButtonRows.setIcon(this.DOWN_DISABLE_ICON);}else{if(B==this._columnsTree){this._upButtonColumns.setDisabled(true);this._upButtonColumns.setIcon(this.UP_DISABLE_ICON);this._downButtonColumns.setDisabled(true);this._downButtonColumns.setIcon(this.DOWN_DISABLE_ICON);}else{if(B==this._selectedMeasuresTree){this._upButtonMeasures.setDisabled(true);this._upButtonMeasures.setIcon(this.UP_DISABLE_ICON);this._downButtonMeasures.setDisabled(true);this._downButtonMeasures.setIcon(this.DOWN_DISABLE_ICON);}}}}},__enableUpDownIcon:function(D,A,C,B){if(D&&A&&A.childNodes.length>=2){if(D[0]==A.childNodes[0]){C.setDisabled(true);C.setIcon(this.UP_DISABLE_ICON);B.setDisabled(false);B.setIcon(this.DOWN_ENABLE_ICON);}else{if(D[0]==A.childNodes[A.childNodes.length-1]){C.setDisabled(false);C.setIcon(this.UP_ENABLE_ICON);B.setDisabled(true);B.setIcon(this.DOWN_DISABLE_ICON);}else{C.setDisabled(false);C.setIcon(this.UP_ENABLE_ICON);B.setDisabled(false);B.setIcon(this.DOWN_ENABLE_ICON);}}}},__toggleLeftButtonRows:function(A){if(A){this._leftButtonRows.setDisabled(false);}else{this._leftButtonRows.setDisabled(true);}this.__toggleDimensionRightButtons(true);},_columnsTreeClick:function(A,B){this.__toggleLeftButtonColumns(A);this.__toggleUpDownButton(this._columnsTree,A,B);},__toggleLeftButtonColumns:function(A){if(A){this._leftButtonColumns.setDisabled(false);}else{this._leftButtonColumns.setDisabled(true);}this.__toggleDimensionRightButtons(true);},_measuresTreeClick:function(A,B){this.__toggleRightButtonMeasures(A);},__toggleRightButtonMeasures:function(A){if(A){this._rightButtonMeasures.setDisabled(false);}else{this._rightButtonMeasures.setDisabled(true);}},_selectedMeasuresTreeClick:function(A,B){this.__toggleLeftButtonMeasures(A);this.__toggleUpDownButton(this._selectedMeasuresTree,A,B);},__toggleLeftButtonMeasures:function(A){if(A){this._leftButtonMeasures.setDisabled(false);}else{this._leftButtonMeasures.setDisabled(true);}},_rightButtonRowsClick:function(){var A;if(this._isLinkedDataset){A=this._linkedDatasetTree;}else{A=this._dimensionsTree;}if(this.__allowMoveDimension(A,this._rowsTree)){this.__moveTreeItem(A,this._rowsTree,true);}},_leftButtonRowsClick:function(){if(this._isLinkedDataset){this.__moveTreeItem(this._rowsTree,this._linkedDatasetTree,true);}else{this.__moveTreeItem(this._rowsTree,this._dimensionsTree,true);}},_upButtonRowsClick:function(){this.__reorderTreeItem(this._rowsTree,true);this.__toggleUpDownButton(this._rowsTree);},_downButtonRowsClick:function(){this.__reorderTreeItem(this._rowsTree,false);this.__toggleUpDownButton(this._rowsTree);},_rightButtonColumnsClick:function(){var A;if(this._isLinkedDataset){A=this._linkedDatasetTree;}else{A=this._dimensionsTree;}if(this.__allowMoveDimension(A,this._columnsTree)){this.__moveTreeItem(A,this._columnsTree,true);}},_leftButtonColumnsClick:function(){if(this._isLinkedDataset){this.__moveTreeItem(this._columnsTree,this._linkedDatasetTree,true);}else{this.__moveTreeItem(this._columnsTree,this._dimensionsTree,true);}},_upButtonColumnsClick:function(){this.__reorderTreeItem(this._columnsTree,true);this.__toggleUpDownButton(this._columnsTree);},_downButtonColumnsClick:function(){this.__reorderTreeItem(this._columnsTree,false);this.__toggleUpDownButton(this._columnsTree);},_rightButtonMeasuresClick:function(){if(this._isLinkedDataset){this.__moveTreeItem(this._linkedDatasetTree,this._selectedMeasuresTree,true);}else{this.__moveTreeItem(this._measuresTree,this._selectedMeasuresTree,true);}},_leftButtonMeasuresClick:function(){if(this._isLinkedDataset){this.__moveTreeItem(this._selectedMeasuresTree,this._linkedDatasetTree,true);}else{this.__moveTreeItem(this._selectedMeasuresTree,this._measuresTree,true);}},_upButtonMeasuresClick:function(){this.__reorderTreeItem(this._selectedMeasuresTree,true);this.__toggleUpDownButton(this._selectedMeasuresTree);},_downButtonMeasuresClick:function(){this.__reorderTreeItem(this._selectedMeasuresTree,false);this.__toggleUpDownButton(this._selectedMeasuresTree);},__checkButtonState:function(A){if(!A){return ;}if(A==this._dimensionsTree){this.__toggleDimensionRightButtons(this.__hasSelectedNode(A));}else{if(A==this._rowsTree){this.__toggleLeftButtonRows(this.__hasSelectedNode(A));this.__toggleUpDownButton(this._rowsTree);}else{if(A==this._columnsTree){this.__toggleLeftButtonColumns(this.__hasSelectedNode(A));this.__toggleUpDownButton(A);}else{if(A==this._measuresTree){this.__toggleRightButtonMeasures(this.__hasSelectedNode(A));}else{if(A==this._selectedMeasuresTree){this.__toggleLeftButtonMeasures(this.__hasSelectedNode(A));this.__toggleUpDownButton(A);}else{if(A==this._linkedDatasetTree){this.__toggleDimensionRightButtons(this.__hasSelectedNode(A));this.__toggleRightButtonMeasures(this.__hasSelectedNode(A));}}}}}}},__hasSelectedNode:function(A){if(A&&A.getSelectionModel()){var B=A.getSelectionModel().getSelectedNodes();if(B&&B.length>0){return true;}}return false;},__reorderTreeItem:function(E,H){var J=this.__getSelectedNodesForReorder(E);if(!J||J.length<=0){return ;}if(!H){J=J.reverse();}var C=E.getSelectionModel();for(var F=0;F<J.length;F++){var I=J[F];var G=I.parentNode;if(H){var A=I.previousSibling;var B=I.isSelected();if(!A||actuate.util.Utility.arrayContains(J,A)){continue;}G.insertBefore(I,A);}else{var D=I.nextSibling;if(!D||actuate.util.Utility.arrayContains(J,D)){continue;}G.insertBefore(D,I);}if(B){C.select(I,null,true);}}},__getSelectedNodesForReorder:function(C){var E=[];var K=[];var F=C.getSelectionModel().getSelectedNodes();if(F&&F.length>0){K=[].concat(F);}var A=C.getRootNode();if(C!=this._selectedMeasuresTree){var B=true;var J=[];for(var G=0;G<K.length;G++){var I=K[G];var D=I.attributes.type;if(D!="attribute"){B=false;break;}J.push(I);}if(B){J.sort(function(M,L){var O=M.parentNode();var N=L.parentNode();if(O!=N){var Q=O.parentNode();var P=N.parentNode();if(Q!=P){return A.indexOf(Q)-A.indexOf(P);}else{return Q.indexOf(O)-Q.indexOf(N);}}else{return O.indexOf(M)-O.indexOf(L);}});return J;}}for(var G=0;G<K.length;G++){var I=K[G];var D=I.attributes.type;if(D){if(D=="dimension"||D=="sharedDimension"){if(!this.__checkIfExisted(E,I)){E.push(I);}}else{if(D=="level"){var H=I.parentNode;if(!this.__checkIfExisted(E,H)){E.push(H);}}else{if(D=="attribute"){var H=I.parentNode.parentNode;if(!this.__checkIfExisted(E,H)){E.push(H);}}else{if(D=="measure"){E.push(I);}}}}}}E.sort(function(M,L){var O=A.indexOf(M);var N=A.indexOf(L);return O-N;});return E;},__checkIfExisted:function(A,C){for(var B=0;B<A.length;B++){if(A[B]==C){return true;}}return false;},__getSelectedNodes:function(A,C,D){var E=[];var B=A.getSelectionModel().getSelectedNodes();if(B&&B.length>0){E=[].concat(B);}if(C){if(D&&D.ctrlKey){if(!C.isSelected()){E.push(C);}}else{E=[];E.push(C);}}return E;},__getSelectedNodesForMove:function(A,C,F){var E=[];var G=this.__getSelectedNodes(A,C,F);for(var B=0;B<G.length;B++){var D=G[B];if(!actuate.util.Utility.arrayContains(E,D)){this.__getSelectedNodesForMoveFromNode(D,E);}}return E;},__getSelectedNodesForMoveFromNode:function(D,E){var C=D.childNodes;var B=false;for(var A=0;A<C.length;A++){if(C[A].isSelected()){this.__getSelectedNodesForMoveFromNode(C[A],E);B=true;}}if(!B){E.push(D);}},__allowMoveDimension:function(I,D,A,L){var M=this.__getSelectedNodesForMove(I,A,L);if(M&&M.length>0){if(I==this._linkedDatasetTree){for(var H=0;H<M.length;H++){var K=M[H];if(K.attributes.type=="folder"){var C=0;var B=K.childNodes;for(var F=0;F<B.length;F++){var N=B[F];if(this._rowsTree.getNodeById(N.id)||this._columnsTree.getNodeById(N.id)){C++;}}if(C<B.length){return true;}}else{if(!this._rowsTree.getNodeById(K.id)&&!this._columnsTree.getNodeById(K.id)){return true;}}}return false;}else{for(var H=0;H<M.length;H++){var K=M[H];var E=K.attributes.type;var J;if(E=="dimension"||E=="sharedDimension"){J=K;}else{if(E=="level"){J=K.parentNode;}else{if(E=="attribute"){J=K.parentNode.parentNode;}}}if(D.getNodeById(J.id)){return true;}else{var G=false;J.eachChild(function(O){if(O.disabled){G=true;return ;}});if(G){return false;}}}return true;}}return false;},__moveTreeItem:function(P,C){var L=this.__getSelectedNodesForMove(P);if(L&&L.length>0){for(var S=0;S<L.length;S++){var T=L[S];var G=T.attributes.type;var E;if(P==this._dimensionsTree||P==this._measuresTree){if(G=="measure"){E=C.getRootNode().appendChild({id:T.id,title:T.attributes.title,text:T.text,type:T.attributes.type,aggrFunctionValue:T.attributes.aggregationFunction,uiProvider:actuate.widget.custom.CrosstabBuilderTreeNodeUI});E.ui.showDropDownArrow(false);T.disable();}else{if(G=="dimension"||G=="sharedDimension"){E=C.getNodeById(T.id);if(!E){E=C.getRootNode().appendChild({id:T.id,text:T.text,title:T.text,type:G});}this._nodeCopy(T,E);T.disable();}else{var B;if(G=="level"){B=T.parentNode;E=C.getNodeById(B.id);if(!E){E=C.getRootNode().appendChild({id:B.id,text:B.text,type:B.attributes.type});}var H=this.__findLevelInsertNode(E,T.cubeLevelIndex);if(H){E=E.insertBefore({id:T.id,text:T.text,type:T.attributes.type},H);}else{E=E.appendChild({id:T.id,text:T.text,type:T.attributes.type});}E.cubeLevelIndex=T.cubeLevelIndex;}else{var D=T.parentNode;B=D.parentNode;var M=C.getNodeById(D.id);if(!M){var J=C.getNodeById(B.id);if(!J){J=C.getRootNode().appendChild({id:B.id,text:B.text,type:B.attributes.type});}var H=this.__findLevelInsertNode(J,D.cubeLevelIndex);if(H){M=J.insertBefore({id:D.id,text:D.text,type:D.attributes.type},H);}else{M=J.appendChild({id:D.id,text:D.text,type:D.attributes.type});}M.cubeLevelIndex=D.cubeLevelIndex;}E=M.appendChild({text:T.text,type:T.attributes.type});T.parentNode.disable();}T.disable();this._resetParentNodeEnableState(B);}}this._selectNodeAfterMoving(T);}else{if(P==this._linkedDatasetTree){if(C==this._selectedMeasuresTree){var Y=[];if(G=="folder"){Y=T.childNodes;}else{Y.push(T);}for(var R=0;R<Y.length;R++){var X=Y[R];var K=X.attributes.realMeasure;if(K){var F=K.aggregationFunction.toUpperCase();var U=K.name;var A=X.id+"("+F+")";var W=false;if(U!=A){W=true;}if(!C.getNodeById(U)){E=C.getRootNode().appendChild({id:U,title:"",text:U,type:"measure",aggrFunctionValue:F,groupId:X.id,isSelfDefinedMeasureName:W,dataType:X.attributes.dataType,uiProvider:actuate.widget.custom.CrosstabBuilderTreeNodeUI});E.ui.popupMenu=true;}X.attributes.realMeasure=null;}else{var F=this._getDefaultAggrFunction(X.id,X.attributes.dataType);if(F==null){actuate.widget.MessageBox.show({title:actuate.util.Utility.getLocalizedString("crosstabBuilderDialog.alertTitle"),msg:actuate.util.Utility.getLocalizedString("crosstabBuilderDialog.message.emptySubtotalFunctions"),buttons:actuate.widget.MessageBox.OK});return ;}var U=X.id+"("+F+")";if(!C.getNodeById(U)){E=C.getRootNode().appendChild({id:X.id+"("+F+")",title:"",text:X.text+"("+F+")",type:"measure",aggrFunctionValue:F,groupId:X.id,dataType:X.attributes.dataType,uiProvider:actuate.widget.custom.CrosstabBuilderTreeNodeUI});E.ui.popupMenu=true;}}}}else{var V=[];if(G!="folder"){V.push(T);}else{for(var O=0;O<T.childNodes.length;O++){var I=T.childNodes[O];if(!this._rowsTree.getNodeById(I.id)&&!this._columnsTree.getNodeById(I.id)){V.push(I);}}}for(var R=0;R<V.length;R++){var B=V[R];E=C.getNodeById(B.id);if(!E){if(this._util.isDateDataType(B.attributes.dataType)){E=C.getRootNode().appendChild({id:B.id,text:B.text,title:B.text,aggrFunctionValue:"DATEGROUP",isDateInterval:"true",dataType:B.attributes.dataType,uiProvider:actuate.widget.custom.CrosstabBuilderTreeNodeUI,type:"dimension"});E.ui.popupMenu=true;}else{E=C.getRootNode().appendChild({id:B.id,text:B.text,title:B.text,dataType:B.attributes.dataType,aggrFunctionValue:"",isDateInterval:"false",uiProvider:actuate.widget.custom.CrosstabBuilderTreeNodeUI,type:"dimension"});E.ui.popupMenu=false;E.ui.showDropDownArrow(false);}}}}this._selectNodeAfterMoving(T);}else{var Q=T.parentNode;if(G!="attribute"){E=C.getNodeById(T.id);if(E&&(G=="level"||E.attributes.type=="0")){E.parentNode.enable();}}else{var N=C.getNodeById(Q.id);if(N){N.eachChild(function(Z){if(Z.text==T.text){E=Z;return false;}});N.parentNode.enable();}}if(E){E.cascade(function(Z){Z.enable();});}T.toBeDeleted=true;if((G=="level"||Q.attributes.type=="folder")&&Q.childNodes.length==1){Q.toBeDeleted=true;}else{Q.toBeDeleted=false;}this._selectNodeAfterMoving(T);Q.removeChild(T);if(Q.toBeDeleted){Q.parentNode.removeChild(Q);}}}if(E){if(G=="dimension"||G=="sharedDimension"||G=="folder"){if(this.displayAttributeItem==true){E.expand(true);}else{E.expand();}}else{if(G!="measure"){if(G=="attribute"){E.parentNode.parentNode.expand();}E.parentNode.expand();}}E.select();}}this.__checkButtonState(P);this.__checkButtonState(C);}},_selectNodeAfterMoving:function(C,B,A){if(!C||C.isRoot){return true;}if(C==B){return false;}if(!this._isLinkedDataset||A==true){if(!C.disabled&&!C.toBeDeleted){C.select();return true;}}if(!B){B=C;}if(C.nextSibling){if(this._selectNodeAfterMoving(C.nextSibling,B,true)){return true;}}else{if((!this._isLinkedDataset||C.getOwnerTree()!=this._linkedDatasetTree)&&this._selectNodeAfterMoving(C.parentNode.firstChild,B,true)){return true;}else{return this._selectNodeAfterMoving(C.parentNode);}}return false;},__findLevelInsertNode:function(A,B){if(!A.hasChildNodes()){return null;}if(!(typeof (B)=="number")){return null;}var E=A.childNodes;for(var D=0;D<E.length;D++){var C=E[D].cubeLevelIndex;if(typeof (C)=="number"&&C>B){return E[D];}}return null;},_nodeCopy:function(A,G,F){if(!A||!G){return ;}if(A.hasChildNodes()){var H=A.childNodes;for(var E=0;E<H.length;E++){var D=G.getOwnerTree().getNodeById(H[E].id);if(!D){var C=this.__findLevelInsertNode(G,H[E].cubeLevelIndex);var B=H[E].attributes.type;if(F){B=F;}if(C){D=G.insertBefore({id:H[E].id,text:H[E].text,type:B},C);}else{D=G.appendChild({id:H[E].id,text:H[E].text,type:B});}D.cubeLevelIndex=H[E].cubeLevelIndex;H[E].disable();}H[E].eachChild(function(J){if(!J.disabled){var I=J.attributes.type;D.appendChild({text:J.text,type:I});J.disable();}});}}},createSoapNode:function(H,G){if(G){if(this._selectedIid){G.documentElement.setAttribute("iid",this._selectedIid);}var R=actuate.util.XmlDom.createElement(G,"Cube");var S=this.__getSelectedDataSourceInfo();var I=S[1].name;var A=S[0];if(!A){A="";}var L=S[2];var Q=actuate.util.XmlDom.createElement(G,"Name");var N=G.createTextNode(I);Q.appendChild(N);R.appendChild(Q);var T=actuate.util.XmlDom.createElement(G,"DataSource");Q=actuate.util.XmlDom.createElement(G,"Name");N=G.createTextNode(A);Q.appendChild(N);T.appendChild(Q);Q=actuate.util.XmlDom.createElement(G,"DataMartName");N=G.createTextNode(L);Q.appendChild(N);T.appendChild(Q);var J=S[4];if(J){var P=(J.toLowerCase()=="data")?actuate.dialog.impl.constant.DataMartAccessType.LATEST:actuate.dialog.impl.constant.DataMartAccessType.TRANSIENT;var C=actuate.util.XmlDom.createElement(G,"Type");C.appendChild(G.createTextNode(P));T.appendChild(C);}R.appendChild(T);G.documentElement.appendChild(R);var F=actuate.util.XmlDom.createElement(G,"Crosstab");Q=actuate.util.XmlDom.createElement(G,"CubeName");N=G.createTextNode(I);Q.appendChild(N);F.appendChild(Q);var D=actuate.util.XmlDom.createElement(G,"Rows");this._createDimensionsSoapNode(D,G,this._rowsTree,0);F.appendChild(D);var U=actuate.util.XmlDom.createElement(G,"Columns");this._createDimensionsSoapNode(U,G,this._columnsTree,1);F.appendChild(U);var K=actuate.util.XmlDom.createElement(G,"Measures");this._createMeasuresSoapNode(K,G);F.appendChild(K);G.documentElement.appendChild(F);this.__addFilterSoap(G.documentElement);var V=actuate.util.XmlDom.createElement(G,actuate.Constant.tag.Json);var B=null;if(this._dataManagerSoap){var O=this._dataManagerSoap.childNodes[0].data;B=O.substr(0,O.length-1)+",";}var E=actuate.util.Json;if(!this._hyperlinkCheckbox.disabled){if(B){B+="UseHyperlink:";}else{B="{UseHyperlink:";}var M={};M.value=this._hyperlinkCheckbox.getValue().toString();B+=E.makeMap(M)+"}";}else{if(B){B+="}";}else{B="{}";}}var N=G.createTextNode(B);V.appendChild(N);G.documentElement.appendChild(V);}},_createDimensionsSoapNode:function(M,D,K,H){if(this._isLinkedDataset){this._createDimensionsSoapNodeForLinkedDataSet(M,D,K,H);return ;}var S=K.getRootNode();if(S.hasChildNodes()){var L=0;var T=S.childNodes;for(var Q=0;Q<T.length;Q++){var A=T[Q];if(A.hasChildNodes()){var C=actuate.util.XmlDom.createElement(D,"DimensionView");M.appendChild(C);var R=actuate.util.XmlDom.createElement(D,"Index");var N=D.createTextNode(""+L);R.appendChild(N);C.appendChild(R);var J=actuate.util.XmlDom.createElement(D,"AxisType");N=D.createTextNode(""+H);J.appendChild(N);C.appendChild(J);var I=actuate.util.XmlDom.createElement(D,"Dimension");N=D.createTextNode(A.text);I.appendChild(N);C.appendChild(I);var O=actuate.util.XmlDom.createElement(D,"Levels");C.appendChild(O);var F=A.childNodes;for(var P=0;P<F.length;P++){var G=actuate.util.XmlDom.createElement(D,"LevelView");O.appendChild(G);var B=actuate.util.XmlDom.createElement(D,"Index");N=D.createTextNode(""+P);B.appendChild(N);G.appendChild(B);var E=actuate.util.XmlDom.createElement(D,"LevelName");N=D.createTextNode(F[P].text);E.appendChild(N);G.appendChild(E);var U=actuate.util.XmlDom.createElement(D,"LevelAttributes");G.appendChild(U);F[P].eachChild(function(Z){var V=actuate.util.XmlDom.createElement(D,"Attribute");U.appendChild(V);var W=actuate.util.XmlDom.createElement(D,"Name");N=D.createTextNode(Z.text);W.appendChild(N);V.appendChild(W);var X=Z.attributes.itemId;if(X){var Y=actuate.util.XmlDom.createElement(D,"ItemId");N=D.createTextNode(X);Y.appendChild(N);V.appendChild(Y);}});}L++;}}}},_createDimensionsSoapNodeForLinkedDataSet:function(K,D,J,G){var R=J.getRootNode();if(R.hasChildNodes()){var T=[];var U=R.childNodes;for(var O=0;O<U.length;O++){var S=U[O];if(S.attributes.type=="folder"&&S.hasChildNodes()){for(var N=0;N<S.childNodes.length;N++){T.push(S.childNodes[N]);}}else{T.push(S);}}for(var O=0;O<T.length;O++){var A=T[O];var C=actuate.util.XmlDom.createElement(D,"DimensionView");K.appendChild(C);var Q=actuate.util.XmlDom.createElement(D,"Index");var L=D.createTextNode(""+O);Q.appendChild(L);C.appendChild(Q);var I=actuate.util.XmlDom.createElement(D,"AxisType");L=D.createTextNode(""+G);I.appendChild(L);C.appendChild(I);var H=actuate.util.XmlDom.createElement(D,"Dimension");L=D.createTextNode(A.text);H.appendChild(L);C.appendChild(H);var M=actuate.util.XmlDom.createElement(D,"Levels");C.appendChild(M);if(this._util.isDateDataType(A.attributes.dataType)&&A.attributes.timeLevels&&A.attributes.timeLevels.length>0){var P=actuate.util.XmlDom.createElement(D,"IsTimeType");L=D.createTextNode("true");P.appendChild(L);C.appendChild(P);for(var N=0;N<A.attributes.timeLevels.length;N++){var F=actuate.util.XmlDom.createElement(D,"LevelView");M.appendChild(F);var B=actuate.util.XmlDom.createElement(D,"Index");L=D.createTextNode(""+N);B.appendChild(L);F.appendChild(B);var E=actuate.util.XmlDom.createElement(D,"LevelName");L=D.createTextNode(A.attributes.timeLevels[N]);E.appendChild(L);F.appendChild(E);}}else{var F=actuate.util.XmlDom.createElement(D,"LevelView");M.appendChild(F);var B=actuate.util.XmlDom.createElement(D,"Index");L=D.createTextNode(""+0);B.appendChild(L);F.appendChild(B);var E=actuate.util.XmlDom.createElement(D,"LevelName");L=D.createTextNode(A.text);E.appendChild(L);F.appendChild(E);}}}},_createMeasuresSoapNode:function(L,H){var E=this._selectedMeasuresTree.getRootNode();if(E.hasChildNodes()){var B=E.childNodes;for(var G=0;G<B.length;G++){var D=actuate.util.XmlDom.createElement(H,"MeasureView");L.appendChild(D);var A=actuate.util.XmlDom.createElement(H,"Index");var F=H.createTextNode(""+G);A.appendChild(F);D.appendChild(A);var C=actuate.util.XmlDom.createElement(H,"MeasureName");F=H.createTextNode(unescape(B[G].id));C.appendChild(F);D.appendChild(C);if(this._isLinkedDataset){var J=actuate.util.XmlDom.createElement(H,"Aggregation");var I=actuate.util.XmlDom.createElement(H,"Function");F=H.createTextNode(B[G].attributes.aggrFunctionValue);I.appendChild(F);J.appendChild(I);D.appendChild(J);var K=actuate.util.XmlDom.createElement(H,"DataField");F=H.createTextNode(unescape(B[G].attributes.groupId));K.appendChild(F);D.appendChild(K);}}}},validate:function(){if(!this._isSelectedCubeData()){actuate.widget.MessageBox.alert(actuate.util.Utility.getLocalizedString("crosstabBuilderDialog.alertTitle"),actuate.util.Utility.getLocalizedString("crosstabBuilderDialog.message.blankCubeName"));return false;}var B=this._rowsTree.getRootNode();var A=this._columnsTree.getRootNode();if(!B.hasChildNodes()&&!A.hasChildNodes()){actuate.widget.MessageBox.alert(actuate.util.Utility.getLocalizedString("crosstabBuilderDialog.alertTitle"),actuate.util.Utility.getLocalizedString("crosstabBuilderDialog.message.noDimension"));return false;}return true;},_changeFilterPanel:function(B){if(this._parentDialog._filterPanel){var C={};var A=this.__getSelectedDataSourceInfo();if(A){C.dataObject=[A[1],A[4],A[3]];C.dataObjectSoap=this.createCubeSoap(A);C.dataMartSoap=this._dataManagerSoap;C.clearFilterUI=this._clearFilterUI;C.target="Crosstab";}if(this._filter){C.Filter=this._filter;}this._parentDialog._filterPanel.loadData(C);}},createCubeSoap:function(F){var G=actuate.util.XmlDom.createXMLDom(actuate.util.Constants.soap.NAMESPACE_ACTUATE10,actuate.Constant.tag.Data);var D=F[0];if(!D){D="";}var J=F[1].name;var H=F[2];var E=actuate.util.XmlDom.createElement(G,"Cube");var B=actuate.util.XmlDom.createElement(G,"Name");var C=G.createTextNode(J);B.appendChild(C);E.appendChild(B);var A=actuate.util.XmlDom.createElement(G,"DataSource");var K=actuate.util.XmlDom.createElement(G,"DisplayName");C=G.createTextNode(D);K.appendChild(C);A.appendChild(K);var I=actuate.util.XmlDom.createElement(G,"DataMartName");C=G.createTextNode(H);I.appendChild(C);A.appendChild(I);E.appendChild(A);return E;},_resetParentNodeEnableState:function(B){var A=false;B.cascade(function(C){if(C!=B&&!C.disabled){A=true;return false;}});if(A){B.enable();}else{B.disable();}},updateDataPanelUI:function(){if(this._isLinkedDataset){this.linkedDataPanel.show();this.dataPanelContainer.showHeaderLine();this._dimensionsTree.hide();this._measuresTree.hide();this.measureTreeLabel.hide();this.dimensionTreeLabel.hide();this.dimensionsFieldSet.header.hide();this.measuresFieldSet.header.hide();this.dimensionsFieldSet.hideHeaderLine();this.measuresFieldSet.hideHeaderLine();this.dimensionsFieldSet.disableBodyMarginLeft();this.measuresFieldSet.disableBodyMarginLeft();}else{this.linkedDataPanel.hide();this.dataPanelContainer.hideHeaderLine();this._dimensionsTree.show();this._measuresTree.show();this.measureTreeLabel.show();this.dimensionTreeLabel.show();this.dimensionsFieldSet.header.show();this.measuresFieldSet.header.show();this.dimensionsFieldSet.showHeaderLine();this.measuresFieldSet.showHeaderLine();this.dimensionsFieldSet.enableBodyMarginLeft();this.measuresFieldSet.enableBodyMarginLeft();}},_updateLinkedDatasetContent:function(I){this.updateDataPanelUI();if(!I){return ;}var B=I[1].linkedDataModel;if(B){var G=B.categories;if(G){for(var E=0;E<G.length;E++){var A=G[E];var F=this._linkedDatasetTree.getRootNode().appendChild({id:escape(A.name),text:A.name,type:"folder"});var C=A.categoryColumns;for(var D=0;D<C.length;D++){var H=C[D];F.appendChild({id:escape(H.name),text:H.name,dataType:H.dataType,type:0});}}}}this._linkedDatasetTree.expandAll();if(this._crosstab&&this._cube&&this._isExistedCube(I)){this._updateLinkedDatasetDimension(this._crosstab.rows,this._rowsTree);this._updateLinkedDatasetDimension(this._crosstab.columns,this._columnsTree);this._updateLinkedDatasetMeasure(this._crosstab.measures);}},_updateLinkedDatasetDimension:function(A,D){if(A&&A.length>0){for(var F=0;F<A.length;F++){var H=A[F];var K=H.dimensionName;var J=this._linkedDatasetTree.getNodeById(escape(K));if(J){J.select(true);}}}this.__moveTreeItem(this._linkedDatasetTree,D,true);this._linkedDatasetTree.getSelectionModel().clearSelections();var B=D.getRootNode();if(B.hasChildNodes()){var I=[];var C=B.childNodes;for(var F=0;F<C.length;F++){var M=C[F];if(M.attributes.type=="folder"&&M.hasChildNodes()){for(var E=0;E<M.childNodes.length;E++){I.push(M.childNodes[E]);}}else{I.push(M);}}for(var F=0;F<I.length;F++){if(A[F].isTimeType==true){var G=[];var L=A[F].levels;for(var E=0;E<L.length;E++){G.push(L[E].levelName);}I[F].attributes.timeLevels=G;}}}},_updateLinkedDatasetMeasure:function(D){if(D&&D.length>0){for(var A=0;A<D.length;A++){var B=D[A];if(B.isLinkedDataModelMeasureView){var C=this._linkedDatasetTree.getNodeById(escape(B.dataField));if(C){C.attributes.realMeasure=B;C.select(true);this.__moveTreeItem(this._linkedDatasetTree,this._selectedMeasuresTree,true);this._linkedDatasetTree.getSelectionModel().clearSelections();}}}}},_linkedDataSetTreeClick:function(D,E){this._rightButtonRows.setDisabled(true);this._rightButtonColumns.setDisabled(true);this._rightButtonMeasures.setDisabled(true);if(D){if(D.attributes.type=="folder"){var B=0;var F=D.childNodes;for(var C=0;C<F.length;C++){var A=F[C];if(this._rowsTree.getNodeById(A.id)||this._columnsTree.getNodeById(A.id)){B++;}}if(B<F.length){this._rightButtonColumns.setDisabled(false);this._rightButtonRows.setDisabled(false);}}else{if(!this._rowsTree.getNodeById(D.id)&&!this._columnsTree.getNodeById(D.id)){this._rightButtonColumns.setDisabled(false);this._rightButtonRows.setDisabled(false);}}this._rightButtonMeasures.setDisabled(false);}},_getDefaultAggrFunction:function(F,H){var I=[];var B=new actuate.widget.custom.CrosstabBuilderTreeNodeUI();var C=this._selectedMeasuresTree.getRootNode();var E=C.childNodes;for(var G=0;G<E.length;G++){var J=E[G];if(J.attributes.groupId==F){I.push(J.attributes.aggrFunctionValue);}}var A=B.numericFunctionList;if(!this._util.isNumericalType(H)){A=B.nonNumericFunctionList;}for(var G=0;G<A.length;G++){var D=A[G].value;if(!actuate.util.Utility.arrayContains(I,D)){return D;}}return null;},_noComma:null});