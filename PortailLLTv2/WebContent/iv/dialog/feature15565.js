actuate.util.Package.define("actuate.dialog.impl.helper.flexcomponentbuilder");actuate.dialog.impl.helper.flexcomponentbuilder.FlexCrosstabDataTab=actuate.Class.extendClass(actuate.dialog.impl.helper.AbstractDataTabDialog,{_classname:"actuate.dialog.impl.helper.flexcomponentbuilder.FlexCrosstabDataTab",_crosstab:null,_cube:null,formatPanel:null,_selectedIid:null,_dataManagerSoap:null,_filter:null,_hasNewDatamart:false,_height:520,UP_DOWN_BUTTON_CLS:"actuate_table_builder_up_down_buttons",UP_ENABLE_ICON:"dashboard/images/gadgets/table/up-arrow.gif",UP_DISABLE_ICON:"dashboard/images/gadgets/table/up-arrow-gray.gif",DOWN_ENABLE_ICON:"dashboard/images/gadgets/table/down-arrow.gif",DOWN_DISABLE_ICON:"dashboard/images/gadgets/table/down-arrow-gray.gif",_TOOLTIP:{UP:actuate.util.Utility.getLocalizedString("crosstabBuilderDialog.tooltip.up"),DOWN:actuate.util.Utility.getLocalizedString("crosstabBuilderDialog.tooltip.down"),ADD:actuate.util.Utility.getLocalizedString("crosstabBuilderDialog.tooltip.add"),REMOVE:actuate.util.Utility.getLocalizedString("crosstabBuilderDialog.tooltip.remove")},initialize:function(){this.id=this._getId(this._classname);this._util=actuate.util.Utility;this._title=this._util.getLocalizedString("crosstabBuilderDialog.dataTab.title");this._componentArray=[];this._crosstab=null;this._selectedIid=null;this._dataManagerSoap=null;actuate.dialog.impl.helper.AbstractTabDialog.prototype.initialize.call(this);this.__initDataSourceCombo();this._panel.on("activate",actuate.Method.bind(this.onActivate,this));},_initContent:function(){var D=this;var I="";var G={xtype:"fieldset",collapsible:true,title:this._util.getLocalizedString("crosstabBuilderDialog.dataTab.cube"),checkboxToggle:false,defaults:{border:false,header:false,layout:"table",bodyStyle:"padding:2px;"},cls:"actuate-widget-panle-zero-margin-top",listeners:{collapse:function(){if(D._parentDialog&&D._parentDialog.adjustSize){D._parentDialog.adjustSize();}},expand:function(){if(D._parentDialog&&D._parentDialog.adjustSize){D._parentDialog.adjustSize();}}},items:[{items:[{xtype:"label",text:this._util.getLocalizedString("crosstabBuilderDialog.dataTab.cubeLabel"),style:I},{id:"actuate_dialog_FlexCrosstabDataTab_cubeCombo"}]}]};this._componentArray.push(G);this._cubeCombo=new actuate.widget.custom.TreeCombo.TreeComboBox({editable:false,width:405,forceSelection:true,autoExpand:true,valueField:"value",displayField:"title",titleField:"title",icons:this.__dataSourceIcons,sortInfo:{folderSort:true,field:"text",direction:"ASC"},showTooltip:true,store:new actuate.widget.custom.TreeCombo.TreeComboStore(this.__dataSourceComboStore)});G.items[0].items[1]=this._cubeCombo;var N="<img src='"+actuate.widget.BLANK_IMAGE_URL+"' name='crosstabRow' class='actuate_crosstab_builder_row_image'/>";var F="<img src='"+actuate.widget.BLANK_IMAGE_URL+"' name='crosstabColumn' class='actuate_crosstab_builder_column_image'/>";var M={xtype:"fieldset",collapsible:true,title:this._util.getLocalizedString("crosstabBuilderDialog.dataTab.dimensions"),cls:"actuate-widget-panle-zero-margin-top",layout:"table",layoutConfig:{columns:4},listeners:{collapse:function(){if(D._parentDialog&&D._parentDialog.adjustSize){D._parentDialog.adjustSize();}},expand:function(){if(D._parentDialog&&D._parentDialog.adjustSize){D._parentDialog.adjustSize();}}},items:[{colspan:2,xtype:"label",text:this._util.getLocalizedString("crosstabBuilderDialog.dataTab.dataLabel"),style:I},{layout:"table",colspan:2,border:false,items:[{html:N,border:false},{xtype:"label",text:this._util.getLocalizedString("crosstabBuilderDialog.dataTab.row"),style:I}]},{id:"actuate_dialog_FlexCrosstabDataTab_dimensions_tree",rowspan:3},{border:false,items:[{id:"actuate_dialog_FlexCrosstabDataTab_dimensions_rightButtonRows"},{id:"actuate_dialog_FlexCrosstabDataTab_dimensions_leftButtonRows"}]},{id:"actuate_dialog_FlexCrosstabDataTab_dimensions_treeRows"},{border:false,items:[{id:"actuate_dialog_FlexCrosstabDataTab_dimensions_upButtonRows"},{id:"actuate_dialog_FlexCrosstabDataTab_dimensions_downButtonRows"}]},{xtype:"label",text:""},{layout:"table",colspan:2,border:false,items:[{html:F,border:false},{xtype:"label",text:this._util.getLocalizedString("crosstabBuilderDialog.dataTab.column"),style:I}]},{border:false,items:[{id:"actuate_dialog_FlexCrosstabDataTab_dimensions_rightButtonColumns"},{id:"actuate_dialog_FlexCrosstabDataTab_dimensions_leftButtonColumns"}]},{id:"actuate_dialog_FlexCrosstabDataTab_dimensions_treeColumns"},{border:false,items:[{id:"actuate_dialog_FlexCrosstabDataTab_dimensions_upButtonColumns"},{id:"actuate_dialog_FlexCrosstabDataTab_dimensions_downButtonColumns"}]}]};var L=[{type:0,iconCls:"actuate_data_column_image"},{type:"dimensions",iconCls:"actuate_dimensions_image"},{type:"dimension",iconCls:"actuate_dimension_image"},{type:"sharedDimension",iconCls:"actuate_shared_dimension_image"},{type:"level",iconCls:"actuate_level_image"},{type:"attribute",iconCls:"actuate_attribute_image"},{type:"measures",iconCls:"actuate_measures_image"},{type:"measure",iconCls:"actuate_measure_image"}];var J=new actuate.widget.tree.TreePanel({rowspan:3,autoScroll:true,width:265,height:165,rootVisible:false,containerScroll:true,dataStore:new actuate.widget.tree.TreeStore([]),selModel:new actuate.widget.tree.MultiSelectionModel(),icons:L});M.items[2]=J;this._rightButtonRows=new actuate.uiadapter.Button({text:">",disabled:true,tooltip:this._TOOLTIP.ADD});M.items[3].items[0]=this._rightButtonRows;this._leftButtonRows=new actuate.uiadapter.Button({text:"<",disabled:true,tooltip:this._TOOLTIP.REMOVE});M.items[3].items[1]=this._leftButtonRows;var C=new actuate.widget.tree.TreePanel({autoScroll:true,width:265,height:70,rootVisible:false,containerScroll:true,dataStore:new actuate.widget.tree.TreeStore([]),selModel:new actuate.widget.tree.MultiSelectionModel(),icons:L});M.items[4]=C;this._upButtonRows=new actuate.uiadapter.Button({cls:this.UP_DOWN_BUTTON_CLS,icon:this.UP_DISABLE_ICON,tooltip:this._TOOLTIP.UP});M.items[5].items[0]=this._upButtonRows;this._downButtonRows=new actuate.uiadapter.Button({cls:this.UP_DOWN_BUTTON_CLS,icon:this.DOWN_DISABLE_ICON,tooltip:this._TOOLTIP.DOWN});M.items[5].items[1]=this._downButtonRows;this._rightButtonColumns=new actuate.uiadapter.Button({text:">",disabled:true,tooltip:this._TOOLTIP.ADD});M.items[8].items[0]=this._rightButtonColumns;this._leftButtonColumns=new actuate.uiadapter.Button({text:"<",disabled:true,tooltip:this._TOOLTIP.REMOVE});M.items[8].items[1]=this._leftButtonColumns;var K=new actuate.widget.tree.TreePanel({autoScroll:true,width:265,height:70,rootVisible:false,containerScroll:true,dataStore:new actuate.widget.tree.TreeStore([]),selModel:new actuate.widget.tree.MultiSelectionModel(),icons:L});M.items[9]=K;this._upButtonColumns=new actuate.uiadapter.Button({cls:this.UP_DOWN_BUTTON_CLS,icon:this.UP_DISABLE_ICON,tooltip:this._TOOLTIP.UP});M.items[10].items[0]=this._upButtonColumns;this._downButtonColumns=new actuate.uiadapter.Button({cls:this.UP_DOWN_BUTTON_CLS,icon:this.DOWN_DISABLE_ICON,tooltip:this._TOOLTIP.DOWN});M.items[10].items[1]=this._downButtonColumns;this._componentArray.push(M);var E="<img src='"+actuate.widget.BLANK_IMAGE_URL+"' name='crosstabSummary' class='actuate_crosstab_builder_summary_image'/>";var A={xtype:"fieldset",collapsible:true,title:this._util.getLocalizedString("crosstabBuilderDialog.dataTab.measures"),cls:"actuate-widget-panle-zero-margin-top",layout:"table",layoutConfig:{columns:4},listeners:{collapse:function(){if(D._parentDialog&&D._parentDialog.adjustSize){D._parentDialog.adjustSize();}},expand:function(){if(D._parentDialog&&D._parentDialog.adjustSize){D._parentDialog.adjustSize();}}},items:[{colspan:2,xtype:"label",text:this._util.getLocalizedString("crosstabBuilderDialog.dataTab.dataLabel"),style:I},{layout:"table",colspan:2,border:false,items:[{html:E,border:false},{xtype:"label",text:this._util.getLocalizedString("crosstabBuilderDialog.dataTab.summary"),style:I}]},{id:"actuate_dialog_FlexCrosstabDataTab_measures_tree"},{border:false,items:[{id:"actuate_dialog_FlexCrosstabDataTab_measures_rightButton"},{id:"actuate_dialog_FlexCrosstabDataTab_measures_leftButton"}]},{id:"actuate_dialog_FlexCrosstabDataTab_measures_treeSelected"},{border:false,items:[{id:"actuate_dialog_FlexCrosstabDataTab_measures_upButton"},{id:"actuate_dialog_FlexCrosstabDataTab_measures_downButton"}]}]};var H=new actuate.widget.tree.TreePanel({autoScroll:true,width:265,height:70,rootVisible:false,containerScroll:true,dataStore:new actuate.widget.tree.TreeStore([]),selModel:new actuate.widget.tree.MultiSelectionModel(),icons:L});A.items[2]=H;this._rightButtonMeasures=new actuate.uiadapter.Button({text:">",disabled:true,tooltip:this._TOOLTIP.ADD});A.items[3].items[0]=this._rightButtonMeasures;this._leftButtonMeasures=new actuate.uiadapter.Button({text:"<",disabled:true,tooltip:this._TOOLTIP.REMOVE});A.items[3].items[1]=this._leftButtonMeasures;var B=new actuate.widget.tree.TreePanel({autoScroll:true,width:265,height:70,rootVisible:false,containerScroll:true,dataStore:new actuate.widget.tree.TreeStore([]),selModel:new actuate.widget.tree.MultiSelectionModel(),icons:L});A.items[4]=B;this._upButtonMeasures=new actuate.uiadapter.Button({cls:this.UP_DOWN_BUTTON_CLS,icon:this.UP_DISABLE_ICON,tooltip:this._TOOLTIP.UP});A.items[5].items[0]=this._upButtonMeasures;this._downButtonMeasures=new actuate.uiadapter.Button({cls:this.UP_DOWN_BUTTON_CLS,icon:this.DOWN_DISABLE_ICON,tooltip:this._TOOLTIP.DOWN});A.items[5].items[1]=this._downButtonMeasures;this._componentArray.push(A);this._dimensionsTree=J;this._rowsTree=C;this._columnsTree=K;this._measuresTree=H;this._selectedMeasuresTree=B;this._dimensionsTree.registerEventHandler("click",actuate.Method.bind(this._dimensionsTreeClick,this),false);this._rowsTree.registerEventHandler("click",actuate.Method.bind(this._rowsTreeClick,this),false);this._columnsTree.registerEventHandler("click",actuate.Method.bind(this._columnsTreeClick,this),false);this._measuresTree.registerEventHandler("click",actuate.Method.bind(this._measuresTreeClick,this),false);this._selectedMeasuresTree.registerEventHandler("click",actuate.Method.bind(this._selectedMeasuresTreeClick,this),false);this._rightButtonRows.registerEventHandler("click",actuate.Method.bind(this._rightButtonRowsClick,this),false);this._leftButtonRows.registerEventHandler("click",actuate.Method.bind(this._leftButtonRowsClick,this),false);this._upButtonRows.registerEventHandler("click",actuate.Method.bind(this._upButtonRowsClick,this),false);this._downButtonRows.registerEventHandler("click",actuate.Method.bind(this._downButtonRowsClick,this),false);this._rightButtonColumns.registerEventHandler("click",actuate.Method.bind(this._rightButtonColumnsClick,this),false);this._leftButtonColumns.registerEventHandler("click",actuate.Method.bind(this._leftButtonColumnsClick,this),false);this._upButtonColumns.registerEventHandler("click",actuate.Method.bind(this._upButtonColumnsClick,this),false);this._downButtonColumns.registerEventHandler("click",actuate.Method.bind(this._downButtonColumnsClick,this),false);this._rightButtonMeasures.registerEventHandler("click",actuate.Method.bind(this._rightButtonMeasuresClick,this),false);this._leftButtonMeasures.registerEventHandler("click",actuate.Method.bind(this._leftButtonMeasuresClick,this),false);this._upButtonMeasures.registerEventHandler("click",actuate.Method.bind(this._upButtonMeasuresClick,this),false);this._downButtonMeasures.registerEventHandler("click",actuate.Method.bind(this._downButtonMeasuresClick,this),false);},__createDataSourceCombo:function(){return this._cubeCombo;},onActivate:function(){var A=this._parentDialog.getWindow();A.setHeight(this._height);},loadData:function(B,A){this._hasNewDatamart=false;this.formatPanel=A;if(B.Element&&B.Element.iid){this._selectedIid=B.Element.iid;}else{this._selectedIid=null;}if(B&&B.DataMarts){this._data=B;this.__showAllDataSources();if(this._parentDialog&&this._parentDialog._consumer&&this._parentDialog._consumer._service&&this._parentDialog._consumer._service._instanceId){return ;}}this._resetContent();if(this._data&&this._data.DataMarts&&this._data.DataMarts.length>0){this._crosstab=null;if(B.DACrosstab){this._crosstab=B.DACrosstab;}if(B.Cube){if(!B.Cube.dataObject){B.Cube.dataObject=B.Cube.cubeName;}this.__selectDataSource(B.Cube,"cube");this._cube=B.Cube;}this.__onSelectDataSource();if(B.Filter){this._filter=B.Filter;}}},__addToDataSourceStore:function(A,B,C){if(B!="dataset"){actuate.dialog.impl.helper.flexcomponentbuilder.FlexCrosstabDataTab.superclass.__addToDataSourceStore.call(this,A,B,C);}},_isSelectedCubeData:function(){var A=this.__dataSourceCombo.getValue();if(!A||A.id=="newData"){return false;}return true;},_isExistedCube:function(B){if(!B||!this._cube||!this._cube.dataMart){return false;}var C=B[2]+"."+B[4]+"-"+B[1].name;var A=this._cube.dataMart.fileName+"."+this._cube.dataMart.extension+"-"+this._cube.dataObject;if(C==A){return true;}return false;},_updateContent:function(J){if(!J){return ;}this._resetContent();var F={};var G={};var B=J[1];if(this._crosstab&&this._cube&&this._isExistedCube(J)){this._updateCrosstabDimensions(this._rowsTree,this._crosstab.rows,F);this._updateCrosstabDimensions(this._columnsTree,this._crosstab.columns,F);var A=this._crosstab.measures;var C=this._selectedMeasuresTree.getRootNode();if(A&&A.length>0){for(var D=0;D<A.length;D++){G[A[D]]=A[D];C.appendChild({id:A[D],text:A[D],type:"measure"});}this._selectedMeasuresTree.expandAll();}}this._updateCubeDimensions(this._dimensionsTree,B.dimensions,F);var I=B.measures;if(I&&I.length>0){for(var E=0;E<I.length;E++){var A=I[E].measures;var C=this._measuresTree.getRootNode();if(A&&A.length>0){for(var D=0;D<A.length;D++){var H=A[D].name;C.appendChild({id:H,text:H,type:"measure",disabled:(G[H]!=null)});}}}}this._measuresTree.expandAll();},_updateCrosstabDimensions:function(Q,A,G){if(!Q){return ;}if(A&&A.length>0){for(var H=0;H<A.length;H++){var F=A[H];var O=F.dimensionName;var P=F.levels;var N=G[O];if(!N){N=new actuate.util.HashMap();G[O]=N;}var I=Q.getRootNode().appendChild({id:O,text:O,type:F.shared?"sharedDimension":"dimension"});if(P&&P.length>0){for(var E=0;E<P.length;E++){var B=P[E].fullName;var K=P[E].levelName;var J=P[E].cubeLevelIndex;var M=I.appendChild({id:B,text:K,type:"level"});M.cubeLevelIndex=J;var L=[];N.put(K,L);var D=P[E].attributes;if(D){for(var C=0;C<D.length;C++){M.appendChild({text:D[C].name,type:"attribute",itemId:D[C].itemId});L.push(D[C].name);}}}}}}Q.expandAll();},_updateCubeDimensions:function(K,G,E){if(!K){return ;}if(G&&G.length>0){for(var O=0;O<G.length;O++){var Q=G[O];var P=Q.name;var H=Q.levels;var D=E[P];var A=K.getRootNode().appendChild({id:P,text:P,type:Q.shared?"sharedDimension":"dimension"});if(H&&H.length>0){var C=-1;for(var M=0;M<H.length;M++){var R=H[M].fullName;var J=H[M].name;C++;var B=A.appendChild({id:R,text:J,type:"level",disabled:(D&&D.containsKey(J))});B.cubeLevelIndex=C;var F=D?D.get(J):null;var I=H[M].attributes;if(I){for(var L=0;L<I.length;L++){var N=I[L].name;B.appendChild({text:N,type:"attribute",disabled:F&&actuate.util.Utility.arrayContains(F,N)});}}}}this._resetDimensionNodeEnableState(A);}}K.expandAll();},_afterHide:function(){this._resetContent();this.__dataSourceCombo.clear();this.__dataSourceCombo.setValue("");this._dataManagerSoap=null;this._crosstab=null;this._cube=null;},_resetContent:function(){this._resetTree(this._dimensionsTree);this._resetTree(this._rowsTree);this._resetTree(this._columnsTree);this._resetTree(this._measuresTree);this._resetTree(this._selectedMeasuresTree);this._rightButtonRows.setDisabled(true);this._rightButtonColumns.setDisabled(true);this._leftButtonRows.setDisabled(true);this._leftButtonColumns.setDisabled(true);this._rightButtonMeasures.setDisabled(true);this._leftButtonMeasures.setDisabled(true);this._upButtonRows.setDisabled(true);if(this._upButtonRows._ele!=null){this._upButtonRows.setIcon(this.UP_DISABLE_ICON);}this._downButtonRows.setDisabled(true);if(this._downButtonRows._ele!=null){this._downButtonRows.setIcon(this.DOWN_DISABLE_ICON);}this._upButtonColumns.setDisabled(true);if(this._upButtonColumns._ele!=null){this._upButtonColumns.setIcon(this.UP_DISABLE_ICON);}this._downButtonColumns.setDisabled(true);if(this._downButtonColumns._ele!=null){this._downButtonColumns.setIcon(this.DOWN_DISABLE_ICON);}this._upButtonMeasures.setDisabled(true);if(this._upButtonMeasures._ele!=null){this._upButtonMeasures.setIcon(this.UP_DISABLE_ICON);}this._downButtonMeasures.setDisabled(true);if(this._downButtonMeasures._ele!=null){this._downButtonMeasures.setIcon(this.DOWN_DISABLE_ICON);}this.__clearFilter();},_resetTree:function(A){var B=A.getRootNode();if(B){B.clear();}A.dataStore=new actuate.widget.tree.TreeStore([]);A.getSelectionModel().clearSelections(true);},_handleDragdrop:function(B,C,A,D){},__onSelectDataSource:function(){this.__clearFilter();var A=this.__getSelectedDataSourceInfo();if(A){this._resetContent();this._updateContent(A);if(this.formatPanel){var B={};if(this._crosstab&&this._cube&&this._isExistedCube(A)){B.DACrosstab=this._crosstab;}this.formatPanel.loadData(B);}}this._clearFilterUI=true;actuate.dialog.impl.helper.flexcomponentbuilder.FlexCrosstabDataTab.superclass.__onSelectDataSource.call(this);},getDataSelection:function(){var A=this.__getSelectedDataSourceInfo();if(A&&A[1]){return{dataSourceName:A[1].name};}return null;},_getDefaultID:function(C){var D=C;if(!D||D.length<=0){D=this._data?this._data.DataMarts:null;}if(D&&D.length>0){var E=D[0];var B=E.cubes;var A;if(B&&B.length>0){A=this._createDataSourceRecord(B[0],"cube",E);}return A?A.id:null;}},_dimensionsTreeClick:function(A,B){this._rightButtonRows.setDisabled(true);this._rightButtonColumns.setDisabled(true);if(A){if(this.__allowMoveDimension(this._rowsTree,A,B)){this._rightButtonColumns.setDisabled(false);}if(this.__allowMoveDimension(this._columnsTree,A,B)){this._rightButtonRows.setDisabled(false);}}},__toggleDimensionRightButtons:function(A){this._rightButtonRows.setDisabled(true);this._rightButtonColumns.setDisabled(true);if(A){if(this.__allowMoveDimension(this._rowsTree)){this._rightButtonColumns.setDisabled(false);}if(this.__allowMoveDimension(this._columnsTree)){this._rightButtonRows.setDisabled(false);}}},_rowsTreeClick:function(A,B){this.__toggleLeftButtonRows(A);this.__toggleUpDownButton(this._rowsTree,A,B);},__toggleUpDownButton:function(B,E,F){var G=this.__getSelectedNodes(B,E,F);var C=(G&&G.length>0);if(C){var A=G[0].parentNode;for(var D=1;D<G.length;D++){if(G[D].parentNode!=A){C=false;break;}}if(C){C=A.childNodes.length>1;}}if(C){C=G[0].attributes.type!="level";}if(C){if(B==this._rowsTree){this._upButtonRows.setDisabled(false);this._upButtonRows.setIcon(this.UP_ENABLE_ICON);this._downButtonRows.setDisabled(false);this._downButtonRows.setIcon(this.DOWN_ENABLE_ICON);}else{if(B==this._columnsTree){this._upButtonColumns.setDisabled(false);this._upButtonColumns.setIcon(this.UP_ENABLE_ICON);this._downButtonColumns.setDisabled(false);this._downButtonColumns.setIcon(this.DOWN_ENABLE_ICON);}else{if(B==this._selectedMeasuresTree){this._upButtonMeasures.setDisabled(false);this._upButtonMeasures.setIcon(this.UP_ENABLE_ICON);this._downButtonMeasures.setDisabled(false);this._downButtonMeasures.setIcon(this.DOWN_ENABLE_ICON);}}}}else{if(B==this._rowsTree){this._upButtonRows.setDisabled(true);this._upButtonRows.setIcon(this.UP_DISABLE_ICON);this._downButtonRows.setDisabled(true);this._downButtonRows.setIcon(this.DOWN_DISABLE_ICON);}else{if(B==this._columnsTree){this._upButtonColumns.setDisabled(true);this._upButtonColumns.setIcon(this.UP_DISABLE_ICON);this._downButtonColumns.setDisabled(true);this._downButtonColumns.setIcon(this.DOWN_DISABLE_ICON);}else{if(B==this._selectedMeasuresTree){this._upButtonMeasures.setDisabled(true);this._upButtonMeasures.setIcon(this.UP_DISABLE_ICON);this._downButtonMeasures.setDisabled(true);this._downButtonMeasures.setIcon(this.DOWN_DISABLE_ICON);}}}}},__toggleLeftButtonRows:function(A){if(A){this._leftButtonRows.setDisabled(false);}else{this._leftButtonRows.setDisabled(true);}this.__toggleDimensionRightButtons(true);},_columnsTreeClick:function(A,B){this.__toggleLeftButtonColumns(A);this.__toggleUpDownButton(this._columnsTree,A,B);},__toggleLeftButtonColumns:function(A){if(A){this._leftButtonColumns.setDisabled(false);}else{this._leftButtonColumns.setDisabled(true);}this.__toggleDimensionRightButtons(true);},_measuresTreeClick:function(A,B){this.__toggleRightButtonMeasures(A);},__toggleRightButtonMeasures:function(A){if(A){this._rightButtonMeasures.setDisabled(false);}else{this._rightButtonMeasures.setDisabled(true);}},_selectedMeasuresTreeClick:function(A,B){this.__toggleLeftButtonMeasures(A);this.__toggleUpDownButton(this._selectedMeasuresTree,A,B);},__toggleLeftButtonMeasures:function(A){if(A){this._leftButtonMeasures.setDisabled(false);}else{this._leftButtonMeasures.setDisabled(true);}},_rightButtonRowsClick:function(){if(this.__allowMoveDimension(this._columnsTree)){this.__moveTreeItem(this._dimensionsTree,this._rowsTree,true);}},_leftButtonRowsClick:function(){this.__moveTreeItem(this._rowsTree,this._dimensionsTree,true);},_upButtonRowsClick:function(){this.__reorderTreeItem(this._rowsTree,true);},_downButtonRowsClick:function(){this.__reorderTreeItem(this._rowsTree,false);},_rightButtonColumnsClick:function(){if(this.__allowMoveDimension(this._rowsTree)){this.__moveTreeItem(this._dimensionsTree,this._columnsTree,true);}},_leftButtonColumnsClick:function(){this.__moveTreeItem(this._columnsTree,this._dimensionsTree,true);},_upButtonColumnsClick:function(){this.__reorderTreeItem(this._columnsTree,true);},_downButtonColumnsClick:function(){this.__reorderTreeItem(this._columnsTree,false);},_rightButtonMeasuresClick:function(){this.__moveTreeItem(this._measuresTree,this._selectedMeasuresTree,true);},_leftButtonMeasuresClick:function(){this.__moveTreeItem(this._selectedMeasuresTree,this._measuresTree,true);},_upButtonMeasuresClick:function(){this.__reorderTreeItem(this._selectedMeasuresTree,true);},_downButtonMeasuresClick:function(){this.__reorderTreeItem(this._selectedMeasuresTree,false);},__checkButtonState:function(A){if(!A){return ;}if(A==this._dimensionsTree){this.__toggleDimensionRightButtons(this.__hasSelectedNode(this._dimensionsTree));}else{if(A==this._rowsTree){this.__toggleLeftButtonRows(this.__hasSelectedNode(this._rowsTree));this.__toggleUpDownButton(this._rowsTree);}else{if(A==this._columnsTree){this.__toggleLeftButtonColumns(this.__hasSelectedNode(this._columnsTree));this.__toggleUpDownButton(this._columnsTree);}else{if(A==this._measuresTree){this.__toggleRightButtonMeasures(this.__hasSelectedNode(this._measuresTree));}else{if(A==this._selectedMeasuresTree){this.__toggleLeftButtonMeasures(this.__hasSelectedNode(this._selectedMeasuresTree));this.__toggleUpDownButton(this._selectedMeasuresTree);}}}}}},__hasSelectedNode:function(A){if(A&&A.getSelectionModel()){var B=A.getSelectionModel().getSelectedNodes();if(B&&B.length>0){return true;}}return false;},__reorderTreeItem:function(E,H){var J=this.__getSelectedNodesForReorder(E);if(!J||J.length<=0){return ;}if(!H){J=J.reverse();}var C=E.getSelectionModel();for(var F=0;F<J.length;F++){var I=J[F];var G=I.parentNode;if(H){var A=I.previousSibling;var B=I.isSelected();if(!A||actuate.util.Utility.arrayContains(J,A)){continue;}G.insertBefore(I,A);}else{var D=I.nextSibling;if(!D||actuate.util.Utility.arrayContains(J,D)){continue;}G.insertBefore(D,I);}if(B){C.select(I,null,true);}}},__getSelectedNodesForReorder:function(C){var E=[];var K=[];var F=C.getSelectionModel().getSelectedNodes();if(F&&F.length>0){K=[].concat(F);}var A=C.getRootNode();if(C!=this._selectedMeasuresTree){var B=true;var J=[];for(var G=0;G<K.length;G++){var I=K[G];var D=I.attributes.type;if(D!="attribute"){B=false;break;}J.push(I);}if(B){J.sort(function(M,L){var O=M.parentNode();var N=L.parentNode();if(O!=N){var Q=O.parentNode();var P=N.parentNode();if(Q!=P){return A.indexOf(Q)-A.indexOf(P);}else{return Q.indexOf(O)-Q.indexOf(N);}}else{return O.indexOf(M)-O.indexOf(L);}});return J;}}for(var G=0;G<K.length;G++){var I=K[G];var D=I.attributes.type;if(D){if(D=="dimension"||D=="sharedDimension"){if(!this.__checkIfExisted(E,I)){E.push(I);}}else{if(D=="level"){var H=I.parentNode;if(!this.__checkIfExisted(E,H)){E.push(H);}}else{if(D=="attribute"){var H=I.parentNode.parentNode;if(!this.__checkIfExisted(E,H)){E.push(H);}}else{if(D=="measure"){E.push(I);}}}}}}E.sort(function(M,L){var O=A.indexOf(M);var N=A.indexOf(L);return O-N;});return E;},__checkIfExisted:function(A,C){for(var B=0;B<A.length;B++){if(A[B]==C){return true;}}return false;},__getSelectedNodes:function(A,C,D){var E=[];var B=A.getSelectionModel().getSelectedNodes();if(B&&B.length>0){E=[].concat(B);}if(C){if(D&&D.ctrlKey){if(!C.isSelected()){E.push(C);}}else{E=[];E.push(C);}}return E;},__getSelectedNodesForMove:function(A,C,F){var E=[];var G=this.__getSelectedNodes(A,C,F);for(var B=0;B<G.length;B++){var D=G[B];if(!actuate.util.Utility.arrayContains(E,D)){this.__getSelectedNodesForMoveFromNode(D,E);}}return E;},__getSelectedNodesForMoveFromNode:function(D,E){var C=D.childNodes;var B=false;for(var A=0;A<C.length;A++){if(C[A].isSelected()){this.__getSelectedNodesForMoveFromNode(C[A],E);B=true;}}if(!B){E.push(D);}},__allowMoveDimension:function(C,A,H){var I=this.__getSelectedNodesForMove(this._dimensionsTree,A,H);if(I&&I.length>0){for(var E=0;E<I.length;E++){var G=I[E];var D=G.attributes.type;var F;if(D=="dimension"||D=="sharedDimension"){F=G;var B=false;F.eachChild(function(J){if(!J.disabled){B=true;return false;}});if(!B){return false;}}else{if(D=="level"){F=G.parentNode;}else{if(D=="attribute"){F=G.parentNode.parentNode;}}}if(C.getNodeById(F.id)){return false;}}return true;}return false;},__moveTreeItem:function(A,E){var M=this.__getSelectedNodesForMove(A);if(M&&M.length>0){for(var G=0;G<M.length;G++){var J=M[G];var F=J.attributes.type;var K;if(A==this._dimensionsTree||A==this._measuresTree){if(F=="measure"){K=E.getRootNode().appendChild({id:J.id,text:J.text,type:J.attributes.type});J.disable();}else{if(F=="dimension"||F=="sharedDimension"){K=E.getNodeById(J.id);if(!K){K=E.getRootNode().appendChild({id:J.id,text:J.text,type:F});}this._nodeCopy(J,K);J.disable();}else{var H;if(F=="level"){H=J.parentNode;K=E.getNodeById(H.id);if(!K){K=E.getRootNode().appendChild({id:H.id,text:H.text,type:H.attributes.type});}var I=this.__findLevelInsertNode(K,J.cubeLevelIndex);if(I){K=K.insertBefore({id:J.id,text:J.text,type:J.attributes.type},I);}else{K=K.appendChild({id:J.id,text:J.text,type:J.attributes.type});}K.cubeLevelIndex=J.cubeLevelIndex;}else{var N=J.parentNode;H=N.parentNode;var D=E.getNodeById(N.id);if(!D){var L=E.getNodeById(H.id);if(!L){L=E.getRootNode().appendChild({id:H.id,text:H.text,type:H.attributes.type});}var I=this.__findLevelInsertNode(L,N.cubeLevelIndex);if(I){D=L.insertBefore({id:N.id,text:N.text,type:N.attributes.type},I);}else{D=L.appendChild({id:N.id,text:N.text,type:N.attributes.type});}D.cubeLevelIndex=N.cubeLevelIndex;}K=D.appendChild({text:J.text,type:J.attributes.type});J.parentNode.disable();}J.disable();this._resetDimensionNodeEnableState(H);}}this._selectNodeAfterMoving(J);}else{var C=J.parentNode;if(F!="attribute"){K=E.getNodeById(J.id);if(F=="level"){K.parentNode.enable();}}else{var B=E.getNodeById(C.id);B.eachChild(function(O){if(O.text==J.text){K=O;return false;}});B.parentNode.enable();}K.cascade(function(O){O.enable();});J.toBeDeleted=true;C.toBeDeleted=F=="level"&&C.childNodes.length==1;this._selectNodeAfterMoving(J);C.removeChild(J);if(C.toBeDeleted){C.parentNode.removeChild(C);}}if(F=="dimension"||F=="sharedDimension"){K.expand(true);}else{if(F!="measure"){if(F=="attribute"){K.parentNode.parentNode.expand();}K.parentNode.expand();}}K.select();}this.__checkButtonState(A);this.__checkButtonState(E);}},_selectNodeAfterMoving:function(B,A){if(!B||B.isRoot){return true;}if(B==A){return false;}if(!B.disabled&&!B.toBeDeleted){B.select();return true;}if(!A){A=B;}if(B.nextSibling){if(this._selectNodeAfterMoving(B.nextSibling,A)){return true;}}else{if(this._selectNodeAfterMoving(B.parentNode.firstChild,A)){return true;}else{return this._selectNodeAfterMoving(B.parentNode);}}},__findLevelInsertNode:function(A,B){if(!A.hasChildNodes()){return null;}if(!(typeof (B)=="number")){return null;}var E=A.childNodes;for(var D=0;D<E.length;D++){var C=E[D].cubeLevelIndex;if(typeof (C)=="number"&&C>B){return E[D];}}return null;},_nodeCopy:function(A,E){if(!A||!E){return ;}if(A.hasChildNodes()){var F=A.childNodes;for(var D=0;D<F.length;D++){var C=E.getOwnerTree().getNodeById(F[D].id);if(!C){var B=this.__findLevelInsertNode(E,F[D].cubeLevelIndex);if(B){C=E.insertBefore({id:F[D].id,text:F[D].text,type:F[D].attributes.type},B);}else{C=E.appendChild({id:F[D].id,text:F[D].text,type:F[D].attributes.type});}C.cubeLevelIndex=F[D].cubeLevelIndex;F[D].disable();}F[D].eachChild(function(G){if(!G.disabled){C.appendChild({text:G.text,type:G.attributes.type});G.disable();}});}}},createSoapNode:function(G,F){if(F){if(!this.validate()){return ;}if(this._selectedIid){F.documentElement.setAttribute("iid",this._selectedIid);}var P=actuate.util.XmlDom.createElement(F,"Cube");var Q=this.__getSelectedDataSourceInfo();var H=Q[1].name;var A=Q[0];if(!A){A="";}var K=Q[2];var O=actuate.util.XmlDom.createElement(F,"Name");var L=F.createTextNode(H);O.appendChild(L);P.appendChild(O);var R=actuate.util.XmlDom.createElement(F,"DataSource");O=actuate.util.XmlDom.createElement(F,"Name");L=F.createTextNode(A);O.appendChild(L);R.appendChild(O);O=actuate.util.XmlDom.createElement(F,"DataMartName");L=F.createTextNode(K);O.appendChild(L);R.appendChild(O);var I=Q[4];if(I){var N=(I.toLowerCase()=="data")?actuate.dialog.impl.constant.DataMartAccessType.LATEST:actuate.dialog.impl.constant.DataMartAccessType.TRANSIENT;var B=actuate.util.XmlDom.createElement(F,"Type");B.appendChild(F.createTextNode(N));R.appendChild(B);}P.appendChild(R);F.documentElement.appendChild(P);var E=actuate.util.XmlDom.createElement(F,"Crosstab");O=actuate.util.XmlDom.createElement(F,"CubeName");L=F.createTextNode(H);O.appendChild(L);E.appendChild(O);var C=actuate.util.XmlDom.createElement(F,"Rows");this._createDimensionsSoapNode(C,F,this._rowsTree,0);E.appendChild(C);var S=actuate.util.XmlDom.createElement(F,"Columns");this._createDimensionsSoapNode(S,F,this._columnsTree,1);E.appendChild(S);var J=actuate.util.XmlDom.createElement(F,"Measures");this._createMeasuresSoapNode(J,F);E.appendChild(J);F.documentElement.appendChild(E);this.__addFilterSoap(F.documentElement);if(this._dataManagerSoap!=null){var M=this._dataManagerSoap.childNodes[0].data;var D=M.substr(0,M.length-1);var L=F.createTextNode(D);G.appendChild(L);}}},_createDimensionsSoapNode:function(M,D,K,H){var S=K.getRootNode();if(S.hasChildNodes()){var L=0;var T=S.childNodes;for(var Q=0;Q<T.length;Q++){var A=T[Q];if(A.hasChildNodes()){var C=actuate.util.XmlDom.createElement(D,"DimensionView");M.appendChild(C);var R=actuate.util.XmlDom.createElement(D,"Index");var N=D.createTextNode(""+L);R.appendChild(N);C.appendChild(R);var J=actuate.util.XmlDom.createElement(D,"AxisType");N=D.createTextNode(""+H);J.appendChild(N);C.appendChild(J);var I=actuate.util.XmlDom.createElement(D,"Dimension");N=D.createTextNode(A.text);I.appendChild(N);C.appendChild(I);var O=actuate.util.XmlDom.createElement(D,"Levels");C.appendChild(O);var F=A.childNodes;for(var P=0;P<F.length;P++){var G=actuate.util.XmlDom.createElement(D,"LevelView");O.appendChild(G);var B=actuate.util.XmlDom.createElement(D,"Index");N=D.createTextNode(""+P);B.appendChild(N);G.appendChild(B);var E=actuate.util.XmlDom.createElement(D,"LevelName");N=D.createTextNode(F[P].text);E.appendChild(N);G.appendChild(E);var U=actuate.util.XmlDom.createElement(D,"LevelAttributes");G.appendChild(U);F[P].eachChild(function(Z){var V=actuate.util.XmlDom.createElement(D,"Attribute");U.appendChild(V);var W=actuate.util.XmlDom.createElement(D,"Name");N=D.createTextNode(Z.text);W.appendChild(N);V.appendChild(W);var X=Z.attributes.itemId;if(X){var Y=actuate.util.XmlDom.createElement(D,"ItemId");N=D.createTextNode(X);Y.appendChild(N);V.appendChild(Y);}});}L++;}}}},_createMeasuresSoapNode:function(I,H){var E=this._selectedMeasuresTree.getRootNode();if(E.hasChildNodes()){var B=E.childNodes;for(var G=0;G<B.length;G++){var D=actuate.util.XmlDom.createElement(H,"MeasureView");I.appendChild(D);var A=actuate.util.XmlDom.createElement(H,"Index");var F=H.createTextNode(""+G);A.appendChild(F);D.appendChild(A);var C=actuate.util.XmlDom.createElement(H,"MeasureName");F=H.createTextNode(B[G].text);C.appendChild(F);D.appendChild(C);}}},validate:function(){if(!this._isSelectedCubeData()){actuate.widget.MessageBox.alert(actuate.util.Utility.getLocalizedString("crosstabBuilderDialog.alertTitle"),actuate.util.Utility.getLocalizedString("crosstabBuilderDialog.message.blankCubeName"));return false;}var B=this._rowsTree.getRootNode();var A=this._columnsTree.getRootNode();if(!B.hasChildNodes()&&!A.hasChildNodes()){actuate.widget.MessageBox.alert(actuate.util.Utility.getLocalizedString("crosstabBuilderDialog.alertTitle"),actuate.util.Utility.getLocalizedString("crosstabBuilderDialog.message.noDimension"));return false;}return true;},_changeFilterPanel:function(B){if(this._parentDialog._filterPanel){var C={};var A=this.__getSelectedDataSourceInfo();if(A){C.dataObject=[A[1],A[4],A[3]];C.dataObjectSoap=this.createCubeSoap(A);C.dataMartSoap=this._dataManagerSoap;C.clearFilterUI=this._clearFilterUI;C.target="Crosstab";}if(this._filter){C.Filter=this._filter;}this._parentDialog._filterPanel.loadData(C);}},createCubeSoap:function(F){var G=actuate.util.XmlDom.createXMLDom(actuate.util.Constants.soap.NAMESPACE_ACTUATE10,actuate.Constant.tag.Data);var D=F[0];if(!D){D="";}var J=F[1].name;var H=F[2];var E=actuate.util.XmlDom.createElement(G,"Cube");var B=actuate.util.XmlDom.createElement(G,"Name");var C=G.createTextNode(J);B.appendChild(C);E.appendChild(B);var A=actuate.util.XmlDom.createElement(G,"DataSource");var K=actuate.util.XmlDom.createElement(G,"DisplayName");C=G.createTextNode(D);K.appendChild(C);A.appendChild(K);var I=actuate.util.XmlDom.createElement(G,"DataMartName");C=G.createTextNode(H);I.appendChild(C);A.appendChild(I);E.appendChild(A);return E;},_resetDimensionNodeEnableState:function(B){var A=false;B.cascade(function(C){if(C!=B&&!C.disabled){A=true;return false;}});if(A){B.enable();}else{B.disable();}},_noComma:null});