actuate.util.Package.define("actuate.dialog.impl.helper.font");actuate.dialog.impl.helper.font.FontDialog=actuate.Class.extendClass(actuate.dialog.impl.helper.BaseDialog,{_classname:"actuate.dialog.FontDialog",_width:370,_FONTSELECT_COMBO_ID:"fontSelect_id",_SIZESELECT_COMBO_ID:"sizeSelect_id",_COLORSELECT_COLORFIELD_ID:"colorSelect_id",_BGCOLORSELECT_COLORFIELD_ID:"bgColorSelect_id",_BGCOLORSELECT_LABEL_ID:"bgColorLabel_id",_BOLD_BUTTON_ID:"bold_id",_ITALIC_BUTTON_ID:"italic_id",_UNDERLINE_BUTTON_ID:"underline_id",_RADIOBUTTONS_ID:"radioButtons_id",_APPLYTOTABLE_RADIO_ID:"applyToTable_id",_APPLYTOCOLUMN_RADIO_ID:"applyToColumn_id",_PREVIEWTEXT_ID:"previewText",_dataItemId:null,_subDialog:true,initialize:function(){actuate.dialog.impl.helper.font.FontDialog.superclass.initialize.apply(this,arguments);this._reset();},__initComponents:function(){actuate.dialog.impl.helper.font.FontDialog.superclass.__initComponents.apply(this,arguments);this.setTitle(actuate.util.Utility.getLocalizedString("fontDialog.caption"));this.fontSelectDiv=document.getElementById(this._FONTSELECT_COMBO_ID);this.sizeSelectDiv=document.getElementById(this._SIZESELECT_COMBO_ID);this.colorSelectDiv=document.getElementById(this._COLORSELECT_COLORFIELD_ID);this.bgColorLabelDiv=document.getElementById(this._BGCOLORSELECT_LABEL_ID);this.bgColorSelectDiv=document.getElementById(this._BGCOLORSELECT_COLORFIELD_ID);this.boldToggle=document.getElementById(this._BOLD_BUTTON_ID);this.italicToggle=document.getElementById(this._ITALIC_BUTTON_ID);this.underlineToggle=document.getElementById(this._UNDERLINE_BUTTON_ID);this.radioButtonDiv=document.getElementById(this._RADIOBUTTONS_ID);this.applyToTableDiv=document.getElementById(this._APPLYTOTABLE_RADIO_ID);this.applyToColumnDiv=document.getElementById(this._APPLYTOCOLUMN_RADIO_ID);this.bgColorLabel=new actuate.widget.form.Label({width:30,renderTo:this.bgColorLabelDiv,text:actuate.util.Utility.getLocalizedString("fontDialog.label.backgroundColor")});this.fontSelect=new actuate.uiadapter.ComboBox({editable:false,width:150});this.sizeSelect=new actuate.uiadapter.ComboBox({editable:true,width:150});this.colorSelect=new actuate.uiadapter.ColorField({width:150});this.bgColorSelect=new actuate.uiadapter.ColorField({width:150});this.applyToTable=new actuate.uiadapter.Radio({cls:actuate.dialog.impl.constant.CSS_INPUTBOX,name:"tableOrColumn",valueText:"table",labelAlign:"right",labelWidth:170,boxLabel:actuate.util.Utility.getLocalizedString("fontDialog.label.applyToTable")});this.applyToColumn=new actuate.uiadapter.Radio({cls:actuate.dialog.impl.constant.CSS_INPUTBOX,name:"tableOrColumn",valueText:"column",labelAlign:"right",labelWidth:170,boxLabel:actuate.util.Utility.getLocalizedString("fontDialog.label.applyToColumn")});this.styleSelectionView=new actuate.dialog.impl.helper.font.StyleSelectionView(this.fontSelect,this.sizeSelect,this.colorSelect,this.bgColorSelect,this._BOLD_BUTTON_ID,this._ITALIC_BUTTON_ID,this._UNDERLINE_BUTTON_ID);this.stylePreviewView=new actuate.dialog.impl.helper.font.StylePreviewView(this._PREVIEWTEXT_ID);this.fontSelect.render(this.fontSelectDiv);this.sizeSelect.render(this.sizeSelectDiv);this.colorSelect.render(this.colorSelectDiv);this.bgColorSelect.render(this.bgColorSelectDiv);this.applyToTable.render(this.applyToTableDiv);this.applyToColumn.render(this.applyToColumnDiv);this.styleSelectionView.updateMenuOptions(actuate.dialog.FontOptions);},__initListeners:function(){actuate.dialog.impl.helper.font.FontDialog.superclass.__initListeners.apply(this,arguments);var A=actuate.Method.bindAsEventListener(this.__neh_keyup,this);actuate.util.Event.observe(this.boldToggle,"click",actuate.Method.bind(this.__neh_boldClick,this),false);actuate.util.Event.observe(this.italicToggle,"click",actuate.Method.bind(this.__neh_italicClick,this),false);actuate.util.Event.observe(this.underlineToggle,"click",actuate.Method.bind(this.__neh_underlineClick,this),false);actuate.util.Event.observe(this.boldToggle,"mouseover",actuate.Method.bind(this.__neh_setOverClass,this),false);actuate.util.Event.observe(this.italicToggle,"mouseover",actuate.Method.bind(this.__neh_setOverClass,this),false);actuate.util.Event.observe(this.underlineToggle,"mouseover",actuate.Method.bind(this.__neh_setOverClass,this),false);actuate.util.Event.observe(this.boldToggle,"mouseout",actuate.Method.bind(this.__neh_removeOverClass,this),false);actuate.util.Event.observe(this.italicToggle,"mouseout",actuate.Method.bind(this.__neh_removeOverClass,this),false);actuate.util.Event.observe(this.underlineToggle,"mouseout",actuate.Method.bind(this.__neh_removeOverClass,this),false);this.selectBoxesFocused=false;this.__neh_gainFocus_c=actuate.Method.bind(this.__neh_gainFocus,this);this.fontSelect.registerEventHandler("focus",this.__neh_gainFocus_c);this.sizeSelect.registerEventHandler("focus",this.__neh_gainFocus_c);this.colorSelect.registerEventHandler("focus",this.__neh_gainFocus_c);this.bgColorSelect.registerEventHandler("focus",this.__neh_gainFocus_c);this.__neh_fontChange_c=actuate.Method.bind(this.__neh_fontChange,this);this.fontSelect.registerEventHandler("select",this.__neh_fontChange_c);this.__neh_fontSizeBlur_c=actuate.Method.bind(this.__neh_fontSizeBlur,this);this.sizeSelect.registerEventHandler("blur",this.__neh_fontSizeBlur_c);this.sizeSelect.registerEventHandler("select",this.__neh_fontSizeBlur_c);this.__neh_colorChange_c=actuate.Method.bind(this.__neh_colorChange,this);this.colorSelect.registerEventHandler("pickerSelect",this.__neh_colorChange_c);this.colorSelect.registerEventHandler("paletteSelect",this.__neh_colorChange_c);this.__neh_backgroundColorChange_c=actuate.Method.bind(this.__neh_backgroundColorChange,this);this.bgColorSelect.registerEventHandler("pickerSelect",this.__neh_backgroundColorChange_c);this.bgColorSelect.registerEventHandler("paletteSelect",this.__neh_backgroundColorChange_c);},__initTemplates:function(){var C=document.createElement("div");var A=new actuate.widget.Template('<DIV class="dialogLabelFont actuate_dialog_font_FontDialog">'+'<TABLE CELLPADDING="0px" CELLSPACING="0px">'+"<TR>"+"<TD>"+'<DIV CLASS="titleSpacing">'+actuate.util.Utility.getLocalizedString("fontDialog.label.font")+"</DIV>"+'<DIV ID="'+this._FONTSELECT_COMBO_ID+'"</DIV>'+"</TD>"+"<TD>"+'<DIV CLASS="titleSpacing" style="margin-left:6px;">'+actuate.util.Utility.getLocalizedString("fontDialog.label.size")+"</DIV>"+'<DIV CLASS="fontSizeDiv" ID="'+this._SIZESELECT_COMBO_ID+'"></DIV>'+"</TD>"+"</TR>"+"<TR>"+"<TD>"+'<DIV CLASS="titleSpacing" style="margin-top:10px;">'+actuate.util.Utility.getLocalizedString("fontDialog.label.color")+"</DIV>"+'<DIV ID="'+this._COLORSELECT_COLORFIELD_ID+'"></DIV>'+"</TD>"+"<TD>"+'<DIV ID="'+this._BGCOLORSELECT_LABEL_ID+'" CLASS="titleSpacing" style="margin-top:10px;margin-left:6px;">'+"</DIV>"+'<DIV CLASS="fontBackgroundDiv" ID="'+this._BGCOLORSELECT_COLORFIELD_ID+'"></DIV>'+"</TD>"+"</TR>"+"</TABLE>"+'<DIV style="margin-top:10px;text-align:left;width:100%;margin-left:2px"  CLASS="itemSpacing">'+'<SPAN style="margin-right:1ex;">'+'<INPUT TYPE="button" id="'+this._BOLD_BUTTON_ID+'" '+' name="boldimg" '+' CLASS="imagebutton actuateCSSSprite_dialog actuateIV_bold_disable" '+' ENABLED_ON="imagebutton actuateCSSSprite_dialog actuateIV_bold_enable" '+' ENABLED_OFF="imagebutton actuateCSSSprite_dialog actuateIV_bold_disable"/>'+"</SPAN>"+'<SPAN style="margin-right:1ex;">'+'<INPUT TYPE="button" id="'+this._ITALIC_BUTTON_ID+'" '+' name="italicimg" '+' CLASS="imagebutton actuateCSSSprite_dialog actuateIV_italic_disable" '+' ENABLED_ON="imagebutton actuateCSSSprite_dialog actuateIV_italic_enable" '+' ENABLED_OFF="imagebutton actuateCSSSprite_dialog actuateIV_italic_disable"/>'+"</SPAN>"+"<SPAN>"+'<INPUT TYPE="button" id="'+this._UNDERLINE_BUTTON_ID+'" '+' name="underlineimg" '+' CLASS="imagebutton actuateCSSSprite_dialog actuateIV_underline_disable" '+' ENABLED_ON="imagebutton actuateCSSSprite_dialog actuateIV_underline_enable" '+' ENABLED_OFF="imagebutton actuateCSSSprite_dialog actuateIV_underline_disable"/>'+"</SPAN>"+"</DIV>"+'<DIV id="'+this._RADIOBUTTONS_ID+'" CLASS="itemSpacing">'+'<DIV style="clear:both"></DIV>'+'<DIV style="float:left;margin-right:1ex;">'+"<DIV>"+'<DIV style="clear:both"></DIV>'+'<DIV style="float:left;margin-right:1ex;">'+'<SPAN id="'+this._APPLYTOTABLE_RADIO_ID+'">'+"</SPAN>"+"</DIV>"+'<DIV style="clear:both"></DIV>'+"</DIV>"+"<DIV>"+'<DIV style="clear:both"></DIV>'+'<DIV style="float:left;margin-right:1ex;">'+'<SPAN id="'+this._APPLYTOCOLUMN_RADIO_ID+'">'+"</SPAN>"+"</DIV>"+'<DIV style="clear:both"></DIV>'+"</DIV>"+"</DIV>"+'<DIV style="clear:both"></DIV>'+"</DIV>"+'<DIV id="fontDialog_previewBox" class="fontPreviewBox" >'+'<DIV style="height: 40px; width: auto; overflow: hidden" >'+'<SPAN style="line-height: 40px;" id="'+this._PREVIEWTEXT_ID+'">'+actuate.util.Utility.getLocalizedString("conditionFormatDialog.text.noFormatRule")+"</SPAN>"+"</DIV>"+"</DIV>"+"</DIV>");var B=[];A.append(C,B,true);this.add(new actuate.widget.panel.Panel({contentEl:C,border:false}));},__neh_gainFocus:function(A){this.selectBoxesFocused=true;},loseFocus:function(){this.selectBoxesFocused=false;},_bindFromMetadata:function(A){this._subDialog=false;this._reset();this._elementType=A[actuate.model.Constant.MetadataType.ELEMENT].type;if(!A.columnHeaderMode){this._column=A.selectedColumn;this._dataItemId=A.selectedElement&&A.selectedElement.iid.substr(1);}else{this._dataItemId=null;this._elementType=actuate.Constant.element.LABEL;}this._showRadioButtons(this._elementType==actuate.Constant.element.TABLE);if(A.style){this.styleModel.setFont(A.style);}this.styleSelectionView.setValues(this.styleModel.getFontFamily(),this.styleModel.getFontSize(),this.styleModel.getColor(),this.styleModel.getBackgroundColor(),this.styleModel.getIsBold(),this.styleModel.getIsItalic(),this.styleModel.getIsUnderline());if(!this.styleModel.isDefault()){this.stylePreviewView.showPreview(this.styleModel);}this.applyToColumn.setValue(true);this.applyToTable.setValue(false);if(A.total){this.total=A.total;}else{delete this.total;}if(A.target){this.target=A.target;}else{delete this.target;}},_showRadioButtons:function(A){this.radioButtonDiv.style.display=A?"block":"none";},_reset:function(){this.styleModel=new actuate.dialog.impl.helper.font.StyleModel();this.styleModel.reset();this.styleSelectionView.reset(this.styleModel);},__neh_fontChange:function(){this.styleModel.setFontFamily(this.styleSelectionView.getFontValue());this.handleFormatChange();},__neh_fontSizeBlur:function(){var B=this.sizeSelect.combo._ele.dom.value;var C=true;var A;B=actuate.util.String.trim(B);if(!B){C=false;A=actuate.util.Utility.getLocalizedString("fontDialog.options.fontSizeValue.notEmpty");}else{if(B.toLowerCase()!=actuate.util.Utility.getLocalizedString("ColorField.Auto").toLowerCase()&&B.toLowerCase()!="auto"){if(!actuate.util.Utility.isNumeric(B)){C=false;A=actuate.util.Utility.getLocalizedString("fontDialog.options.fontSizeValue.isInvalid");}}}if(!C){actuate.widget.MessageBox.show({title:actuate.util.Utility.getLocalizedString("baseDialog.errorTitle"),msg:A,buttons:actuate.widget.MessageBox.OK,icon:actuate.widget.MessageBox.ERROR});}else{if(B.toLowerCase()=="auto"){B="Auto";}this.styleModel.setFontSize(B);this.handleFormatChange();}},__neh_colorChange:function(){if(this.styleSelectionView.getColorValue()==actuate.util.Utility.getLocalizedString("ColorField.Auto")){this.styleModel.setColor(this.styleModel.colorDefault);}else{this.styleModel.setColor(this.styleSelectionView.getColorValue());}this.handleFormatChange();},__neh_backgroundColorChange:function(){if(this.styleSelectionView.getBackgroundColorValue()==actuate.util.Utility.getLocalizedString("ColorField.Auto")){this.styleModel.setBackgroundColor(this.styleModel.backgroundColorDefault);}else{this.styleModel.setBackgroundColor(this.styleSelectionView.getBackgroundColorValue());}this.handleFormatChange();},__neh_underlineClick:function(){this.styleModel.toggleUnderline();this.styleSelectionView.setUnderlineButtonValue(this.styleModel.getIsUnderline());this.handleFormatChange();},__neh_italicClick:function(){this.styleModel.toggleItalic();this.styleSelectionView.setItalicButtonValue(this.styleModel.getIsItalic());this.handleFormatChange();},__neh_boldClick:function(){this.styleModel.toggleBold();this.styleSelectionView.setBoldButtonValue(this.styleModel.getIsBold());this.handleFormatChange();},__neh_setOverClass:function(A){if(A){this.setBeforeClass(A.target);classToApply=A.target.getAttribute("OVER_CLASS");if(classToApply){A.target.className=classToApply;}}},setBeforeClass:function(A){if(A){A.setAttribute("BEFORE_CLASS",A.className);}},__neh_removeOverClass:function(A){if(A){classToApply=A.target.getAttribute("BEFORE_CLASS");if(classToApply){A.target.className=classToApply;}}},handleFormatChange:function(A){this.refresh();},isApplyToTable:function(){if(this.applyToTable.getValue()){return true;}return false;},__getHelpTopic:function(){return"iv_font";},_cancelPress:function(){if(this._cancelCallback){this._cancelCallback();return ;}},_createSoapRequest:function(){var D=actuate.util.XmlDom.createXMLDom(actuate.util.Constants.soap.NAMESPACE_ACTUATE10,actuate.Constant.tag.Data);D.documentElement.appendChild(actuate.util.XmlDom.createElement(D,actuate.Constant.tag.COLUMNDEFS));var E=actuate.util.XmlDom.createElement(D,actuate.Constant.tag.Font);D.documentElement.appendChild(E);var A=this._column!=null;if(A&&actuate.util.Utility.isArray(this._column)){A=this._column.length>0;}if(this._dataItemId&&(!A||this._column.isMergedColumn)){var C=actuate.util.XmlDom.createElement(D,actuate.Constant.tag.DataItemId);dataItemIdTextNode=D.createTextNode(this._dataItemId);C.appendChild(dataItemIdTextNode);D.documentElement.appendChild(C);}if(this.fontSelect.getSelectedIndex()>=0){C=actuate.util.XmlDom.createElement(D,actuate.Constant.tag.FAMILY);textNode=D.createTextNode(this.styleModel.getFontFamily());C.appendChild(textNode);E.appendChild(C);}if(this.sizeSelect.combo._ele.dom.value){C=actuate.util.XmlDom.createElement(D,actuate.Constant.tag.SIZE);if(this.sizeSelect.combo._ele.dom.value.toLowerCase()==actuate.util.Utility.getLocalizedString("ColorField.Auto").toLowerCase()){textNode=D.createTextNode("Auto");}else{textNode=D.createTextNode(this.sizeSelect.combo._ele.dom.value+this.styleModel.getFontSizeUnit());}C.appendChild(textNode);E.appendChild(C);}if(this.colorSelect){var B=this.isInColorOptions(this.styleModel.getColor());C=actuate.util.XmlDom.createElement(D,actuate.Constant.tag.Color);textNode=D.createTextNode(this.styleModel.getColor());C.appendChild(textNode);E.appendChild(C);}if(this.bgColorSelect){var B=this.isInColorOptions(this.styleModel.getBackgroundColor());C=actuate.util.XmlDom.createElement(D,actuate.Constant.tag.BackgroundColor);textNode=D.createTextNode(this.styleModel.getBackgroundColor());C.appendChild(textNode);E.appendChild(C);}C=actuate.util.XmlDom.createElement(D,actuate.Constant.tag.Bold);if(this.styleModel.getIsBold()){textNode=D.createTextNode("true");}else{textNode=D.createTextNode("false");}C.appendChild(textNode);E.appendChild(C);C=actuate.util.XmlDom.createElement(D,actuate.Constant.tag.Italic);if(this.styleModel.getIsItalic()){textNode=D.createTextNode("true");}else{textNode=D.createTextNode("false");}C.appendChild(textNode);E.appendChild(C);C=actuate.util.XmlDom.createElement(D,actuate.Constant.tag.Underline);if(this.styleModel.getIsUnderline()){textNode=D.createTextNode("true");}else{textNode=D.createTextNode("false");}C.appendChild(textNode);E.appendChild(C);C=actuate.util.XmlDom.createElement(D,actuate.Constant.tag.ApplyToTable);if(this.isApplyToTable()){textNode=D.createTextNode("true");}else{textNode=D.createTextNode("false");}C.appendChild(textNode);E.appendChild(C);return D;},isInColorOptions:function(A){var D=actuate.dialog.FontOptions.fontColors;if(D){for(var B=0;B<D.length;B++){for(var C in D[B]){if(A.toLowerCase()==D[B][C]){return true;}}}}},__validate:function(){var B=actuate.dialog.impl.helper.font.FontDialog.superclass.__validate.call(this,this,this.__createResult());var A=this.sizeSelect.combo._ele.dom.value;A=actuate.util.String.trim(A);if(!A){B=false;this.__popupErrorDialog(actuate.util.Utility.getLocalizedString("fontDialog.options.fontSizeValue.notEmpty"));}else{if(A.toLowerCase()!=actuate.util.Utility.getLocalizedString("ColorField.Auto").toLowerCase()){if(!actuate.util.Utility.isNumeric(A)){B=false;this.__popupErrorDialog(actuate.util.Utility.getLocalizedString("fontDialog.options.fontSizeValue.isInvalid"));}}}return B;},__createResult:function(){if(this._subDialog){var A=new actuate.model.Font();if(this.fontSelect.getSelectedIndex()>=0){A.family=this.styleModel.getFontFamily();}if(this.sizeSelect.combo._ele.dom.value){var B=this.styleModel.getFontSizeUnit();A.size=this.sizeSelect.combo._ele.dom.value;if(B&&A.size.toLowerCase()!=actuate.util.Utility.getLocalizedString("ColorField.Auto").toLowerCase()){A.size+=B;}else{if(A.size.toLowerCase()==actuate.util.Utility.getLocalizedString("ColorField.Auto").toLowerCase()){A.size="Auto";}}}if(this.colorSelect){A.color=this.styleModel.getColor();}if(this.bgColorSelect){A.backgroundColor=this.styleModel.getBackgroundColor();}A.bold=this.styleModel.getIsBold()?true:false;A.italic=this.styleModel.getIsItalic()?true:false;A.underline=this.styleModel.getIsUnderline()?true:false;return A;}return this._createSoapRequest();},refresh:function(){this._showRadioButtons(!this._subDialog&&this._elementType==actuate.Constant.element.TABLE);this.styleSelectionView.setValues(this.styleModel.getFontFamily(),this.styleModel.getFontSize(),this.styleModel.getColor(),this.styleModel.getBackgroundColor(),this.styleModel.getIsBold(),this.styleModel.getIsItalic(),this.styleModel.getIsUnderline());this.stylePreviewView.showPreview(this.styleModel);actuate.dialog.impl.helper.font.FontDialog.superclass.refresh.apply(this,arguments);},show:function(A,C,B){if(C){this._bindFromMetadata(C);}actuate.dialog.impl.helper.font.FontDialog.superclass.show.apply(this,arguments);this._updateDialogOptions(B);},setStyleModel:function(A){this._elementType=null;if(A!=null){this.styleModel=A;}else{this._reset();}this.refresh();},setFont:function(A){if(A!=null){this.styleModel.setFont(A);}else{this._reset();}this._subDialog=true;this.refresh();},_updateDialogOptions:function(A){this.sizeSelect.setDisabled(A&&A.enableFontSize==false);this.bgColorSelect.setDisabled(A&&A.enableBackgroundColor==false);if(A&&A.hideBackgroundColor){this.bgColorSelect.setVisibility(false);this.bgColorLabel.setVisibility(false);}else{this.bgColorSelect.setVisibility(true);this.bgColorLabel.setVisibility(true);}}});