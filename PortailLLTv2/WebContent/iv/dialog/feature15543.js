actuate.util.Package.define("actuate.dialog.impl.helper.crosstabbuilder");actuate.dialog.impl.helper.crosstabbuilder.CrosstabFormatTab=actuate.Class.create();actuate.dialog.impl.helper.crosstabbuilder.CrosstabFormatTab.prototype=actuate.Class.extend(new actuate.dialog.impl.helper.AbstractTabDialog(),{_classname:"actuate.dialog.impl.helper.crosstabbuilder.CrosstabFormatTab",_height:360,INT_MAX_VALUE:2147483647,initialize:function(){this.id=this._getId(this._classname);this._util=actuate.util.Utility;this._title=this._util.getLocalizedString("crosstabBuilderDialog.formatTab.title");this._componentArray=[];actuate.dialog.impl.helper.AbstractTabDialog.prototype.initialize.call(this);this._chkRow=actuate.widget.ComponentMgr.get(this.id+"_chkRow");this._chkColumn=actuate.widget.ComponentMgr.get(this.id+"_chkColumn");this._subTotals_chkRow=actuate.widget.ComponentMgr.get(this.id+"_subTotals_chkRow");this._subTotals_chkColumn=actuate.widget.ComponentMgr.get(this.id+"_subTotals_chkColumn");this._chkPageBreak=actuate.widget.ComponentMgr.get(this.id+"_chkPageBreak");this._chkPageBreak.registerEventHandler("check",actuate.Method.bind(this._pageBreakChkCheck,this),false);this._panel.on("activate",actuate.Method.bind(this._onActivate,this));},_onActivate:function(){var B=this._parentDialog.getWindow();B.setHeight(this._height);var D=this._parentDialog.getPanel("actuate_dialog_impl_helper_crosstabbuilder_crosstabDataTab");var A=this._getLevelCount(D._rowsTree,D._isLinkedDataset);var C=this._getLevelCount(D._columnsTree,D._isLinkedDataset);var E=D._selectedMeasuresTree.getRootNode().childNodes.length;if(A==0||E==0){this._chkRow.disable();}else{this._chkRow.enable();}if(C==0||E==0){this._chkColumn.disable();}else{this._chkColumn.enable();}if(A<2||E==0){this._subTotals_chkRow.disable();}else{this._subTotals_chkRow.enable();}if(C<2||E==0){this._subTotals_chkColumn.disable();}else{this._subTotals_chkColumn.enable();}},_getDefaultTimeLevelCount:function(A){var B=-1;if("date-time"==A){B=11;}else{if("date"==A){B=8;}else{if("time"==A){B=3;}}}return B;},_getLevelCount:function(A,E){var B=A.getRootNode();var D=0;var C=this;B.cascade(function(G){if(E){if(G.attributes.type=="dimension"){if(G.attributes.isDateInterval=="true"&&G.attributes.timeLevels==undefined){var F=C._getDefaultTimeLevelCount(G.attributes.dataType);if(F>0){D+=F;}}else{if(G.attributes.timeLevels&&G.attributes.timeLevels.length>0){D+=G.attributes.timeLevels.length;}else{D++;}}}}else{if(G.attributes.type=="level"){D++;}}});return D;},_initContent:function(){var A=this;this._componentArray.push({xtype:"fieldset",collapsible:true,title:this._util.getLocalizedString("crosstabBuilderDialog.formatTab.grandTotals"),checkboxToggle:false,cls:"actuate-widget-panle-zero-margin-top",defaults:{xtype:"checkbox",hideLabel:true},listeners:{collapse:function(){if(A._parentDialog&&A._parentDialog.adjustSize){A._parentDialog.adjustSize();}},expand:function(){if(A._parentDialog&&A._parentDialog.adjustSize){A._parentDialog.adjustSize();}}},items:[{id:this.id+"_chkRow",boxLabel:this._util.getLocalizedString("crosstabBuilderDialog.formatTab.grandTotals.row")},{id:this.id+"_chkColumn",boxLabel:this._util.getLocalizedString("crosstabBuilderDialog.formatTab.grandTotals.column")}]});this._componentArray.push({xtype:"fieldset",collapsible:true,title:this._util.getLocalizedString("crosstabBuilderDialog.formatTab.subTotals"),checkboxToggle:false,listeners:{collapse:function(){if(A._parentDialog&&A._parentDialog.adjustSize){A._parentDialog.adjustSize();}},expand:function(){if(A._parentDialog&&A._parentDialog.adjustSize){A._parentDialog.adjustSize();}}},defaults:{xtype:"checkbox",hideLabel:true,otherStates:{partial:{cls:"actuate_crosstab_builder_checkbox_partial"}},getElementClass:function(C){if(C===true){return this.checkedCls;}if(typeof C=="string"){var B=this.otherStates[C];if(B){return B.cls;}}return"";},setValue:function(C,B){var D=this.checked;if((C==true||String(C).toLowerCase()=="true"||C=="1"||String(C).toLowerCase()=="on")){this.checked=true;}else{if(this.otherStates[String(C)]){this.checked=C;}else{this.checked=false;}}if(this.rendered){this._ele.replaceClass(this.getElementClass(D),this.getElementClass(this.checked));}if(!B&&D!=this.checked){this.fireEvent("check",this,this.checked);if(this.handler){this.handler.call(this.scope||this,this,this.checked);}}},getValue:function(){return this.checked;}},items:[{id:this.id+"_subTotals_chkRow",boxLabel:this._util.getLocalizedString("crosstabBuilderDialog.formatTab.subTotals.row")},{id:this.id+"_subTotals_chkColumn",boxLabel:this._util.getLocalizedString("crosstabBuilderDialog.formatTab.subTotals.column")}]});this._rowIntervalInput=new actuate.widget.form.TextField({width:180});this._columnIntervalInput=new actuate.widget.form.TextField({width:180});this._componentArray.push({xtype:"fieldset",collapsible:true,title:this._util.getLocalizedString("crosstabBuilderDialog.formatTab.pageBreak"),checkboxToggle:false,cls:"actuate-widget-panle-zero-margin-top",listeners:{collapse:function(){if(A._parentDialog&&A._parentDialog.adjustSize){A._parentDialog.adjustSize();}},expand:function(){if(A._parentDialog&&A._parentDialog.adjustSize){A._parentDialog.adjustSize();}}},items:[{id:this.id+"_chkPageBreak",xtype:"checkbox",hideLabel:true,boxLabel:this._util.getLocalizedString("crosstabBuilderDialog.formatTab.enablePageBreak")},{layout:"table",layoutConfig:{columns:2},border:false,defaults:{border:false,header:false,layout:"table",bodyStyle:"padding: 0px"},items:[{items:[{xtype:"label",text:this._util.getLocalizedString("crosstabBuilderDialog.formatTab.rowInterval")}]},{items:[this._rowIntervalInput]},{items:[{xtype:"label",text:this._util.getLocalizedString("crosstabBuilderDialog.formatTab.columnInterval")}]},{items:[this._columnIntervalInput]}]}]});},loadData:function(A){this._resetControls();if(A.DACrosstab){var B=A.DACrosstab;if(B.RowGTCellIid){this._chkRow.setValue(true);}if(B.ColumnGTCellIid){this._chkColumn.setValue(true);}this._loadSubTotalsState(B.RowSubTotals,this._subTotals_chkRow);this._loadSubTotalsState(B.ColumnSubTotals,this._subTotals_chkColumn);if(B.enablePageBreak){this._chkPageBreak.setValue(true);this._rowIntervalInput.setDisabled(false);this._columnIntervalInput.setDisabled(false);this._rowIntervalInput.setValue("");this._columnIntervalInput.setValue("");if(B.rowInterval&&B.rowInterval>0){this._rowIntervalInput.setValue(""+B.rowInterval);}if(B.columnInterval&&B.columnInterval){this._columnIntervalInput.setValue(""+B.columnInterval);}}else{this._chkPageBreak.setValue(false);this._rowIntervalInput.setDisabled(true);this._columnIntervalInput.setDisabled(true);}}},_loadSubTotalsState:function(C,B){var A;switch(C){case"all":A=true;break;case"partial":A="partial";break;default:A=false;break;}B.setValue(A,true);},_resetControls:function(){this._chkRow.setValue(false);this._chkColumn.setValue(false);this._subTotals_chkRow.setValue(false);this._subTotals_chkColumn.setValue(false);this._setDefaultPageBreak();},_setDefaultPageBreak:function(){this._chkPageBreak.setValue(true);this._rowIntervalInput.setDisabled(false);this._rowIntervalInput.setValue("40");this._columnIntervalInput.setDisabled(false);this._columnIntervalInput.setValue("10");},_pageBreakChkCheck:function(A,B){if(B){this._rowIntervalInput.setDisabled(false);this._columnIntervalInput.setDisabled(false);}else{this._rowIntervalInput.setDisabled(true);this._columnIntervalInput.setDisabled(true);}},createSoapNode:function(E,F){if(F){this._onActivate();var A=F.getElementsByTagName("Crosstab")[0];if(!A){A=actuate.util.XmlDom.createElement(F,"Crosstab");F.documentElement.appendChild(A);}if(!this._chkRow.disabled){var C=actuate.util.XmlDom.createElement(F,"RowGrandTotalCellIid");var G=F.createTextNode(this._chkRow.getValue()?"all":"none");C.appendChild(G);A.appendChild(C);}if(!this._chkColumn.disabled){var C=actuate.util.XmlDom.createElement(F,"ColumnGrandTotalCellIid");var G=F.createTextNode(this._chkColumn.getValue()?"all":"none");C.appendChild(G);A.appendChild(C);}this._createSubTotalsNode("RowSubTotals",this._subTotals_chkRow,F,A);this._createSubTotalsNode("ColumnSubTotals",this._subTotals_chkColumn,F,A);var B=actuate.util.XmlDom.createElement(F,"EnablePageBreak");var G=F.createTextNode(this._enablePageBreak?"true":"false");B.appendChild(G);A.appendChild(B);if(this._enablePageBreak){if(this._rowPageBreakInterval>0){var D=actuate.util.XmlDom.createElement(F,"RowInterval");G=F.createTextNode(""+this._rowPageBreakInterval);D.appendChild(G);A.appendChild(D);}if(this._columnPageBreakInterval>0){var H=actuate.util.XmlDom.createElement(F,"ColumnInterval");G=F.createTextNode(""+this._columnPageBreakInterval);H.appendChild(G);A.appendChild(H);}}}},_createSubTotalsNode:function(C,E,F,A){if(!E.disabled){var B=actuate.util.XmlDom.createElement(F,C);var D;switch(E.getValue()){case true:D="all";break;case"partial":D="partial";break;default:D="none";break;}B.appendChild(F.createTextNode(D));A.appendChild(B);}},validate:function(){if(this._chkPageBreak.getValue()){this._enablePageBreak=true;var A=this._rowIntervalInput.getValue();if(actuate.util.Utility.isEmpty(A,false)){this._rowPageBreakInterval=-1;}else{A=this._trimString(A);if(actuate.util.Utility.isInteger(A)){this._rowPageBreakInterval=parseInt(A);if(this._rowPageBreakInterval>this.INT_MAX_VALUE){actuate.widget.MessageBox.alert(actuate.util.Utility.getLocalizedString("crosstabBuilderDialog.alertTitle"),actuate.util.Utility.getLocalizedString("crosstabBuilderDialog.message.oversizeInterval"));return false;}}else{actuate.widget.MessageBox.alert(actuate.util.Utility.getLocalizedString("crosstabBuilderDialog.alertTitle"),actuate.util.Utility.getLocalizedString("crosstabBuilderDialog.message.invalidInterval"));return false;}}A=this._columnIntervalInput.getValue();if(actuate.util.Utility.isEmpty(A,false)){this._columnPageBreakInterval=-1;}else{A=this._trimString(A);if(actuate.util.Utility.isInteger(A)){this._columnPageBreakInterval=parseInt(A);if(this._columnPageBreakInterval>this.INT_MAX_VALUE){actuate.widget.MessageBox.alert(actuate.util.Utility.getLocalizedString("crosstabBuilderDialog.alertTitle"),actuate.util.Utility.getLocalizedString("crosstabBuilderDialog.message.oversizeInterval"));return false;}}else{actuate.widget.MessageBox.alert(actuate.util.Utility.getLocalizedString("crosstabBuilderDialog.alertTitle"),actuate.util.Utility.getLocalizedString("crosstabBuilderDialog.message.invalidInterval"));return false;}}if(this._rowPageBreakInterval<=0&&this._columnPageBreakInterval<=0){actuate.widget.MessageBox.alert(actuate.util.Utility.getLocalizedString("crosstabBuilderDialog.alertTitle"),actuate.util.Utility.getLocalizedString("crosstabBuilderDialog.message.blankPageBreakInterval"));return false;}}else{this._enablePageBreak=false;this._rowPageBreakInterval=-1;this._columnPageBreakInterval=-1;}return true;},_trimString:function(B){if(typeof (B)!="string"){return B;}var A=B.replace(/^\s*(.*)/,"$1");A=A.replace(/(.*?)\s*$/,"$1");return A;},_noComma:null});