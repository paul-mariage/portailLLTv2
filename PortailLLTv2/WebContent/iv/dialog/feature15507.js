actuate.util.Package.define("actuate.dialog.impl.helper.reportlibrarybuilder");actuate.dialog.impl.helper.reportlibrarybuilder.ReportLibraryDataTab=actuate.Class.extendClass(actuate.dialog.impl.helper.AbstractTabDialog,{_dialogName:"reportLibraryBuilder.dataTab",_classname:"actuate.dialog.ReportLibraryDataTab",_metadata:null,_editing:false,initialize:function(){actuate.dialog.impl.helper.reportlibrarybuilder.ReportLibraryDataTab.superclass.initialize.apply(this,arguments);this._panel=new actuate.widget.panel.Panel(this._initPanel());this.on("filesloaded",actuate.Method.bind(this._loadFiles,this));this.on("metadataloaded",actuate.Method.bind(this._loadMetadata,this));},_initPanel:function(){this._treeStore=new actuate.widget.tree.TreeStore([]);this._dataTree=this._initTree(this._treeStore);var A={title:actuate.util.Utility.getLocalizedString("reportLibraryBuilder.libraryTab"),header:false,style:"background:transparent",border:false,layout:"column",items:[this._dataTree]};return A;},_initTree:function(D){var C=[{type:"reportItem",iconCls:"actuate_data_column_image"},{type:"reportLibrary",iconCls:"actuate_reportlibrary_image"}];var B=new actuate.widget.tree.TreePanel({el:"tree-div",autoScroll:true,style:"margin-left: 10px; margin-bottom: 5px;",width:455,height:150,rootVisible:false,containerScroll:true,dataStore:D,icons:C,pathSeparator:"|"});var A=B.getSelectionModel();if(A){A.registerEventHandler("selectionchange",actuate.Method.bind(this.__selectionChangedHandler,this));A.registerEventHandler("beforeselect",actuate.Method.bind(this.__canSelect,this));}return B;},__selectionChangedHandler:function(A,D){if(D&&D.attributes){var B=D.attributes.text;var C=D.attributes.parentId;this.fireEvent("datachanged",{reportLibrary:C,reportItem:B});}},__canSelect:function(A,B){if(B&&B.attributes){return B.attributes.type=="reportItem";}return false;},_loadFiles:function(B){this._treeStore.clear();if(B&&B.length){for(var A=0;A<B.length;A++){this._treeStore.put({id:B[A],text:B[A],type:"reportLibrary",strong:true,disabled:this._editing});}this._parentDialog._consumer._eventDispatcher.broadcastEvent(actuate.builder.impl.event.__E_QUERY_REPORTLIBRARY_METADATA,actuate.util.Json.makeObject(B));}},_loadMetadata:function(E){if(E){for(var C in E){var A=true;if(C&&E[C]&&E[C].length){for(var B=0;B<E[C].length;B++){var D=E[C][B];if(D){A=false;this._treeStore.put({id:C+"::"+D,text:D,type:"reportItem",parentId:C,disabled:this._editing});}}}if(A){this._treeStore.put({id:C+"::noAvailableItem",text:actuate.util.Utility.getLocalizedString("reportLibraryBuilder.noAvailableItem"),type:null,parentId:C,disabled:true});}}}this._dataTree.setStore(this._treeStore);this._dataTree.expandAll();this._setSelection();},_setSelection:function(){if(this._metadata){var D=this._metadata.reportLibrary+"::"+this._metadata.reportItem;var C=this._dataTree.getNodeById(D);if(C!=null){C.enable();C.select();C.ensureVisible();return ;}}if(this._dataTree){var A=this._dataTree.getSelectionModel();if(A){A.clearSelections();}}var B=this._dataTree.getRootNode();if(B&&B.firstChild){B.firstChild.ensureVisible();}},loadData:function(A){this._metadata=A;this._editing=false;if(this._metadata&&this._metadata.reportLibrary&&this._metadata.reportItem){this._editing=true;}this._parentDialog._consumer._eventDispatcher.broadcastEvent(actuate.builder.impl.event.__E_QUERY_REPORTLIBRARY_FILES);},_preHide:function(){actuate.dialog.impl.helper.reportlibrarybuilder.ReportLibraryDataTab.superclass._preHide.apply(this,arguments);this._treeStore=new actuate.widget.tree.TreeStore([]);this._dataTree.setStore(this._treeStore);},getDataSelection:function(){var A=this._dataTree.getSelectionModel();if(A){var B=A.getSelectedNode();if(B){return B.attributes;}}},createJsonData:function(){var C=this.getDataSelection();var B=C.parentId;var A=C.text;return{reportLibrary:B,reportItem:A};},validate:function(){if(!this.getDataSelection()){actuate.widget.MessageBox.show({title:actuate.util.Utility.getLocalizedString("reportLibraryBuilder.error"),msg:actuate.util.Utility.getLocalizedString("reportLibraryBuilder.noItemSelected"),buttons:actuate.widget.MessageBox.OK,icon:actuate.widget.MessageBox.ERROR});return false;}return true;}});