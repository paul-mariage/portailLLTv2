actuate.util.Package.define("actuate.dialog.impl.helper.summarytablebuilder");actuate.dialog.impl.helper.summarytablebuilder.SummaryTableDataTab=actuate.Class.extendClass(actuate.dialog.impl.helper.AbstractDataTabDialog,{_classname:"actuate.dialog.impl.helper.summarytablebuilder.SummaryTableDataTab",_dataManagerSoap:null,_filterSoap:null,_filter:null,_usedData:null,_pixelPerInch:0,__icons:[{type:null,iconCls:"actuate_data_column_image"},{type:"column",iconCls:"actuate_data_column_image"},{type:"attribute",iconCls:"actuate_attribute_image"},{type:"dimensions",iconCls:"actuate_dimensions_image"},{type:"sharedDimension",iconCls:"actuate_shared_dimension_image"},{type:"measures",iconCls:"actuate_measures_image"},{type:"dimension",iconCls:"actuate_data_column_image"},{type:"level",iconCls:"actuate_level_image"},{type:"measure",iconCls:"actuate_data_column_image"},{type:"string",iconCls:"actuate_data_column_string_image"},{type:"integer",iconCls:"actuate_data_column_number_image"},{type:"float",iconCls:"actuate_data_column_number_image"},{type:"category",iconCls:"actuate_category_image"}],_TEMPLATE_SELECTED_DATA_LIST:'<tpl for="."><div class="actuate-summarytable-div" style="width:278px; height: 20px;">'+"<tpl if=\"disabled == 'false'\">"+'<div class="actuate_data_column_image" style="width:16px; height:16px; float:left; margin-left: 16px;"></div>'+'<div class="actuate-summarytable-columnnameDiv" style="background-color:inherit;width:120px;height: 20px;float:left" title="'+'{columnName}">{shortColumnName}</div>'+"</tpl>"+"<tpl if=\"disabled == 'true'\">"+'<div class="actuate_data_column_image" style="width:16px; height:16px; float:left; margin-left: 16px;opacity : 0.5"></div>'+'<div class="actuate-summarytable-columnnameDiv_disabled" style="color:gray;background-color:inherit;width:120px;height: 20px;float:left" title="'+'{title}">{shortColumnName}</div>'+"</tpl>"+'<div class="actuate-summarytable-innerDiv" style="height: 20px;background-color:inherit;float:left">'+"<tpl if=\"disabled == 'false'\">"+'<div style="background-color:inherit;float:left">{aggregation}</div>'+"</tpl>"+"<tpl if=\"disabled == 'true'\">"+'<div class="actuate-summarytable-aggregation-disabled" style="color:gray;background-color:inherit;float:left">{aggregation}</div>'+"</tpl>"+"<tpl if=\"aggregation != ''\">"+"<tpl if=\"disabled == 'false'\">"+'<img class="actuate-summarytable-img" src=\''+actuate.getDefaultIportalUrl()+"iportal/jsapi/actuate/dialog/images/dropdown-arrow.png'/>"+"</tpl>"+"<tpl if=\"disabled == 'true'\">"+'<img class="actuate-summarytable-img-disabled" src=\''+actuate.getDefaultIportalUrl()+"iportal/jsapi/actuate/dialog/images/dropdown-arrow.png'/>"+"</tpl>"+"</tpl>"+"</div></div></tpl>",_selectedMeasureStore:null,LEFT_ENABLE_ICON:"iportal/common/images/left-arrow.png",RIGHT_ENABLE_ICON:"iportal/common/images/right-arrow.png",_bindingsMap:null,_TOOLTIP:{UP:actuate.util.Utility.getLocalizedString("tableBuilder.tooltip.up"),DOWN:actuate.util.Utility.getLocalizedString("tableBuilder.tooltip.down"),ADD:actuate.util.Utility.getLocalizedString("tableBuilder.tooltip.add"),REMOVE:actuate.util.Utility.getLocalizedString("tableBuilder.tooltip.remove")},initialize:function(){this.id=this._getId(this._classname);this._title=actuate.util.Utility.getLocalizedString("tableBuilder.data");actuate.dialog.impl.helper.AbstractTabDialog.prototype.initialize.call(this);this.__initDataSourceCombo();this._popupMenuHandler_c=actuate.Method.bind(this._popupMenuHandler,this);this._popupDateMenuHandler_c=actuate.Method.bind(this._popupDateMenuHandler,this);this._hyperlinkCheckbox=actuate.widget.ComponentMgr.get("actuate_dialog_SummaryTableDataTab_hyperlinkCheckbox");this._autoSumCheckbox=actuate.widget.ComponentMgr.get("actuate_dialog_SummaryTableDataTab_autoSummarizeCheckbox");this._currentMeasureLabel=actuate.widget.ComponentMgr.get("actuate_dialog_SummaryTableDataTab_currentMeasureLabel");this._eh_autoSummarizeCheck_c=actuate.Method.bind(this._eh_autoSummarizeCheck,this);this._autoSumCheckbox.registerEventHandler("check",this._eh_autoSummarizeCheck_c);this._numericFunctionList=new Array({name:actuate.util.Utility.getLocalizedString("tableBuilder.functionItem.SUM"),value:"SUM"},{name:actuate.util.Utility.getLocalizedString("tableBuilder.functionItem.AVE"),value:"AVE"},{name:actuate.util.Utility.getLocalizedString("tableBuilder.functionItem.MEDIAN"),value:"MEDIAN"},{name:actuate.util.Utility.getLocalizedString("tableBuilder.functionItem.STDDEV"),value:"STDDEV"},{name:actuate.util.Utility.getLocalizedString("tableBuilder.functionItem.VARIANCE"),value:"VARIANCE"},{name:actuate.util.Utility.getLocalizedString("tableBuilder.functionItem.MODE"),value:"MODE"});this._nonNumericMeasureFunctionList=new Array({name:actuate.util.Utility.getLocalizedString("tableBuilder.functionItem.FIRST"),value:"FIRST"},{name:actuate.util.Utility.getLocalizedString("tableBuilder.functionItem.LAST"),value:"LAST"},{name:actuate.util.Utility.getLocalizedString("tableBuilder.functionItem.COUNT"),value:"COUNT"},{name:actuate.util.Utility.getLocalizedString("tableBuilder.functionItem.MAX"),value:"MAX"},{name:actuate.util.Utility.getLocalizedString("tableBuilder.functionItem.MIN"),value:"MIN"},{name:actuate.util.Utility.getLocalizedString("tableBuilder.functionItem.COUNTDISTINCT"),value:"COUNTDISTINCT"});this._nonNumericFunctionList=new Array({name:actuate.util.Utility.getLocalizedString("tableBuilder.functionItem.COUNTDISTINCT"),value:"COUNTDISTINCT"},{name:actuate.util.Utility.getLocalizedString("tableBuilder.functionItem.COUNT"),value:"COUNT"},{name:actuate.util.Utility.getLocalizedString("tableBuilder.functionItem.FIRST"),value:"FIRST"},{name:actuate.util.Utility.getLocalizedString("tableBuilder.functionItem.LAST"),value:"LAST"},{name:actuate.util.Utility.getLocalizedString("tableBuilder.functionItem.MAX"),value:"MAX"},{name:actuate.util.Utility.getLocalizedString("tableBuilder.functionItem.MIN"),value:"MIN"});this._dateFunctionList=new Array({name:actuate.util.Utility.getLocalizedString("summaryTableBuilder.interval.type.dateValue"),value:"none"},{name:actuate.util.Utility.getLocalizedString("summaryTableBuilder.interval.type.year"),value:"year"},{name:actuate.util.Utility.getLocalizedString("summaryTableBuilder.interval.type.quarter"),value:"quarter"},{name:actuate.util.Utility.getLocalizedString("summaryTableBuilder.interval.type.month"),value:"month"},{name:actuate.util.Utility.getLocalizedString("summaryTableBuilder.interval.type.week"),value:"week"},{name:actuate.util.Utility.getLocalizedString("summaryTableBuilder.interval.type.day"),value:"day"},{name:actuate.util.Utility.getLocalizedString("summaryTableBuilder.interval.type.hour"),value:"hour"},{name:actuate.util.Utility.getLocalizedString("summaryTableBuilder.interval.type.minute"),value:"minute"},{name:actuate.util.Utility.getLocalizedString("summaryTableBuilder.interval.type.second"),value:"second"});},__createDataSourceCombo:function(){return actuate.widget.ComponentMgr.get("actuate_dialog_SummaryTableDataTab_dataSetCombo");},_initContent:function(){var H=this;this._componentArray=[];var I={xtype:"fieldset",collapsible:true,title:actuate.util.Utility.getLocalizedString("tableBuilder.data"),checkboxToggle:false,defaults:{border:false,layout:"column",bodyStyle:"padding:0px 0px 0px 0px"},listeners:{collapse:function(){if(H._parentDialog&&H._parentDialog.adjustSize){H._parentDialog.adjustSize();}},expand:function(){if(H._parentDialog&&H._parentDialog.adjustSize){H._parentDialog.adjustSize();}}},items:[{layout:"column",items:[{layout:"form",border:false,labelWidth:136,items:[{id:"actuate_dialog_SummaryTableDataTab_dataSetCombo",width:430,fieldLabel:actuate.util.Utility.getLocalizedString("tableBuilder.useDataFrom"),xtype:"treecombo",editable:false,forceSelection:true,autoExpand:true,style:"margin-right:3px",valueField:"value",displayField:"title",titleField:"title",icons:this.__dataSourceIcons,sortInfo:{folderSort:true,field:"text",direction:"ASC"},showTooltip:true,store:new actuate.widget.custom.TreeCombo.TreeComboStore(this.__dataSourceComboStore)}]}]},{items:[{id:"actuate_dialog_SummaryTableDataTab_hyperlinkCheckbox",xtype:"checkbox",checked:true,boxLabel:actuate.util.Utility.getLocalizedString("common.dataTab.useHyperlink")}]}]};this._componentArray.push(I);var K="";var B="<img src='"+actuate.getDefaultIportalUrl()+"iportal/common/images/column_select.png'/>";var D="<img src='"+actuate.getDefaultIportalUrl()+"iportal/jsapi/actuate/dialog/images/cube/crosstab_summary.png'/>";var G={xtype:"fieldset",collapsible:true,title:actuate.util.Utility.getLocalizedString("tableBuilder.fields"),layout:"table",layoutConfig:{columns:4},bodyStyle:"padding:1px 0px 0px 0px",listeners:{collapse:function(){if(H._parentDialog&&H._parentDialog.adjustSize){H._parentDialog.adjustSize();}},expand:function(){if(H._parentDialog&&H._parentDialog.adjustSize){H._parentDialog.adjustSize();}}},items:[{colspan:4,id:"actuate_dialog_SummaryTableDataTab_autoSummarizeCheckbox",xtype:"checkbox",checked:true,boxLabel:actuate.util.Utility.getLocalizedString("tableBuilder.summarize"),style:K},{colspan:2,xtype:"label",text:actuate.util.Utility.getLocalizedString("tableBuilder.availableData"),style:K},{colspan:2,layout:"table",border:false,items:[{html:B,border:false},{xtype:"label",text:actuate.util.Utility.getLocalizedString("tableBuilder.currentColumnSelection"),style:K}]},{id:"actuate_dialog_SummaryTableDataTab_tree",rowspan:3},{border:false,items:[{id:"actuate_dialog_SummaryTableDataTab_rightButton"},{id:"actuate_dialog_SummaryTableDataTab_measureleftButton"}]},{id:"actuate_dialog_SummaryTableDataTab_colList"},{border:false,items:[{id:"actuate_dialog_SummaryTableDataTab_upButton"},{id:"actuate_dialog_SummaryTableDataTab_downButton"}]},{xtype:"label",text:""},{colspan:2,layout:"table",border:false,items:[{html:D,border:false},{xtype:"label",id:"actuate_dialog_SummaryTableDataTab_currentMeasureLabel",text:actuate.util.Utility.getLocalizedString("summaryTableBuilder.currentMeasureSelection"),style:K}]},{border:false,items:[{id:"actuate_dialog_SummaryTableDataTab_measurerightButton"},{id:"actuate_dialog_SummaryTableDataTab_measureleftButton"}]},{},{border:false,items:[{id:"actuate_dialog_SummaryTableDataTab_measureUpButton"},{id:"actuate_dialog_SummaryTableDataTab_measureDownButton"}]}]};var F=[];var N=new actuate.widget.tree.TreePanel({rowspan:3,autoScroll:true,width:260,height:230,rootVisible:false,containerScroll:true,dataStore:new actuate.widget.tree.TreeStore(F),selModel:new actuate.widget.tree.MultiSelectionModel(),icons:this.__icons});G.items[3]=N;this._rightButton=new actuate.uiadapter.Button({id:"actuate_tabledata_builder_select_dimension_button_id",cls:"actuate_table_builder_move_buttons actuate_tabledata_builder_move_buttons",disabled:true,icon:this.RIGHT_ENABLE_ICON,tooltip:this._TOOLTIP.ADD});G.items[4].items[0]=this._rightButton;this._leftButton=new actuate.uiadapter.Button({id:"actuate_tabledata_builder_remove_dimension_button_id",cls:"actuate_table_builder_move_buttons actuate_tabledata_builder_move_buttons",disabled:true,icon:this.LEFT_ENABLE_ICON,tooltip:this._TOOLTIP.REMOVE});G.items[4].items[1]=this._leftButton;var J=[{type:0,icon:actuate.getDefaultIportalUrl()+"iportal/common/images/column_select.png"}];var E=new actuate.widget.tree.TreePanel({autoScroll:true,width:260,height:100,rootVisible:false,containerScroll:true,dataStore:new actuate.widget.tree.TreeStore(F),selModel:new actuate.widget.tree.MultiSelectionModel(),icons:this.__icons});G.items[5]=E;var C=actuate.getDefaultIportalUrl();this._upButton=new actuate.uiadapter.Button({cls:"actuate_table_builder_up_down_buttons actuate_tabledata_builder_up_down_buttons",id:"actuate_tabledata_builder_up_dimension_button_id",icon:C+"iportal/common/images/up-arrow-disabled.png",tooltip:this._TOOLTIP.UP});G.items[6].items[0]=this._upButton;this._downButton=new actuate.uiadapter.Button({cls:"actuate_table_builder_up_down_buttons actuate_tabledata_builder_up_down_buttons",id:"actuate_tabledata_builder_down_dimension_button_id",icon:C+"iportal/common/images/down-arrow-disabled.png",tooltip:this._TOOLTIP.DOWN});G.items[6].items[1]=this._downButton;this._measureRightButton=new actuate.uiadapter.Button({id:"actuate_tabledata_builder_select_measure_button_id",cls:"actuate_table_builder_move_buttons actuate_tabledata_builder_move_buttons",disabled:true,icon:this.RIGHT_ENABLE_ICON,tooltip:this._TOOLTIP.ADD});G.items[9].items[0]=this._measureRightButton;this._measureLeftButton=new actuate.uiadapter.Button({id:"actuate_tabledata_builder_remove_measure_button_id",cls:"actuate_table_builder_move_buttons actuate_tabledata_builder_move_buttons",disabled:true,icon:this.LEFT_ENABLE_ICON,tooltip:this._TOOLTIP.REMOVE});G.items[9].items[1]=this._measureLeftButton;this._selectedMeasureStore=new actuate.widget.data.SimpleStore({fields:["value","columnName","aggregation","aggregationValue","index","shortColumnName","disabled","title"],sortInfo:{field:"index",direction:"ASC"}});var M=new actuate.widget.form.ListBox({store:this._selectedMeasureStore,width:258,height:100,multiSelect:true,tpl:this._TEMPLATE_SELECTED_DATA_LIST,style:"border-color: #7f9db9",disabledClass:"actuate_table_builder_list_disabled",itemSelector:".actuate-summarytable-div"});G.items[10]=M;this._measureList=M;this._measureUpButton=new actuate.uiadapter.Button({cls:"actuate_table_builder_up_down_buttons actuate_tabledata_builder_up_down_buttons",id:"actuate_tabledata_builder_up_measure_button_id",icon:C+"iportal/common/images/up-arrow-disabled.png",tooltip:this._TOOLTIP.UP});G.items[11].items[0]=this._measureUpButton;this._measureDownButton=new actuate.uiadapter.Button({cls:"actuate_table_builder_up_down_buttons actuate_tabledata_builder_up_down_buttons",id:"actuate_tabledata_builder_down_measure_button_id",icon:C+"iportal/common/images/down-arrow-disabled.png",tooltip:this._TOOLTIP.DOWN});G.items[11].items[1]=this._measureDownButton;this._componentArray.push(G);this._itemsTree=N;this._selectedTree=E;this._rightButton.registerEventHandler("click",actuate.Method.bind(this._rightButtonClick,this),false);this._leftButton.registerEventHandler("click",actuate.Method.bind(this._leftButtonClick,this),false);this._measureRightButton.registerEventHandler("click",actuate.Method.bind(this._measureRightButtonClick,this),false);this._measureLeftButton.registerEventHandler("click",actuate.Method.bind(this._measureLeftButtonClick,this),false);this._upButton.registerEventHandler("click",actuate.Method.bind(this._upButtonClick,this),false);this._downButton.registerEventHandler("click",actuate.Method.bind(this._downButtonClick,this),false);this._measureUpButton.registerEventHandler("click",actuate.Method.bind(this._measureUpButtonClick,this),false);this._measureDownButton.registerEventHandler("click",actuate.Method.bind(this._measureDownButtonClick,this),false);this._measureList.registerEventHandler("click",actuate.Method.bind(this._selectedMeasureClick,this),false);this._measureList.registerEventHandler("select",actuate.Method.bind(this._selectedMeasureClick,this),false);var L=actuate.Method.bind(this._eh_onMeasureBeforeSelect,this);this._measureList.registerEventHandler("beforeclick",L);this._measureList.registerEventHandler("beforeselect",L);var A=actuate.Method.bind(this._eh_onBeforeSelect,this);this._itemsTree.getSelectionModel().registerEventHandler("beforeselect",A);this._itemsTree.getSelectionModel().registerEventHandler("selectionchange",actuate.Method.bind(this._itemsTreeChange,this));this._selectedTree.getSelectionModel().registerEventHandler("selectionchange",actuate.Method.bind(this._selectedTreeChange,this));this._pixelPerInch=actuate.util.Utility.convertInchToPixel();},_selectedTreeChange:function(B){if(!B||!B.selNodes||B.selNodes.length<=0||!B.selNodes[0].attributes){return ;}var E=this.__getSelectedNodes(this._selectedTree);var C=actuate.getDefaultIportalUrl();if(!E||E.length<=0){this._leftButton.disable();this._upButton.setIcon(C+"iportal/common/images/up-arrow-disabled.png");this._downButton.setIcon(C+"iportal/common/images/down-arrow-disabled.png");}else{if(E.length==1&&E[0].disabled){this._leftButton.disable();}else{this._leftButton.enable();}var D=E[0];if(D!=null){if(D.previousSibling==null){this._upButton.setIcon(C+"iportal/common/images/up-arrow-disabled.png");}else{this._upButton.setIcon(C+"iportal/common/images/up-arrow.png");}}var A=E[E.length-1];if(A!=null){if(A.nextSibling==null){this._downButton.setIcon(C+"iportal/common/images/down-arrow-disabled.png");}else{this._downButton.setIcon(C+"iportal/common/images/down-arrow.png");}}}},_itemsTreeChange:function(A){if(!A||!A.selNodes||A.selNodes.length<=0||!A.selNodes[0].attributes){return ;}if(!this._autoSumCheckbox.getValue()){var B=this.__getSelectedNodes(this._itemsTree);if(!B||B.length<=0){this._rightButton.disable();}else{if(B.length==1&&B[0].disabled){this._rightButton.disable();}else{this._rightButton.enable();}}return ;}this._measureRightButton.disable();this._rightButton.disable();if(A.selNodes[0].attributes.type=="dimension"||A.selNodes[0].attributes.type=="attribute"||A.selNodes[0].attributes.type==""){if(A.selNodes[0].disabled==false){this._rightButton.enable();}}if(A.selNodes[0].disabled==false){this._measureRightButton.enable();this._rightButton.enable();}},_selectedMeasureClick:function(D,B,A,C){this._enableDisableMeasureUpDownButtons();var F=this._measureList.getSelectedRecords(true);if(F!=null&&F.length==1){this._measureLeftButton.enable();A=F[0];if(A!=null&&A.data!=null&&A.data.disabled=="true"){this._measureLeftButton.disable();}}if(C==null){return ;}var E=actuate.uiadapter.Element.fly(C.getTarget());if(E.hasClass("actuate-summarytable-img")){this._popupMenu(A,E.parent());}},_popupMenu:function(A,D){if(!this._aggrMenu){this._aggrMenu=new actuate.widget.menu.Menu({id:"actuate_dialog_SummaryTableDataTab_AggregationPopupMenu"});}var E=A.data.value;var B=this._getDataType(E);this._aggrMenu.removeAll();this._aggrMenu.currentRecord=A;var F="aggr";if(B=="float"||B=="integer"||B=="decimal"||B=="double"){for(var C=0;C<this._numericFunctionList.length;C++){this._aggrMenu.addMenuItem({id:this._numericFunctionList[C].value,text:this._numericFunctionList[C].name,group:F,handler:this._popupMenuHandler_c});}for(var C=0;C<this._nonNumericFunctionList.length;C++){this._aggrMenu.addMenuItem({id:this._nonNumericFunctionList[C].value,text:this._nonNumericFunctionList[C].name,group:F,handler:this._popupMenuHandler_c});}}else{for(var C=0;C<this._nonNumericMeasureFunctionList.length;C++){this._aggrMenu.addMenuItem({id:this._nonNumericMeasureFunctionList[C].value,text:this._nonNumericMeasureFunctionList[C].name,group:F,handler:this._popupMenuHandler_c});}}this._aggrMenu.show(D);},_popupMenuHandler:function(B){var A=this._aggrMenu.currentRecord;A.data.aggregation=B.text;A.data.aggregationValue=B.id;A.commit();},loadData:function(A,B){this._hasNewDatamart=false;if(A&&A.DataMarts){this._data=A;this.__showAllDataSources();}if(this._data&&this._data.DataMarts&&this._data.DataMarts.length>0){if(A.ColumnDef){if(!A.DataSet.dataObject){A.DataSet.dataObject=A.DataSet.dataSetName;}this.__selectDataSource(A.DataSet,"dataset");this._usedData={"dataSet":A.DataSet.dataSourceName+" - "+A.DataSet.dataObject,"columnDefs":A.ColumnDef,"aggregations":A.Aggregations,"bindingsMap":A[actuate.model.Constant.MetadataType.ELEMENT].bindingsMap,"summaryTable":B};}this.__onSelectDataSource();if(A.Filter){this._filter=A.Filter;}}},__addToDataSourceStore:function(A,B,C){if(B!="cube"){actuate.dialog.impl.helper.summarytablebuilder.SummaryTableDataTab.superclass.__addToDataSourceStore.call(this,A,B,C);}},_getFunctionName:function(C){if(C){var D=[];D=D.concat(this._numericFunctionList,this._nonNumericFunctionList);for(var B=0;B<D.length;B++){var A=D[B].value;if(A&&A.toUpperCase()==C.toUpperCase()){return D[B].name;}}}return null;},_getIntervalName:function(B){for(var A=0;A<this._dateFunctionList.length;A++){if(this._dateFunctionList[A].value==B){return this._dateFunctionList[A].name;}}},_preHide:function(){this._dataManagerMetadata=null;this._clearControls();},_clearControls:function(){this.__dataSourceCombo.clear();this.__dataSourceCombo.setValue("");this._dataManagerSoap=null;this._clearTree(this._itemsTree);this._clearTree(this._selectedTree);this._selectedMeasureStore.removeAll();this._usedData=null;this.__clearFilter();this._hyperlinkCheckbox.setValue(true);this._autoSumCheckbox.enable();this._autoSumCheckbox.setValue(true);this._bindingsMap=null;var A=actuate.getDefaultIportalUrl();this._measureUpButton.setIcon(A+"iportal/common/images/up-arrow-disabled.png");this._measureDownButton.setIcon(A+"iportal/common/images/down-arrow-disabled.png");this._upButton.setIcon(A+"iportal/common/images/up-arrow-disabled.png");this._downButton.setIcon(A+"iportal/common/images/down-arrow-disabled.png");},_clearTree:function(B){B.getSelectionModel().clearSelections();var A;while(A=B.root.childNodes[0]){B.root.removeChild(A);}},__onSelectDataSource:function(){this.__clearFilter();this._disableUpDownButtons();var A=this.__getSelectedDataSourceInfo();this._measureLeftButton.disable();this._leftButton.disable();var D=[];if(A){D=A[1].columns;}var B=0;var E=false;for(var C=0;C<D.length;C++){if(D[C].hasAction){E=true;break;}}this._hyperlinkCheckbox.disable();this._hyperlinkCheckbox.setValue(false);if(E){this._hyperlinkCheckbox.enable();this._hyperlinkCheckbox.setValue(true);}this._resetItemsTree();this._showUsedDataBindings();this._clearFilterUI=true;actuate.dialog.impl.helper.summarytablebuilder.SummaryTableDataTab.superclass.__onSelectDataSource.call(this);this._measureRightButton.disable();this._measureLeftButton.disable();this._rightButton.disable();this._leftButton.disable();},_resetItemsTree:function(){var A=this.__dataSourceCombo.getValue();this._clearTree(this._selectedTree);this._selectedMeasureStore.removeAll();this._itemsTree.getStore().removeAll();this.__setTreeStoreValues(this._itemsTree.getStore(),A);this._itemsTree.refresh();this._itemsTree.expandAll();},_disableUpDownButtons:function(){var A=actuate.getDefaultIportalUrl();this._upButton.setIcon(A+"iportal/common/images/up-arrow-disabled.png");this._downButton.setIcon(A+"iportal/common/images/down-arrow-disabled.png");this._measureUpButton.setIcon(A+"iportal/common/images/up-arrow-disabled.png");this._measureDownButton.setIcon(A+"iportal/common/images/down-arrow-disabled.png");},_getDataSetColumn:function(D){var A=this.__getSelectedDataSourceInfo();var C=A[1].columns;for(var B=0;B<C.length;B++){if(C[B].name==D){return C[B];}}return"";},_getAnalysisType:function(D){var A=this.__getSelectedDataSourceInfo();var C=A[1].columns;for(var B=0;B<C.length;B++){if(C[B].name==D){return C[B].analysis;}}return null;},_getAnalysisColumn:function(D){var A=this.__getSelectedDataSourceInfo();var C=A[1].columns;for(var B=0;B<C.length;B++){if(C[B].name==D){return C[B].analysisColumn;}}return"";},_getDataType:function(E){var A=this.__getSelectedDataSourceInfo();var D=A[1].columns;for(var C=0;C<D.length;C++){var B=E;if(B&&B.name){B=B.name;}if(D[C].name==B){return D[C].dataType;}}},_eh_autoSummarizeCheck:function(){var B=actuate.getDefaultIportalUrl();if(this._autoSumCheckbox.getValue()){this._measureLeftButton.enable();if(this._isEmptyTree(this._selectedTree)){this._leftButton.disable();}if(this._selectedMeasureStore.getCount()<=0){this._measureLeftButton.disable();}var C=this.__getSelectedNodes(this._itemsTree);if(C&&C.length==1){var A=C[0].attributes!=null?C[0].attributes.type:"";if(A=="measure"){if(C[0].disabled==false){this._measureRightButton.enable();this._rightButton.enable();}}else{this._measureRightButton.disable();}}else{this._measureRightButton.disable();}this._measureList.enable();this._currentMeasureLabel.getEl().dom.style.color="black";if(this._selectedMeasureStore.getCount()>1){this._enableDisableMeasureUpDownButtons();}else{this._measureUpButton.setIcon(B+"iportal/common/images/up-arrow-disabled.png");this._measureDownButton.setIcon(B+"iportal/common/images/down-arrow-disabled.png");}this._showDateMenu(true);this._formTree();}else{this._measureLeftButton.disable();this._measureRightButton.disable();this._measureList.disable();this._currentMeasureLabel.getEl().dom.style.color="gray";this._measureUpButton.setIcon(B+"iportal/common/images/up-arrow-disabled.png");this._measureDownButton.setIcon(B+"iportal/common/images/down-arrow-disabled.png");var C=this.__getSelectedNodes(this._itemsTree);if(C&&C.length==1){if(C[0].disabled==false){this._rightButton.enable();}else{this._rightButton.disable();}}this._showDateMenu(false);this._flattenTree();var C=this.__getSelectedNodes(this._itemsTree);if(!C||C.length<=0){this._rightButton.disable();}}this.__selectionChangedHandler();},_showDateMenu:function(A){var B=this._selectedTree.getRootNode();if(B.hasChildNodes()){var E=0;var D=B.childNodes;for(var C=0;C<D.length;C++){if(D[C].ui.showMenu){D[C].ui.showMenu(A);}}}},_changeFilterPanel:function(B){if(this._parentDialog._filterPanel){var C={};var A=this.__getSelectedDataSourceInfo();if(A){C.dataObject=[A[1],A[4],A[3]];C.dataObjectSoap=this.createDataSetSoap(A);C.dataMartSoap=this._dataManagerSoap;C.clearFilterUI=this._clearFilterUI;C.target="Table";}if(this._filter){C.Filter=this._filter;}this._parentDialog._filterPanel.loadData(C);}},_showUsedNormalTableDataBindings:function(){this._autoSumCheckbox.setValue(false);var D=this.__getSelectedDataSourceInfo();var H=null;if(this._usedData!=null&&D&&this._usedData.dataSet==D[0]+" - "+D[1].name){this._leftButton.enable();H=false;for(var J in this._usedData.columnDefs){var C=this._usedData.columnDefs[J];if(this._bindingsMap==null){this._bindingsMap=C.table.bindingsMap;}if(this._isColumnDeleted(C,J)){continue;}var K=C.table;if(K!=null&&K.copyHyperlink!=null){H=K.copyHyperlink=="true"?true:false;}var B=C.isGrouped?C.groupName:C.bindingName;var G=this._getDataSetColumn(B);var F=G.displayName;if(F==null||F==""){F=B;}var A=this._selectedTree.getRootNode().findChild("id",B);if(A==null){var I="";if(C.isEditableExpression==true){I="measure";}else{I=this._getAnalysisType(B);}var E=F;if(this._hasDependents(B)){E=F+" "+actuate.util.Utility.getLocalizedString("tableBuilder.isInUse");}A=this._selectedTree.getRootNode().appendChild({id:B,text:F.length>25?F.substr(0,22)+"...":F,index:C.index,type:I,dateFunction:"",dateFunctionValue:"",title:E});}if(this._hasDependents(A.id)){A.disable();}}}this._sortSelectedTree();if(H==true){this._hyperlinkCheckbox.setValue(true);}else{if(H==false){this._hyperlinkCheckbox.setValue(false);}}},_isColumnDeleted:function(B,E){var D=B.table;var A=true;for(var C in D.columnsOrder){if(E==D.columnsOrder[C]){A=false;return A;}}return A;},_getColumnDef:function(C){if(this._usedData!=null&&this._usedData.columnDefs!=null){for(var D in this._usedData.columnDefs){var B=this._usedData.columnDefs[D];var A=B.isGrouped?B.groupName:B.bindingName;if(A==null){continue;}if(A==C){return B;}}}return null;},_showUsedDataBindings:function(){if(this._usedData!=null){this._autoSumCheckbox.disable();}else{this._autoSumCheckbox.enable();}var U=this.__getSelectedDataSourceInfo();if(this._usedData!=null&&this._usedData.summaryTable==false){this._showUsedNormalTableDataBindings();return ;}var I=null;var E=null;if(this._usedData!=null&&U&&this._usedData.dataSet==U[0]+" - "+U[1].name){I=false;this._bindingsMap=null;for(var Q in this._usedData.columnDefs){this._leftButton.enable();var Y=this._usedData.columnDefs[Q];if(this._bindingsMap==null){this._bindingsMap=Y.table.bindingsMap;}var G;var T;if(Y.isGrouped){G=Y.groupName;if(Y.originalBindingName){G=Y.originalBindingName;}T=this._getDataSetColumn(G);}if(!G||!T){G=Y.bindingName;T=this._getDataSetColumn(G);}if(G==null){continue;}var X=Y.table;if(X!=null&&X.copyHyperlink!=null){I=X.copyHyperlink=="true"?true:false;}var J=T.displayName;if(!J){J=G;}var Z=J;if(this._hasDependents(G)){Z=J+" "+actuate.util.Utility.getLocalizedString("tableBuilder.isInUse");}var K="";var A=this._selectedTree.getRootNode().findChild("id",G);if(this._isDateTime(G)&&Y.isGrouped==true&&A==null){var N=Y.getGroup();var L=actuate.util.Utility.getLocalizedString("summaryTableBuilder.interval.type.dateValue");var M="none";if(N!=null){L=this._getIntervalName(N.intervalType);M=N.intervalType;}E=this._selectedTree.getRootNode().appendChild({id:G,text:J.length>25?J.substr(0,22)+"...":J,index:Y.index,type:this._getAnalysisType(G),originalBindingName:Y.originalBindingName,bindingName:Y.bindingName,dateFunction:L,dateFunctionValue:M,uiProvider:actuate.widget.custom.SummaryTableTreeNodeUI,title:Z,dataType:this._getDataType(G)});}else{if(this._getAnalysisType(G)==""||this._getAnalysisType(G)=="attribute"||Y.isGrouped==true){var C=this._getAnalysisColumn(G);if(C&&C!=""){var S=this._selectedTree.getRootNode().findChild("id",C);if(S==null){var B=this._getDataSetColumn(C);var W=B.displayName;if(W==null||W==""){W=C;}var V=W;if(this._hasDependents(W)){V=W+" "+actuate.util.Utility.getLocalizedString("tableBuilder.isInUse");}if(this._isDateTime(W)){var P=this._getColumnDef(C);var N=P==null?null:P.getGroup();var L=actuate.util.Utility.getLocalizedString("summaryTableBuilder.interval.type.dateValue");var M="none";if(N!=null){L=this._getIntervalName(N.intervalType);M=N.intervalType;}E=this._selectedTree.getRootNode().appendChild({id:C,text:W.length>25?W.substr(0,22)+"...":W,index:Y.index,type:this._getAnalysisType(C),dateFunction:L,dateFunctionValue:M,uiProvider:actuate.widget.custom.SummaryTableTreeNodeUI,title:Z,dataType:this._getDataType(W)});}else{E=this._selectedTree.getRootNode().appendChild({id:C,text:W.length>25?W.substr(0,22)+"...":W,index:Y.index,type:this._getAnalysisType(C),dateFunction:"",dateFunctionValue:"",title:V});}}S=this._selectedTree.getRootNode().findChild("id",C);E=S.appendChild({id:G,text:J.length>25?J.substr(0,22)+"...":J,index:Y.index,type:this._getAnalysisType(G),dateFunction:"",dateFunctionValue:"",title:Z});S.expand(true,false);if(!this._isInColumnDef(this._usedData.columnDefs,C)){S.disable();}else{S.enable();}}else{var S=this._selectedTree.getRootNode().findChild("id",G);if(S==null){E=this._selectedTree.getRootNode().appendChild({id:G,text:J.length>25?J.substr(0,22)+"...":J,index:Y.index,type:this._getAnalysisType(G),dateFunction:"",dateFunctionValue:"",title:Z});}else{E=S;}}}}if(E!=null&&this._hasDependents(this._getCurrNodeid(E))){E.disable();}}for(var H in this._usedData.aggregations){this._measureLeftButton.enable();var O=this._usedData.aggregations[H];for(var R=0;R<O.length;R++){var T=this._getDataSetColumn(H);var D=(T==null||T=="");var J=T.displayName;if(J==null||J==""){J=H;}var F="false";if(this._hasDependents(O[R].bindingName)){F="true";}var Z=J+" "+actuate.util.Utility.getLocalizedString("tableBuilder.isInUse");var K=new this._selectedMeasureStore.recordType({columnName:J,value:H,aggregation:(D?"":this._getFunctionName(O[R].functionName)),aggregationValue:(D?"":O[R].functionName),index:O[R].index,shortColumnName:J.length>25?J.substr(0,22)+"...":J,disabled:F,title:Z});this._selectedMeasureStore.addSorted(K);}}for(var Q in this._usedData.columnDefs){var Y=this._usedData.columnDefs[Q];var G=Y.isGrouped?Y.groupName:Y.bindingName;if(G==null){continue;}if(Y.isEditableExpression){var J=G;var F="false";if(this._hasDependents(G)){F="true";}var Z=G+" "+actuate.util.Utility.getLocalizedString("tableBuilder.isInUse");var K=new this._selectedMeasureStore.recordType({columnName:G,value:G,aggregation:"",aggregationValue:"",index:Y.index,shortColumnName:J.length>25?J.substr(0,22)+"...":J,disabled:F,title:Z});this._selectedMeasureStore.addSorted(K);}}}this._sortSelectedTree();if(I==true){this._hyperlinkCheckbox.setValue(true);}else{if(I==false){this._hyperlinkCheckbox.setValue(false);}}},_getComputedColumnExpression:function(C){for(var D in this._usedData.columnDefs){var B=this._usedData.columnDefs[D];var A=B.isGrouped?B.groupName:B.bindingName;if(A==null){continue;}if(B.isEditableExpression){if(A==C){return B.expression;}}}var E=this._usedData.bindingsMap[C];if(E){return E.expression;}return null;},_hasDependents:function(B){var A=false;for(var C in this._bindingsMap){var D=this._bindingsMap[C];if(D==null){continue;}else{if(C!=B){continue;}}if(D.hasDependents){return true;}}return A;},_getCurrNodeid:function(A){var B=A;if(A&&A.id){B=A.id;if(A.attributes&&A.attributes.originalBindingName&&A.attributes.bindingName){B=A.bindingName;}}return B;},_isInColumnDef:function(E,C){for(var D in E){var B=this._usedData.columnDefs[D];var A=B.isGrouped?B.groupName:B.bindingName;if(A==null){continue;}if(C==A){return true;}}return false;},_sortSelectedTree:function(){var C=new actuate.widget.tree.TreeSorter(this._selectedTree,{folderSort:true,dir:"asc",registerHandlers:false,sortType:function(D){return D.attributes.index;}});C.doSort(this._selectedTree.getRootNode());var A=this._selectedTree.getRootNode().childNodes;for(var B=0;B<A.length;B++){C.doSort(A[B]);}},_isDateTime:function(B){var A=this._getDataType(B);if(A=="date-time"||A=="date"||A=="time"){return true;}return false;},getDataSelection:function(){var A=this.__getSelectedDataSourceInfo();if(A&&A[1]){return{dataSourceName:A[1].name};}return null;},_upButtonClick:function(){if(this._upButton.getIcon().indexOf("-gray")>=0){return ;}this.__reorderTreeItem(this._selectedTree,true);},_downButtonClick:function(){if(this._downButton.getIcon().indexOf("-gray")>=0){return ;}this.__reorderTreeItem(this._selectedTree,false);},__reorderTreeItem:function(G,J){var L=this.__getSelectedNodes(G);if(!L||L.length<=0){return ;}if(!J){L=L.reverse();}var E=G.getSelectionModel();for(var H=0;H<L.length;H++){var K=L[H];var I=K.parentNode;if(J){var B=K.previousSibling;var D=K.isSelected();if(K&&B){I.insertBefore(K,B);}}else{var F=K.nextSibling;if(K&&F){I.insertBefore(F,K);}}if(D){E.select(K,null,true);}}if(G!=this._selectedTree){return ;}var A=this.__getSelectedNodes(G);var C=actuate.getDefaultIportalUrl();if(A.length>0&&A[0].previousSibling==null){this._upButton.setIcon(C+"iportal/common/images/up-arrow-disabled.png");}else{this._upButton.setIcon(C+"iportal/common/images/up-arrow.png");}if(A.length>0&&A[A.length-1].nextSibling==null){this._downButton.setIcon(C+"iportal/common/images/down-arrow-disabled.png");}else{this._downButton.setIcon(C+"iportal/common/images/down-arrow.png");}},_leftButtonClick:function(){var G=this.__getSelectedNodes(this._selectedTree);if(G&&G.length>0){for(var B=0;B<G.length;B++){var D=G[B];if(this._hasDependents(this._getCurrNodeid(D))){continue;}var A=D.parentNode;if(A.isRoot==true&&this._hasDisabledChild(D)){var E=D.id+" "+actuate.util.Utility.getLocalizedString("tableBuilder.hasDisabledChild");actuate.widget.MessageBox.show({title:actuate.util.Utility.getLocalizedString("tableBuilder.alertTitle"),msg:E,buttons:actuate.widget.MessageBox.OK,icon:actuate.widget.MessageBox.WARNING});break;}if(D.nextSibling){D.nextSibling.select();}else{if(D.previousSibling){var C=D.previousSibling;if(C.lastChild){C.lastChild.select();}else{C.select();}}else{D.parentNode.firstChild.select();}}A.removeChild(D);if(A.disabled==true&&!this._hasDependents(A.id)&&A.childNodes.length==0){var F=A.parentNode.removeChild(A);}}}if(this._isEmptyTree(this._selectedTree)){this._leftButton.disable();}},_hasDisabledChild:function(C){for(var A=0;A<C.childNodes.length;A++){var B=C.childNodes[A];if(B!=null&&this._hasDependents(B.id)){return true;}}return false;},__getSelectedNodes:function(A){var C=[];var B=A.getSelectionModel().getSelectedNodes();if(B&&B.length>0){C=[].concat(B);}return C;},_moveChildAttributesToTree:function(D,A){for(var B=0;B<D.length;B++){var C=D[B];if(C!=null&&C.disabled){continue;}targetNode=A.appendChild({id:C.id,text:C.text.length>25?C.text.substr(0,22)+"...":C.text,index:C.attributes.index,type:C.attributes.type,dateFunction:"",dateFunctionValue:"",title:C.text});}},_rightButtonClick:function(){var L=this.__getSelectedNodes(this._itemsTree);if(L&&L.length>0){this._leftButton.enable();var C=false;if(L[0]==this._itemsTree.getRootNode().firstChild&&this._itemsTree.getRootNode().firstChild.hasChildNodes()){L=this._itemsTree.getRootNode().firstChild.childNodes;C=true;}for(var F=0;F<L.length;F++){var G=L[F];if(G!=null&&G.disabled){continue;}var D=G.attributes.type;var E=false;var I=false;var M=G;if(this._selectedTree){if(D=="attribute"&&this.isSummarize()){var K=G.parentNode;var J=K.attributes.type;if(J&&J=="dimension"){G=K;E=true;}}else{if(D=="dimension"){I=true;}}var H=this._selectedTree.getNodeById(G.id);if(H){if(this._hasDependents(H.id)){continue;}if(M==G){H.enable();}}else{if(this._isDateTime(G.id)&&this._autoSumCheckbox.getValue()&&G.attributes.type=="dimension"){H=this._selectedTree.getRootNode().appendChild({id:G.id,text:G.text.length>25?G.text.substr(0,22)+"...":G.text,index:G.attributes.index,type:G.attributes.type,dateFunction:actuate.util.Utility.getLocalizedString("summaryTableBuilder.interval.type.dateValue"),dateFunctionValue:"none",uiProvider:actuate.widget.custom.SummaryTableTreeNodeUI,title:G.text,dataType:this._getDataType(G.id)});}else{H=this._selectedTree.getRootNode().appendChild({id:G.id,text:G.text.length>25?G.text.substr(0,22)+"...":G.text,index:G.attributes.index,type:G.attributes.type,dateFunction:"",dateFunctionValue:"",title:G.text});}if(G.hasChildNodes()&&C==true){var B=G.childNodes;if(this.isSummarize()){this._moveChildAttributesToTree(B,H);}else{this._moveChildAttributesToTree(B,this._selectedTree.getRootNode());}}if(E){H.disable();}else{H.enable();}}if(M!=G){var A=this._appendNode(H,M);A.select();if(M.nextSibling){M.nextSibling.select();}else{if(G.nextSibling){G.nextSibling.select();}else{G.parentNode.firstChild.select();}}continue;}else{if(D=="dimension"){}else{this._nodeCopy(G,H,I);}}if(H){H.select();H.expand(true,false);}}if(G.hasChildNodes()){G.childNodes[0].select();}else{if(G.nextSibling){G.nextSibling.select();}else{if(G.parentNode&&G.parentNode.nextSibling){G.parentNode.nextSibling.select();}else{G.parentNode.firstChild.select();}}}}}},_appendNode:function(C,B){var A=C.findChild("id",B.id);if(A!=null){return A;}if(this._isDateTime(B.id)&&this._autoSumCheckbox.getValue()&&B.attributes.type=="dimension"){A=C.appendChild({id:B.id,text:B.text.length>25?B.text.substr(0,22)+"...":B.text,index:B.attributes.index,type:B.attributes.type,dateFunction:actuate.util.Utility.getLocalizedString("summaryTableBuilder.interval.type.dateValue"),dateFunctionValue:"none",uiProvider:actuate.widget.custom.SummaryTableTreeNodeUI,title:B.text,dataType:this._getDataType(B.id)});}else{A=C.appendChild({id:B.id,text:B.text.length>25?B.text.substr(0,22)+"...":B.text,index:B.attributes.index,type:B.attributes.type,dateFunction:"",dateFunctionValue:"",title:B.text});}return A;},_nodeCopy:function(B,E,A){if(!B||!E){return ;}if(B.hasChildNodes()){var F=B.childNodes;for(var D=0;D<F.length;D++){var C=this._appendNode(E,F[D]);if(C&&A){C.disable();}else{C.enable();}}}},_measureUpButtonClick:function(B){actuate.util.Event.stop(B);if(this._measureUpButton.getIcon().indexOf("-gray")>=0){return ;}var A=this._measureList.getSelectedIndex();if(A==0){return ;}this._measureList.swap(A,A-1);this._enableDisableMeasureUpDownButtons();},_enableDisableMeasureUpDownButtons:function(){var B=this._measureList.getSelectedIndexes();if(B.length>0){var A=actuate.getDefaultIportalUrl();if(B[0]==0){this._measureUpButton.setIcon(A+"iportal/common/images/up-arrow-disabled.png");}else{this._measureUpButton.setIcon(A+"iportal/common/images/up-arrow.png");}if(B[B.length-1]==this._measureList.getStore().getCount()-1){this._measureDownButton.setIcon(A+"iportal/common/images/down-arrow-disabled.png");}else{this._measureDownButton.setIcon(A+"iportal/common/images/down-arrow.png");}}},_measureDownButtonClick:function(B){actuate.util.Event.stop(B);if(this._measureDownButton.getIcon().indexOf("-gray")>=0){return ;}var A=this._measureList.getSelectedIndex();if(A==this._measureList.getLength()-1){return ;}this._measureList.swap(A,A+1);this._enableDisableMeasureUpDownButtons();},_measureRightButtonClick:function(){var I=this._itemsTree.getSelectionModel().getSelectedNodes();if(I){this._measureLeftButton.enable();for(var B=0;B<I.length;B++){var E=I[B];if(E.childNodes.length==0){var H=this._getDataType(E.id);var C="false";var G=E.text+" "+actuate.util.Utility.getLocalizedString("tableBuilder.isInUse");if(H=="float"||H=="integer"||H=="decimal"||H=="double"){var F=new this._selectedMeasureStore.recordType({columnName:E.text,value:E.id,aggregation:this._getFunctionName("SUM"),aggregationValue:"SUM",index:0,shortColumnName:E.text.length>25?E.text.substr(0,22)+"...":E.text,disabled:C,title:G});this._selectedMeasureStore.add(F);}else{var F=new this._selectedMeasureStore.recordType({columnName:E.text,value:E.id,aggregation:this._getFunctionName("COUNT"),aggregationValue:"COUNT",index:0,shortColumnName:E.text.length>25?E.text.substr(0,22)+"...":E.text,disabled:C,title:G});this._selectedMeasureStore.add(F);}if(E.nextSibling){E.nextSibling.select();}else{if(E.previousSibling){E.previousSibling.select();}}}else{var D=0;while(D<E.childNodes.length){var A=E.childNodes[D];var H=this._getDataType(A.id);var C="false";var G=A.text+" "+actuate.util.Utility.getLocalizedString("tableBuilder.isInUse");if(H=="float"||H=="integer"||H=="decimal"||H=="double"){var F=new this._selectedMeasureStore.recordType({value:A.id,columnName:A.text,aggregation:this._getFunctionName("SUM"),aggregationValue:"SUM",index:0,shortColumnName:A.id.length>25?A.id.substr(0,22)+"...":A.id,disabled:C,title:G});this._selectedMeasureStore.add(F);}else{var F=new this._selectedMeasureStore.recordType({value:A.id,columnName:A.text,aggregation:this._getFunctionName("COUNT"),aggregationValue:"COUNT",index:0,shortColumnName:A.id.length>25?A.id.substr(0,22)+"...":A.id,disabled:C,title:G});this._selectedMeasureStore.add(F);}D++;}break;}}this._measureList.setSelectedIndex(this._selectedMeasureStore.getCount()-1);this._enableDisableMeasureUpDownButtons();}},_measureLeftButtonClick:function(){if(this._measureList.getSelectedIndex()==-1){return ;}var A=this._measureList.getSelectedIndexes();var C=this._measureList.getSelectedRecords(true);for(var B=0;B<C.length;B++){if(C[B].data.disabled=="false"){this._selectedMeasureStore.remove(C[B]);}}if(this._selectedMeasureStore.getCount()==0){this._measureLeftButton.disable();}else{var D=A[A.length-1];if(D>=this._selectedMeasureStore.getCount()){this._measureList.setSelectedIndex(this._selectedMeasureStore.getCount()-1);}else{this._measureList.setSelectedIndex(D);}}this._enableDisableMeasureUpDownButtons();},_flattenTree:function(){var C=this._selectedTree.getRootNode();if(C.hasChildNodes()){var A=this._selectedTree.getRootNode().childNodes;var B=A.splice(0,A.length);this._clearTree(this._selectedTree);for(var D=0;D<B.length;D++){if(B[D].disabled==false){this._selectedTree.getRootNode().appendChild(B[D]);}else{this._selectedTree.getRootNode().removeChild(B[D]);}if(B[D].hasChildNodes()){var F=B[D].childNodes;while(B[D].hasChildNodes()){var E=B[D].childNodes[0];if(E.disabled==false){this._selectedTree.getRootNode().appendChild(E);}}}}}},_formTree:function(){var D=this._selectedTree.getRootNode();if(D.hasChildNodes()){var B=D.childNodes;var F=0;while(F<D.childNodes.length){var I=D.childNodes[F];if(this._getAnalysisType(I.id)=="attribute"){var H=this._getAnalysisColumn(I.id);if(H&&H!=""){var C=this._selectedTree.getRootNode().findChild("id",H);if(C==null){var A=this._getDataSetColumn(H);var G=A.displayName;if(G==null||G==""){G=H;}if(this._isDateTime(H)){C=this._selectedTree.getRootNode().appendChild({id:H,text:G.length>25?G.substr(0,22)+"...":G,index:A.index,type:this._getAnalysisType(H),dateFunction:actuate.util.Utility.getLocalizedString("summaryTableBuilder.interval.type.dateValue"),dateFunctionValue:"none",uiProvider:actuate.widget.custom.SummaryTableTreeNodeUI,title:G,dataType:this._getDataType(H)});}else{C=this._selectedTree.getRootNode().appendChild({id:H,text:G.length>25?G.substr(0,22)+"...":G,index:A.index,type:this._getAnalysisType(H),dateFunction:"",dateFunctionValue:"",title:G});C.disable();}}C=this._selectedTree.getRootNode().findChild("id",H);C.appendChild(I);}else{F++;}}else{F++;}}this._selectedTree.getRootNode().expandChildNodes(true);var E=D.childNodes;var F=0;while(F<D.childNodes.length){if(E[F].attributes.type=="measure"){D.removeChild(E[F]);}else{F++;}}}},createDataSetSoap:function(){var G=actuate.util.XmlDom.createXMLDom(actuate.util.Constants.soap.NAMESPACE_ACTUATE10,actuate.Constant.tag.Data);var H=this.__getSelectedDataSourceInfo();var K=H[1].name;var E=H[0];if(E==null){E="";}var I=H[2];var F=actuate.util.XmlDom.createElement(G,"DataSetDef");var C=actuate.util.XmlDom.createElement(G,"Name");var B=actuate.util.XmlDom.createElement(G,"DataSource");var J=actuate.util.XmlDom.createElement(G,"DataMartName");var D=G.createTextNode(K);C.appendChild(D);F.appendChild(C);var N=H[4];if(N){var A=(N.toLowerCase()=="data")?actuate.dialog.impl.constant.DataMartAccessType.LATEST:actuate.dialog.impl.constant.DataMartAccessType.TRANSIENT;var L=actuate.util.XmlDom.createElement(G,"Type");L.appendChild(G.createTextNode(A));B.appendChild(L);}if(E){var M=actuate.util.XmlDom.createElement(G,"DisplayName");D=G.createTextNode(E);M.appendChild(D);B.appendChild(M);}D=G.createTextNode(I);J.appendChild(D);B.appendChild(J);F.appendChild(B);return F;},createSoapNode:function(T,J){if(J){if(!this._autoSumCheckbox.getValue()){this._createTableSoapNode(T,J);return ;}var D=actuate.util.XmlDom.createElement(J,"ColumnDefs");var K=this._selectedTree.getRootNode();if(K.hasChildNodes()){var Y=0;var d=K.childNodes;for(var g=0;g<d.length;g++){var b=d[g];var e=actuate.util.XmlDom.createElement(J,"ColumnDef");var a=actuate.util.XmlDom.createElement(J,"BoundDataColumn");var h=actuate.util.XmlDom.createElement(J,"Name");var Z=b.id;if(b.disabled==false||this._hasDependents(Z)){var O=J.createTextNode(Z);h.appendChild(O);a.appendChild(h);if(b.attributes.dateFunctionValue!=""){var A=actuate.util.XmlDom.createElement(J,"Pattern");var G=J.createTextNode(b.attributes.dateFunctionValue);A.appendChild(G);a.appendChild(A);}e.appendChild(a);D.appendChild(e);}else{var O=J.createTextNode(Z);h.appendChild(O);a.appendChild(h);var A=actuate.util.XmlDom.createElement(J,"Pattern");var G=J.createTextNode("disabled");A.appendChild(G);a.appendChild(A);e.appendChild(a);D.appendChild(e);}if(b.hasChildNodes){var l=b.childNodes;for(var f=0;f<l.length;f++){var X=l[f];if(X.disabled==false||this._hasDependents(X.id)){e=actuate.util.XmlDom.createElement(J,"ColumnDef");a=actuate.util.XmlDom.createElement(J,"BoundDataColumn");h=actuate.util.XmlDom.createElement(J,"Name");Z=X.id;var O=J.createTextNode(Z);h.appendChild(O);a.appendChild(h);if(X.attributes.dateFunctionValue!=""){var A=actuate.util.XmlDom.createElement(J,"Pattern");var G=J.createTextNode(X.attributes.dateFunctionValue);A.appendChild(G);a.appendChild(A);}e.appendChild(a);D.appendChild(e);}}}}}var B=this._selectedMeasureStore.data.items;for(var g=0;g<B.length;g++){var N=B[g].data;var e=actuate.util.XmlDom.createElement(J,"ColumnDef");var a=actuate.util.XmlDom.createElement(J,"BoundDataColumn");var h=actuate.util.XmlDom.createElement(J,"Name");var Z=N.value;var O=J.createTextNode(Z);h.appendChild(O);a.appendChild(h);if(N.aggregationValue==null||N.aggregationValue==""){var U=actuate.util.XmlDom.createElement(J,actuate.Constant.tag.BoundDataColumnExpression);a.appendChild(U);var C=J.createTextNode(this._getComputedColumnExpression(Z));U.appendChild(C);}e.appendChild(a);var M=actuate.util.XmlDom.createElement(J,"Aggregate");var S=actuate.util.XmlDom.createElement(J,"Func");var R=J.createTextNode(N.aggregationValue);S.appendChild(R);M.appendChild(S);var W=actuate.util.XmlDom.createElement(J,"Label");var E=N.aggregation!=null?N.aggregation:"";var Q=J.createTextNode(E);W.appendChild(Q);M.appendChild(W);e.appendChild(M);D.appendChild(e);}J.documentElement.appendChild(D);var P=this.createDataSetSoap();J.documentElement.appendChild(P);this.__addFilterSoap(J.documentElement);if(this._dataManagerSoap!=null){var L=this._dataManagerSoap.childNodes[0].data;var V=L.substr(0,L.length-1)+",";var k=J.createTextNode(V);T.appendChild(k);}var H=actuate.util.Json;var c="AutoSummarize:";if(T.childNodes.length==0){c="{AutoSummarize:";}var I={};I.value="true";c+=H.makeMap(I)+",";if(this._hyperlinkCheckbox.disabled==false){c=c+"UseHyperlink:";I={};I.value=this._hyperlinkCheckbox.getValue().toString();c+=H.makeMap(I)+",";}I={};I.value=this._pixelPerInch;c=c+"PixelPerInch:";c+=H.makeMap(I)+",";var F=J.createTextNode(c);T.appendChild(F);}},_createTableSoapNode:function(H,F){if(F){var B=actuate.util.XmlDom.createElement(F,"BoundDataColumnList");var X=this._selectedTree.getRootNode();if(X.hasChildNodes()){var M=0;var Y=X.childNodes;for(var T=0;T<Y.length;T++){var W=Y[T];if(W.disabled&&!this._hasDependents(W.id)){continue;}var C=actuate.util.XmlDom.createElement(F,"BoundDataColumn");var U=actuate.util.XmlDom.createElement(F,"Name");var O=W.id;var a=F.createTextNode(O);U.appendChild(a);C.appendChild(U);B.appendChild(C);if(W.hasChildNodes){var J=W.childNodes;for(var S=0;S<J.length;S++){var I=J[S];if(I.disabled==false||this._hasDependents(I.id)){C=actuate.util.XmlDom.createElement(F,"BoundDataColumn");U=actuate.util.XmlDom.createElement(F,"Name");O=I.id;a=F.createTextNode(O);U.appendChild(a);C.appendChild(U);B.appendChild(C);}}}}}F.documentElement.appendChild(B);var P=this.__getSelectedDataSourceInfo();var Z=P[1].name;var A=P[0];var K=P[2];var R=this.createDataSetSoap();F.documentElement.appendChild(R);this.__addFilterSoap(F.documentElement);if(this._dataManagerSoap!=null){var Q=this._dataManagerSoap.childNodes[0].data;var E=Q.substr(0,Q.length-1)+",";var N=F.createTextNode(E);H.appendChild(N);}var D=actuate.util.Json;var V="AutoSummarize:";if(H.childNodes.length==0){V="{AutoSummarize:";}var L={};L.value="false";V+=D.makeMap(L)+",";if(this._hyperlinkCheckbox.disabled==false){V=V+"UseHyperlink:";L={};L.value=this._hyperlinkCheckbox.getValue().toString();V+=D.makeMap(L)+",";}L={};L.value=this._pixelPerInch;V=V+"PixelPerInch:";V+=D.makeMap(L)+",";var G=F.createTextNode(V);H.appendChild(G);}},isSummarize:function(){return this._autoSumCheckbox.getValue()?true:false;},_isEmptyTree:function(A){if(A.getRootNode()==null||A.getRootNode().hasChildNodes()==false){return true;}return false;},validate:function(){var A=this._isDataSetSelected();if(!A){actuate.widget.MessageBox.show({title:actuate.util.Utility.getLocalizedString("tableBuilder.alertTitle"),msg:actuate.util.Utility.getLocalizedString("common.dataTab.noDataSourceError"),buttons:actuate.widget.MessageBox.OK});return false;}if(this.isSummarize()&&this._measureList.getStore().getCount()<=0&&this._isEmptyTree(this._selectedTree)){actuate.widget.MessageBox.show({title:actuate.util.Utility.getLocalizedString("tableBuilder.alertTitle"),msg:actuate.util.Utility.getLocalizedString("tableBuilder.summaryErrorMessage"),buttons:actuate.widget.MessageBox.OK});return false;}else{if(!this.isSummarize()&&this._isEmptyTree(this._selectedTree)){actuate.widget.MessageBox.show({title:actuate.util.Utility.getLocalizedString("tableBuilder.alertTitle"),msg:actuate.util.Utility.getLocalizedString("tableBuilder.tableErrorMessage"),buttons:actuate.widget.MessageBox.OK});return false;}}return true;},__addDataIntoTreeStore:function(B,A){if(A&&B&&B.dataType!="blob"){B.title=this._getTooltip(B);A.add(B);}},_getType:function(C){if(!C){return ;}var B=C.type;if(C.levels&&C.shared){B="sharedDimension";}else{if(C.analysis=="attribute"&&C.analysisColumn==""){B="attribute";}else{if(C.analysis=="measure"){B="measure";}else{if(C.analysis=="dimension"){B="dimension";}else{var A=this._getDataType(C.name);if(A=="float"||A=="integer"||A=="decimal"||A=="double"){B="measure";}else{if(A){B="dimension";}}}}}}return B;},_eh_onBeforeSelect:function(A,B){if(B&&B.attributes&&B.attributes.type){switch(B.attributes.type){case"sharedDimension":case"category":return false;default:return true;}}return true;},_eh_onMeasureBeforeSelect:function(E,B,A,D){if(D){var C=D.getTarget();if(C){return(actuate.util.Element.hasClass(C,"actuate-summarytable-columnnameDiv_disabled")||actuate.util.Element.hasClass(C,"actuate-summarytable-aggregation-disabled")||actuate.util.Element.hasClass(C,"actuate-summarytable-img-disabled"))?false:true;}}},_onTreeNodeSelect:function(B,C){if(B&&this._eh_onBeforeSelect(this,B)){if(B.ownerTree){var A=B.ownerTree.getSelectionModel();if(A){A.select(B,C,C.ctrlKey);}}}},__supportAttributes:function(A){return false;}});