actuate.util.Package.define("actuate.dialog.impl.helper.datamanager");(function(){var A=actuate.Class.extendClass(actuate.dialog.impl.helper.AbstractIVDialog,{_dialogName:"manageDataDialog",_width:630,_height:600,_basePanel:null,_directoryList:null,_selectedList:null,_directoriesStore:null,_availableDataListStore:null,_selectedDataListStore:null,_expandedIndex:null,_syncMetaDataIcon:null,_currentDirectory:null,_cubeDialog:null,_repositoryType:null,_enableSyncMetaData:false,_counter:0,_deletedList:null,_restricted:false,_componentData:null,_interaction:false,_rootName:"/",_moveright:null,_moveleft:null,_currentSelection:null,initialize:function(B,C){this._deletedList={};this._STATIC=actuate.dialog.impl.helper.datamanager.ManageDataDialog;this._interaction=true;this._restricted=false;this._currentSelection=null;this._repositoryType=actuate.getDefaultRequestOptions().getRepositoryType();this._showParameterDialog_c=actuate.Method.bind(this._showParameterDialog,this);this._popupVersionsHandler_c=actuate.Method.bind(this._popupVersionsHandler,this);this._title=this.getLocalizedString("title");this._description=this.getLocalizedString("description");actuate.dialog.impl.helper.datamanager.ManageDataDialog.superclass.initialize.call(this,B,this._width,false);this._directoriesStore=new actuate.widget.data.SimpleStore({fields:["value","hasChildren","type"]});this._availableDataListStore=new actuate.widget.data.SimpleStore({fields:["value","icon","details","accessType","enableACL","versions","tooltipPath"],sortInfo:{field:"value",direction:"ASC"}});this._selectedDataListStore=new actuate.widget.data.SimpleStore({fields:["dataSourceName","value","accessType","icon","directory","details","parameter","modified"],sortInfo:{field:"value",direction:"ASC"}});var D=new actuate.widget.Template('<button class="actuate-icon-syncMetaData" qtip="'+A._TOOLTIP_SYNCMETADATA+'" type="{1}">{0}</button>');var F=new actuate.widget.Template('<button class="actuate-icon-leftMetaData" qtip="'+A._TOOLTIP_LEFTMETADATA+'" type="{1}">{0}</button>');var E=new actuate.widget.Template('<button class="actuate-icon-rightMetaData" qtip="'+A._TOOLTIP_RIGHTMETADATA+'" type="{1}">{0}</button>');this._basePanel=new actuate.widget.panel.Panel({layout:"column",cls:"actuate-managedata-main-panel",width:800,items:[{xtype:"panel",columnWidth:0.5,items:[{xtype:"panel",header:false,layout:"column",id:"actuateDataManagerDialogAvaliableDataMetaDataPanel",style:"padding: 25px 3px 4px 32px;",items:[{xtype:"label",text:this.getLocalizedString("availableData"),cls:"actuate-managedata-data-list"}]},{xtype:"panel",layout:"column",columnWidth:0.5,style:"padding: 0px 3px 4px 32px;",items:[{xtype:"panel",layout:"fit",header:false,cls:"actuate-managedata-category-panel",width:145,height:270,items:[{id:"actuateDataManagerDialogDirectoryList",xtype:"treepanel",rootVisible:true,autoScroll:true,height:360,autoWidth:true,border:false,useArrows:false,loader:new actuate.widget.tree.TreeLoader({leaf:false}),listeners:{click:actuate.Method.bind(this._directoriesListSelect,this),expandnode:actuate.Method.bind(this._expandNode,this),collapsenode:actuate.Method.bind(this._collapseNode,this)}}]},{xtype:"panel",cls:"actuate-managedata-data-list-panel",layout:"fit",columnWidth:0.9,height:270,anchor:"100% 36%",items:[{id:"actuateDataManagerDialogAvailableList",xtype:"listbox",cls:"actuate-managedata-data-list",store:this._availableDataListStore,tpl:this._STATIC._TEMPLATE_AVAILABLE_DATA_LIST,listeners:{beforeclick:actuate.Method.bind(this._availableDataBeforeClick,this),click:actuate.Method.bind(this._availableDataListClick,this),dblclick:actuate.Method.bind(this._availableDataListClick,this)}}]}]}]},{xtype:"panel",layout:"column",columnWidth:0.5,items:[{xtype:"panel",width:67,height:360,cls:"actuate-managedata-mid-panel",items:[{id:"actuate-managedatadialog-right",icon:"iportal/jsapi/actuate/dialog/images/greenbutton-arrow-right.png",overIcon:"iportal/jsapi/actuate/dialog/images/greenbutton-arrow-right-hover.png",cls:"actuate-managedatadialog-right",xtype:"button",handler:actuate.Method.bind(this._handlerRightFunc,this)},{id:"actuate-managedatadialog-left",icon:"iportal/jsapi/actuate/dialog/images/greenbutton-arrow-left.png",overIcon:"iportal/jsapi/actuate/dialog/images/greenbutton-arrow-left-hover.png",cls:"actuate-managedatadialog-left",xtype:"button",handler:actuate.Method.bind(this._handlerLeftFunc,this)}]},{xtype:"panel",columnWidth:0.9,height:360,items:[{xtype:"panel",header:false,layout:"column",id:"actuateDataManagerDialogSyncMetaDataPanel",style:"padding: 25px 3px 4px 5px;",items:[{xtype:"label",columnWidth:0.9,text:this.getLocalizedString("selectedData"),cls:"actuate-managedata-data-list"},{xtype:"panel",columnWidth:0.1,items:[{xtype:"button",height:16,width:16,id:"actuateDataManagerDialogSyncMetaData",_template:D,cls:"actuate-icon-syncMetaData",listeners:{click:actuate.Method.bind(this._syscMetaDataClick,this)}}]}]},{xtype:"panel",cls:"actuate-managedata-data-list-panel",anchor:"100% 56%",height:270,layout:"fit",items:[{id:"actuateDataManagerDialogSelectedList",xtype:"listbox",cls:"actuate-managedata-data-list",store:this._selectedDataListStore,tpl:this._STATIC._TEMPLATE_SELECTED_DATA_LIST,listeners:{beforeclick:actuate.Method.bind(this._availableDataBeforeClick,this),click:actuate.Method.bind(this._selectedDataListClick,this)}}]}]}]}]});this._window.getBodyDom().style.padding=0;this._window.add(this._basePanel);this._window._doLayout();this._directoryList=actuate.widget.ComponentMgr.get("actuateDataManagerDialogDirectoryList");this._availableList=actuate.widget.ComponentMgr.get("actuateDataManagerDialogAvailableList");this._selectedList=actuate.widget.ComponentMgr.get("actuateDataManagerDialogSelectedList");this._syncMetaDataIcon=actuate.widget.ComponentMgr.get("actuateDataManagerDialogSyncMetaData");this._moveright=actuate.widget.ComponentMgr.get("actuate-managedatadialog-right");this._moveleft=actuate.widget.ComponentMgr.get("actuate-managedatadialog-left");this._counter=0;this._messageAlertWithRelationships=this.getLocalizedString("prompt.alertWithRelationships");},_availableDataBeforeClick:function(F,C,B,E){if(E){var D=E.getTarget();if(D){return(actuate.util.Element.hasClass(D,"actuate-data-entry")||actuate.util.Element.hasClass(D,"actuate-datamart-item")||actuate.util.Element.hasClass(D,"actuate-icon-parameter-list-hidden")||actuate.util.Element.hasClass(D,"actuate-access-type")||actuate.util.Element.hasClass(D,"actuate-icon-expand")||actuate.util.Element.hasClass(D,"actuate-icon-expanded")||actuate.util.Element.hasClass(D,"actuate-icon-data")||actuate.util.Element.hasClass(D,"actuate-icon-parameter-list")||actuate.util.Element.hasClass(D,"actuate-access-type-arrow")||actuate.util.Element.hasClass(D,"actuate-icon-datadesign"))?true:false;}}},_expandNode:function(B){if(B.childNodes.length==0&&this._directoryList.getRootNode().childNodes.length>0){this._directoriesListSelect(B);}},_collapseNode:function(B){},_directoriesListSelect:function(C){if(C){if(C==this._selectedNode){C.select();}else{this._currentNode=C;var D=C;var B=[];while(D.parentNode){B.push(D.text);D=D.parentNode;}this._currentDirectory=B.reverse().join("/");this._queryFileFolderList(this._currentDirectory);this._selectedNode=C;this._defaultNode=C;}}},_updateDirectoryContents:function(){if(!this._currentDirectory){return ;}var D=this._files;if(D){var K=this._selectedDataListStore.data.items;var E=this._getAbsolutePath(this._currentDirectory);var C=[];for(var J=0;J<D.length;J++){var F=D[J];var I=F.name+"."+F.extension;var N=false;for(var H=0;H<K.length;H++){var L=K[H].data;var M=this._getAbsolutePath(L["directory"]);if(M==E&&L["value"]==I){N=true;break;}}if(!N){var G=(F.extension=="datadesign");var B=G?actuate.dialog.impl.constant.DataMartAccessType.TRANSIENT:actuate.dialog.impl.constant.DataMartAccessType.LATEST;F.accessType=B;F.version=-1;B=this._formatAccessType(B,-1);C.push([I,"file-"+F.extension,F,B,F.enableACL,F.versions,this._currentDirectory]);}}this._availableDataListStore.loadData(C);}else{this._availableDataListStore.removeAll();}},_getAbsolutePath:function(C){var B=C;if(B){var D=this._rootName;if(D){if(D.charAt(D.length-1)!="/"){D+="/";}if(D.charAt(0)!="/"){D="/"+D;}}if(B.charAt(B.length-1)!="/"){B+="/";}if(B.charAt(0)!="/"){B="/"+B;}if(B.indexOf(D)!=0){B=D+B.substring(1);}}return B;},_availableDataListClick:function(J,I,G,B){if(J.disabled||!B||!B.target||!G||!G.data||!G.data.details||G.data.pendingQuery){return ;}var E=B.getTarget();var K=actuate.util.Element.hasClass(E,"actuate-icon-expand")||actuate.util.Element.hasClass(E,"actuate-icon-expanded");var F=actuate.util.Element.hasClass(E,"actuate-access-type-arrow")||actuate.util.Element.hasClass(E,"actuate-access-type");var C=actuate.util.Element.hasClass(E,"actuate-icon-add")||B.type=="dblclick";if(K||F||C){var D;if(K){D="expand";}else{if(F){D="version";}else{if(C){D="add";}}}if(G.data.details.loaded){this._onClickedDataMart({action:D,target:E},G);}else{var H=this;this._queryDatamartDetails(G,function(){H._onClickedDataMart({action:D,target:E},G);});}}},_onClickedDataMart:function(C,B){if(!C||!C.target||!B||!B.data||!B.data.details||!B.data.details.loaded||B.data.pendingQuery){return ;}if(B.data.details.enableACL&&B.data.details.accessType==actuate.dialog.impl.constant.DataMartAccessType.TRANSIENT){actuate.widget.MessageBox.show({title:this.getLocalizedString("message.error"),msg:this.getLocalizedString("message.noAccess"),buttons:actuate.widget.MessageBox.OK,icon:actuate.widget.MessageBox.ERROR});}else{var D=actuate.uiadapter.Element.fly(C.target);switch(C.action){case"expand":this._expandDataDetails(D.parent(),D,B);break;case"version":this._popupVersions(B,D.parent());break;case"add":this._addDataMart(B);break;default:break;}}},_syscMetaDataClick:function(){var B=this;actuate.widget.MessageBox.confirm(this.getLocalizedString("prompt.alert"),this.getLocalizedString("prompt.confirmToUpdateData"),actuate.Method.createDelegate(function(C,D){if(C=="no"){return ;}B._updateBtnClick();},this));},_selectedDataListClick:function(F,C,B,E){if(F.disabled){return ;}this._currentRecord=B;var D=E.getTarget();var G=actuate.uiadapter.Element.fly(D);if(actuate.util.Element.hasClass(D,"actuate-icon-remove")){if(B.data.details&&B.data.details.isReferenced){actuate.widget.MessageBox.alert(this.getLocalizedString("prompt.alert"),this._messageAlertWithRelationships);}else{this._removeDataMart(B);}}else{if(actuate.util.Element.hasClass(D,"actuate-icon-expand")||actuate.util.Element.hasClass(D,"actuate-icon-expanded")){this._expandDataDetails(G.parent(),G,B);}else{if(actuate.util.Element.hasClass(D,"actuate-access-type-arrow")){this._popupVersions(B,G.parent());}else{if(actuate.util.Element.hasClass(D,"actuate-icon-parameter-list")){this._editParameters();}}}}},_editParameters:function(){actuate.resource.module.require(["actuate.parameter"],this._showParameterDialog_c,function(){});},_createParameterDialog:function(){return new actuate.dashboard.NewReportletGadgetDialog(this._componentData,this._consumer.tabInfo);},_showParameterDialog:function(){var C=this._currentRecord;var D=this._createParameterDialog();var F=C.data["value"];var B=this._rootName;if(B&&B.indexOf("/")!=0){B="/"+B;}if(B&&B.length>1&&B.charAt(B.length-1)=="/"){B=B.substring(0,B.length-1);}if(C.data.directory){var E=C.data.directory;if(E.length>0){if(E.charAt(E.length-1)!="/"){E=E+"/";}F=E+F;}}if(F.indexOf("/")!=0){F="/"+F;}if(B&&F.indexOf(B)!=0){F=B+F;}D.setGadgetSourceFile(F);if(C.data.modified){D.setGadgetReportParameters(this._getParameterValues(C.data));}D.setGadgetSettings(this._getParameterSettings(C.data.details));D.submit(function(J,K,G,L,N,H){if(C&&C.data&&C.data.details){C.data.modified=true;C.data.details.parameterValues=K;C.data.details.parameterSettings=G;if(G&&G.length>0){var M=new Array();for(var I=0;I<G.length;I++){if(G[I].metaData&&G[I].metaData!=""){M.push(G[I].metaData);}}C.data.details.selectors=M;}else{C.data.details.selectors="";}}});},_getParameterSettings:function(G){var E=new Array();if(G){if(G.parameterSettings){E=G.parameterSettings;}else{if(G.parameters){var F=G.parameters;for(var C=0;C<F.length;C++){var H=F[C];if(H){if(H.name&&H.selectors){var B=H.selectors[0];if(B&&B.name){var D={Name:H.name,realName:B.name,displayName:B.displayName};E.push(D);}}}}}}}return E;},_addDataMart:function(B){this._availableDataListStore.remove(B);var E=this._currentDirectory;if(E!="/"){E+="/";}var F=E+B.data["value"];var C=this._deletedList[F];if(C){delete this._deletedList[F];}else{var D=B.data["details"];C=new this._selectedDataListStore.recordType({dataSourceName:null,value:B.data["value"],icon:B.data["icon"],accessType:B.data["accessType"],details:D,directory:this._currentDirectory,parameter:this._canShowParameterButton(D),modified:false});}this._selectedDataListStore.addSorted(C);B=C;D=B.data["details"];if(!D.loaded&&!B.data.pendingQuery){this._queryDatamartDetails(B);}this._updateRefreshButton();},_updateRefreshButton:function(){var C=this._selectedDataListStore.data.items;this._enableSyncMetaData=false;if(C.length>0){this._enableSyncMetaData=true;}var B=this._componentData&&this._componentData.fromBuilder;if(this._enableSyncMetaData==false||(B&&!this._componentData.BRS)){this._syncMetaDataIcon.setDisabled(true);}else{this._syncMetaDataIcon.setDisabled(false);}},_removeDataMart:function(B){if(B.data["dataSourceName"]){var D=B.data["directory"];if(D!="/"){D+="/";}this._deletedList[D+B.data["value"]]=B;}this._selectedDataListStore.remove(B);this._updateRefreshButton();var F=this._getAbsolutePath(B.data["directory"]);var E=this._getAbsolutePath(this._currentDirectory);if(F==E){var C=new this._availableDataListStore.recordType({value:B.data["value"],icon:B.data["icon"],details:B.data["details"],accessType:B.data["accessType"],enableACL:B.data["enableACL"],tooltipPath:B.data["directory"]});this._availableDataListStore.addSorted(C);}},_detailClickHandler:function(H,C,F,E){var D=E.getTarget();if(C>=0&&actuate.util.Element.hasClass(D,"actuate-data-name")&&this._detailsStore){var B=this._detailsStore.getAt(C);if(B&&B.data.details.type!="parameters"){var G={};G.details=B.data.details;G.currentSelection=this._currentSelection;this._consumer._eventDispatcher.fireEvent(actuate.builder.impl.event.__E_SHOW_DATA_MANAGER_DETAILS,G);}}return false;},_queryFileFolderList:function(B){this._setInteraction(false);this._consumer._eventDispatcher.broadcastEvent(actuate.builder.impl.event.__E_GET_MANAGE_DATA,{path:B,folderQuery:true});},_formatAccessType:function(D,B,C){var E=actuate.dialog.impl.constant.DataMartAccessType;if(D==E.SPECIFIC){var F=this.getLocalizedStringParams("accessType.version",B);if(C){return F+" ("+C+")";}else{return F;}}else{if(D==E.TRANSIENT){return this.getLocalizedString("accessType.transient");}}return this.getLocalizedString("accessType.latest");},_expandDataDetails:function(G,E,C){var B=C.panel;if(B&&!B.hidden){G.removeClass("actuate-list-item-expanded");E.removeClass("actuate-icon-expanded");E.addClass("actuate-icon-expand");if(B){B.hide();}}else{if(C.data.details&&!C.data.details.noFile){E.removeClass("actuate-icon-expand");E.addClass("actuate-icon-expanded");G.addClass("actuate-list-item-expanded");if(!B){var D=C.data.details;if(!D.loaded){if(!C.data.pendingQuery){var F=this;this._queryDatamartDetails(C,function(){var H=F._createDetailsPanel(C);H.render(G);C.panel=H;});}}else{var B=this._createDetailsPanel(C);B.render(G);C.panel=B;}}else{B.show();}}else{actuate.widget.MessageBox.alert(this.getLocalizedString("message.error"),this.getLocalizedStringParams("message.noDataMartFile",C.data.value));}}},_getDetailTypeDescription:function(C){var B;switch(C.type){case"cubes":if(C.subType=="linkedcube"){B=this.getLocalizedString("details.type.linkedCube");}else{B=this.getLocalizedString("details.type.cube");}break;case"dataSets":if(C.subType=="linkeddataset"){B=this.getLocalizedString("details.type.linkedDataSet");}else{B=this.getLocalizedString("details.type.dataset");}break;case"parameters":B=this.getLocalizedString("details.type.parameter");break;default:B="";break;}return B;},_getDetailTypeIcon:function(C){var B;switch(C.type){case"cubes":B="cube";break;case"dataSets":B=C.subType||"dataset";break;case"parameters":B="parameter";break;default:B="";break;}return B;},_createDetailsPanel:function(F){var D=["cubes","dataSets","parameters"];var C=[];var K=0;for(var G=0;G<D.length;G++){var H=F.data.details[D[G]];if(H){for(var E=0;E<H.length;E++){K++;var J=H[E];J.type=D[G];C.push([J.id,J.name,this._getDetailTypeDescription(J),this._getDetailTypeIcon(J),J,F]);}}}this._detailsStore=new actuate.widget.data.SimpleStore({fields:["id","name","type","icon","details","parentRecord","modified"],data:C});var I=F.data.details.description;if(I&&I!=""){I=this.getLocalizedString("details.description")+"<br/>"+actuate.util.Utility.htmlEncode(I);}else{I=null;}var B=new actuate.widget.panel.Panel({layout:"anchor",height:K*21+12,border:false,autoScroll:true,cls:"actuate-managedata-data-details",items:[{xtype:"label",tag:"div",cls:"actuate-managedata-details-description",html:I,anchor:"100%",region:"north"},{xtype:"listbox",cls:"actuate-managedata-details-list",anchor:"95%",region:"center",tpl:this._STATIC._TEMPLATE_DETAILS_LIST,store:this._detailsStore,listeners:{beforeclick:actuate.Method.bind(this._detailClickHandler,this)}}]});return B;},_popupVersions:function(D,C){var S=actuate.dialog.impl.constant.DataMartAccessType;var M=D.data.value;var J=D.data.details.version;var K=D.data.details.accessType;if(!K||K==""){J=S.LATEST;}if(!J){J=0;}if(!this._versionsMenu){this._versionsMenu=new actuate.widget.menu.Menu({id:"versionsPopupMenu"});}this._versionsMenu.removeAll();this._versionsMenu.currentRecord=D;var F="version";if(D.data.details.extension=="data"){this._versionsMenu.addMenuItem({id:"versionsPopup_LatestItem",text:this.getLocalizedString("accessType.latest"),checked:K==S.LATEST,group:F,title:this.getLocalizedString("accessType.latest"),handler:this._popupVersionsHandler_c});}if(D.data.details.extension=="datadesign"){this._versionsMenu.addMenuItem({id:"versionsPopup_TransientItem",text:this.getLocalizedString("accessType.transient"),checked:K==S.TRANSIENT,group:F,handler:this._popupVersionsHandler_c});}var L=this._getDataMart(this._files,M);var G=null;var I=null;if(L){G=L.versions;I=D.data.details.versionNames?D.data.details.versionNames:L.versionNames;}var R=[];if(I){for(var Q=0;Q<I.length;Q++){var B=I[Q];if(B.length>0){R.push([G[Q],B]);}}}if(G&&G.length>0){this._versionsMenu.addSeparator();var E=J;if(K!=S.SPECIFIC){E=-1;}for(var Q=0;Q<G.length;Q++){var H=G[Q];var P=false;if(H&&D.data.details.extension=="data"){var N=this.getLocalizedStringParams("accessType.version",H);for(var O=0;O<R.length;O++){selectedVersionParam=R[O];if(selectedVersionParam[0]==H&&selectedVersionParam[1]){this._versionsMenu.addMenuItem({id:"versionsPopup_"+H,name:selectedVersionParam[1],text:N+" ("+selectedVersionParam[1]+")",checked:(E==H),group:F,title:N+" ("+selectedVersionParam[1]+")",handler:this._popupVersionsHandler_c});P=true;break;}}if(!P){this._versionsMenu.addMenuItem({id:"versionsPopup_"+H,text:N,checked:(E==H),group:F,title:N,handler:this._popupVersionsHandler_c});}}}R.length=0;}this._versionsMenu.show(C,"bl");},_popupVersionsHandler:function(H,G){var I=actuate.dialog.impl.constant.DataMartAccessType;var C=this._versionsMenu.currentRecord;var B=C.data.details.accessType;var D=false;if(H.id=="versionsPopup_LatestItem"){if(B!=I.LATEST){D=true;C.data.details.version=null;C.data.details.accessType=I.LATEST;}}else{if(H.id=="versionsPopup_TransientItem"){if(B!=I.TRANSIENT){D=true;C.data.details.version=null;C.data.details.accessType=I.TRANSIENT;}}else{var F=H.id.indexOf("_");if(F>=0){var E=parseInt(H.id.substr(F+1));if(B!=I.SPECIFIC||C.data.details.version!=E){D=true;C.data.details.version=E;C.data.details.versionName=H.name;C.data.details.accessType=I.SPECIFIC;}}}}if(D){C.data.details.loaded=false;C.data.parameter=this._canShowParameterButton(C.data.details);C.data.accessType=this._formatAccessType(C.data.details.accessType,C.data.details.version,C.data.details.versionName);C.modified=true;C.data.modified=true;C.commit();if(!C.data.pendingQuery){this._queryDatamartDetails(C);}}},_getDataMart:function(D,E){if(D){for(var C=0;C<D.length;C++){var B=D[C];if(B.name+"."+B.extension==E){return B;}}}return null;},_queryDatamartDetails:function(C,H,B){var E=this._currentDirectory;if(E.charAt(E.length-1)!="/"){E+="/";}var G=E+C.data.value;this._counter--;this._setInteraction(false);var F=this;var D={data:{dialogName:"actuate.dialog.datamanager.ManageDataDialog",dataMartName:G,accessType:C.data.details.accessType,version:C.data.details.version},callback:function(){if(C.data.details.cubes){C.data.details.loaded=true;}delete C.data.pendingQuery;F._counter++;if(F._counter==0){F._setInteraction(true);}if(H){H.apply(this,arguments);}},errorcallback:function(){delete C.data.pendingQuery;F._counter++;if(F._counter==0){F._setInteraction(true);}if(B){B.apply(this,arguments);}}};C.data.pendingQuery=true;this._consumer._eventDispatcher.sendEvent(actuate.builder.impl.event.__E_QUERY_DATAMART_FILE_METADATA,D,true);},_setInteraction:function(C){if(!(this._currentNode&&this._currentNode.getOwnerTree)){return ;}var B=this._currentNode.getOwnerTree().getRootNode();this._setChildNodesDisabled(B,!C);if(!this._currentNode.isSelected()){this._currentNode.select();}this._availableList.setDisabled(!C);this._selectedList.setDisabled(!C);this._moveright.setDisabled(!C);this._moveleft.setDisabled(!C);if(C){this._okBtn.enable();}else{this._okBtn.disable();}this._interaction=C;},_setChildNodesDisabled:function(B,E){B.setDisabled(E);var F=B.childNodes;var C;for(var D=0;D<F.length;D++){C=F[D];F[D].setDisabled(E);if(C.hasChildNodes()){this._setChildNodesDisabled(F[D],E);}}},_localBind:function(G){var D=false;if(G.operationData){if(G.operationData.folderQuery){D=true;this._setInteraction(true);}else{this._componentData=G.operationData.componentData;if(!this._componentData){this._componentData={fromBuilder:true,fromManageDataDialog:true,name:"Report"};}if(G.operationData&&G.operationData.BRS){this._componentData.BRS=G.operationData.BRS;}if(!this._callbacks){this._callbacks={};}this._callbacks.okCallback=G.operationData.okCallback;this.setRestricted(G.operationData.restricted?true:false);D=G.operationData.keepSelection;}if(G.operationData.DataMarts){G.DataMarts=G.operationData.DataMarts;}}if(G.dataMartList||G.dataMartDetails){this._bind(G);}if(G.DataMarts){if(!D){var C=[];var J=G.DataMarts;for(var H=0;H<J.length;H++){var B=J[H];if(B.fileName==undefined&&B.data.details!=undefined){B=B.data.details;}var F;var E;var I=B.fileName.lastIndexOf("/");if(I>=0){E=B.fileName.substr(0,(I==0)?1:I);F=B.fileName.substr(I+1)+"."+B.extension;}else{E=(this._repositoryType.toUpperCase()!="ENTERPRISE")?"/":B.resourcesPath;F=B.fileName+"."+B.extension;}if(E.length>1&&E.indexOf("/")!=0){E="/"+E;}B.loaded=true;if(B.accessType==actuate.dialog.impl.constant.DataMartAccessType.LATEST){this._enableSyncMetaData=true;}C.push([B.dataSourceName,F,this._formatAccessType(B.accessType,B.version,this._getVersionName(B)),"file-"+B.extension,E,B,this._canShowParameterButton(B),true]);}this._selectedDataListStore.loadData(C);this.setRestricted();this._updateRefreshButton();}this._updateDirectoryContents();}},_getVersionName:function(G){if(this._files&&G){var H=G.fileName+"."+G.extension;for(var F=0;F<this._files.length;F++){var E=this._files[F];if(E&&H==E.name+"."+E.extension){var B;var D;if(!actuate.util.Utility.isArray(E.versions)&&E.versions){B=[E.versions];}else{B=E.versions;}if(!actuate.util.Utility.isArray(E.versionNames)&&E.versionNames){D=[E.versionNames];}else{D=E.versionNames;}if(B&&D){for(var C=0;C<B.length;C++){if(G.version==B[C]){return D[C];}}}}}}},_canShowParameterButton:function(B){return B.accessType==actuate.dialog.impl.constant.DataMartAccessType.TRANSIENT&&B.parameters&&B.parameters.length>0;},_updateRecordDetails:function(B,C){if(!B.details){B.details={};}actuate.Class.extend(B.details,C);return B;},_bind:function(J){if(J.dataMartList){this._currentDirectory=J.baseDir;this._rootName=J.rootName;if(!this._currentNode){this._currentNode=new actuate.widget.tree.TreeNode({singleClickExpand:true,expanded:true,expandable:true});}if(this._currentDirectory!="/"){var F="";var G=this._currentDirectory.lastIndexOf("/");if(G>=0){F=this._currentDirectory.substring(G+1);}else{if(this._currentDirectory){F=this._currentDirectory;}}this._currentNode.text=F;}else{this._currentNode.text=J.rootName.indexOf("/")!=0?J.rootName:J.rootName.substring(1);if(this._currentNode.text="/"){this._currentNode.text=this.getLocalizedString("projectRoot");}}if(!this._directoryList.getRootNode()){this._directoryList.setRootNode(this._currentNode);}var I=this._currentNode.childNodes.length;for(var K=I-1;K>=0;K--){this._currentNode.childNodes[K].remove();}for(var K=0;K<J.subDirList.length;K++){var N=J.subDirList[K];var E=new actuate.widget.tree.TreeNode({text:N.name,leaf:N.hasChildren?false:true,expandable:true});this._currentNode.appendChild(E);if(!this._defaultNode&&this._currentDirectory=="/"&&N.name=="Data Objects"){this._defaultNode=E;}}this._files=J.dataMartList;this._updateDirectoryContents();if(this._currentNode==this._directoryList.getRootNode()){this._currentNode.select();this._currentNode.expand();}this._directoriesListSelect(this._defaultNode);}if(J.dataMartDetails){var B=J.dataMartDetails;var H=J.dataMartName+"."+J.extension;var P="";var K=H.lastIndexOf("/");if(K>=0){P=H.substr(0,(K==0)?1:K);H=H.substr(K+1);}else{P="/";}var L=null;var D=null;var C=null;if(this._currentDirectory==P){C=this._availableDataListStore.data.items;for(var I=0;I<C.length;I++){if(C[I].data.value==H){L=C[I].data;break;}}if(L){this._updateRecordDetails(L,B);}}if(!L){var M=this._selectedDataListStore.data.items;for(var I=0;I<M.length;I++){var O=M[I].data;this._clearRecordPanel(M[I]);if(O["directory"]==P&&O["value"]==H){L=O;this._updateRecordDetails(L,B);L.parameter=this._canShowParameterButton(B);this._selectedDataListStore.fireEvent("datachanged",this);}}}}},_clearRecordPanel:function(B){if(B.panel){B.panel.removeAll();B.panel.destroy();B.panel.getEl().remove();B.panel=null;}},_canClose:function(){var E=this._selectedDataListStore.data.items;for(var D=0;D<E.length;D++){var B=E[D].data;if(!B["dataSourceName"]){if(B&&B.parameter&&B.details&&B.details.parameters){for(var C=0;C<B.details.parameters.length;C++){var F=B.details.parameters[C];if(F&&F.name&&F.isRequired&&F.defaultValue.length==0&&!this._getParameterValue(B.details.parameterValues,F.name)){actuate.widget.MessageBox.show({title:this.getLocalizedString("message.error"),msg:this.getLocalizedStringParams("message.parameterIsRequired",F.name,B.value),buttons:actuate.widget.MessageBox.OK,icon:actuate.widget.MessageBox.ERROR});return false;}}}}}return true;},_getParameterValue:function(B,C){if(B&&C){for(var D=0;D<B.length;D++){if(B[D]&&B[D].getName()==C){return B[D].getValue();}}}},_isParameterValueNull:function(B,D){if(B&&D){for(var E=0;E<B.length;E++){if(B[E]&&B[E].getName()==D){var C=B[E].getValueIsNull();if(!B[E].getOperator()&&B[E].getControlType()=="FilterSimple"){C=true;}return C;}}}},__fireEvent:function(B,C){actuate.dialog.impl.helper.datamanager.ManageDataDialog.superclass.__fireEvent.call(this,B,C);},_updateBtnClick:function(){if(!this._canClose()){return ;}var B={};B.data={};this.__fireEvent(actuate.dialog.EventConstants.ON_SYNC_DATAMART_METADATA,{dataxml:this.createSoapNode(B.data),dataObj:B.data});this._hide();},_okPress:function(){if(!this._canClose()){return ;}if(this._counter==0){if(this._callbacks&&this._callbacks.okCallback){this._callbacks.okCallback(this.createSoapNode(),{currentSelection:this._currentSelection,dataMarts:this._selectedDataListStore.data.items});}else{actuate.dialog.impl.helper.datamanager.ManageDataDialog.superclass._okPress.call(this);}this._hide();}},_neh_okay:function(){if(this._visible){this._okPress();}},_preHide:function(){if(actuate.dialog.impl.helper.datamanager.ManageDataDialog.superclass._preHide){actuate.dialog.impl.helper.datamanager.ManageDataDialog.superclass._preHide.call(this);}this._setInteraction(true);this._clear();},createUpdateDataSoapNode:function(B){var E=actuate.util.XmlDom.createXMLDom(actuate.util.Constants.soap.NAMESPACE_ACTUATE10,actuate.Constant.tag.Data);var G=actuate.util.Json;var D=this._consumer.tabInfo?'{dashboardDesign:"'+this._consumer.tabInfo.dashboardDesign+'"':"{";D+="}";var C=actuate.util.XmlDom.createElement(E,actuate.Constant.tag.Json);var F=E.createTextNode(D);C.appendChild(F);E.documentElement.appendChild(C);return E.documentElement;},createSoapNode:function(){var B=actuate.util.XmlDom.createXMLDom(actuate.util.Constants.soap.NAMESPACE_ACTUATE10,actuate.Constant.tag.Data);this._createBaseSoapNode(B);return B.documentElement;},_createBaseSoapNode:function(H){var M=actuate.util.Json;var O=this._consumer.tabInfo?'{dashboardDesign:"'+this._consumer.tabInfo.dashboardDesign+'",':"{";O+="dataMarts:";var G=this._selectedDataListStore.data.items;var J=[];for(var D=0;D<G.length;D++){var E=G[D].data;var I={};var N=E["directory"];if(N=="/"){N="";}else{if(N!=this._rootName&&N.indexOf("/")==0){N=N.substring(1);}N+="/";}I.fileName=N+E["value"].substr(0,E["value"].lastIndexOf("."));if(E["dataSourceName"]){if(!E["modified"]){continue;}I.action="update";I.dataSourceName=E["dataSourceName"];}else{I.action="add";}I.accessType=E.details.accessType;if(E.details.version){I.version=E.details.version;}var L=this._getParameterValues(E);if(L&&L.length>0){I.parameters=this._createParametersJSON(L);if(this._consumer.tabInfo){var K=E.details.selectors;if(K&&K.length>0){this._consumer.tabInfo.addParameterSelectorAttrJSON(K,H);}}}J.push(I);}for(var C in this._deletedList){var E=this._deletedList[C].data;var I={};I.action="delete";I.dataSourceName=E["dataSourceName"];J.push(I);}O+=M.makeArray(J)+"}";var F=actuate.util.XmlDom.createElement(H,actuate.Constant.tag.Json);var B=H.createTextNode(O);F.appendChild(B);H.documentElement.appendChild(F);return H;},_getParameterValues:function(B){var C=[];if(B&&B.details&&B.details.parameters){for(var F=0;F<B.details.parameters.length;F++){var I=B.details.parameters[F];var E=I.name;var H=this._getParameterValue(B.details.parameterValues,E);var D=this._isParameterValueNull(B.details.parameterValues,E);if(!D&&!H){H=I.defaultValue;if(!H){D=true;}}if(H||D){var G=new actuate.parameter.ParameterValue();G.setName(E);if(!D){G.setValue(H);}else{G.setValueIsNull(D);}C.push(G);}}}return C;},_createParametersJSON:function(B){var F="";for(var E=0;E<B.length;E++){if(B[E]){var D=B[E].getName();var G=B[E].getValue();var C=B[E].getValueIsNull();if(D){if(E>0){F+=",";}F+="{'Name':'"+this._xmlEscape(D)+"'";if(!C){F+=",'Value':";if(typeof G!=="string"&&G.length>1){F+=actuate.util.Json.makeArray(G);}else{F+="'"+this._xmlEscape(G)+"'";}}F+="}";}}}return"{'ReportParameterValues':["+F+"]}";},_xmlEscape:function(C){if(!C){return C;}if(typeof (C)!="string"){return C;}var B=C;B=B.replace(/\&/g,"&amp;");B=B.replace(/</g,"&lt;");B=B.replace(/>/g,"&gt;");B=B.replace(/\"/g,"&quot;");B=B.replace(/\'/g,"&apos;");return B;},_clear:function(){this._deletedList={};this._directoryList.selModel.clearSelections();this._currentNode=this._directoryList.getRootNode();if(this._currentNode){var B=this._currentNode.childNodes.length;for(var C=B-1;C>=0;C--){this._currentNode.childNodes[C].remove();}}this._availableDataListStore.removeAll();this._directoriesStore.removeAll();this._selectedNode=null;this._defaultNode=null;},setRestricted:function(B){if(B!=null&&B!=this._restricted){this._restricted=B;}this._selectedList.tpl=this._restricted?this._STATIC._TEMPLATE_SELECTED_DATA_LIST_RESTRICTED:this._STATIC._TEMPLATE_SELECTED_DATA_LIST;this._selectedList.view.tpl=new actuate.widget.XTemplate(this._selectedList.tpl);this._selectedList.view.refresh();},__getHelpTopic:function(){return"SelectData";},_handlerRightFunc:function(D,C){if(this._availableList&&this._availableList.getSelectedRecord&&C){var E=this._availableList.getSelectedIndex();if(E!=null&&E>=0){var B=this._availableDataListStore.getAt(E);if(B!=null&&this._enableACLFunc(B)){this._addDataMart(B);if(E>=this._availableDataListStore.getCount()){E=0;}this._availableList._select(E);}}}},_handlerLeftFunc:function(){if(this._selectedList&&this._selectedList.getSelectedRecord){var C=this._selectedList.getSelectedIndex();if(C!=null&&C>=0){var B=this._selectedDataListStore.getAt(C);if(B!=null){if(B.data&&B.data.details&&B.data.details.isReferenced!=false){actuate.widget.MessageBox.alert(this.getLocalizedString("prompt.alert"),this._messageAlertWithRelationships);}else{this._removeDataMart(B);if(C>=this._selectedDataListStore.getCount()){C=0;}this._selectedList._select(C);}}}}},_enableACLFunc:function(B){if(B&&B.data.details&&B.data.details.enableACL&&B.data.details.accessType==actuate.dialog.impl.constant.DataMartAccessType.TRANSIENT){actuate.widget.MessageBox.show({title:this.getLocalizedString("message.error"),msg:this.getLocalizedString("message.noAccess"),buttons:actuate.widget.MessageBox.OK,icon:actuate.widget.MessageBox.ERROR});}else{return true;}}});A._SHORT_FILENAME_EXPRESSION="{[(values.value&&actuate.util.Utility.htmlDecode(values.value).length > 25)?"+'(actuate.util.Utility.htmlDecode(values.value).substr(0,22)+"...")'+":actuate.util.Utility.htmlDecode(values.value)]}";A._TOOLTIP_ADD=actuate.util.Utility.getLocalizedString("manageDataDialog.toolTip.add");A._TOOLTIP_SYNCMETADATA=actuate.util.Utility.getLocalizedString("manageDataDialog.toolTip.syncMetaData");A._TOOLTIP_LEFTMETADATA=actuate.util.Utility.getLocalizedString("manageDataDialog.toolTip.leftMetaData");A._TOOLTIP_RIGHTMETADATA=actuate.util.Utility.getLocalizedString("manageDataDialog.toolTip.rightMetaData");A._TOOLTIP_REMOVE=actuate.util.Utility.getLocalizedString("manageDataDialog.toolTip.remove");A._TOOLTIP_PARAMETER_BINDING=actuate.util.Utility.getLocalizedString("manageDataDialog.toolTip.parameterBinding");A._TOOLTIP_SELECTEDLIST_DIRECTORY='{[values.directory.split("/").length > 4 ? '+'(".../" + values.directory.split("/").slice(values.directory.split("/").length-3).join("/") + "/") : ( values.directory.length > 1 ? (values.directory.substr(1) + "/"): values.directory.substr(1) ) ]}';A._TOOLTIP_AVAILABLELIST_DIRECTORY='{[values.tooltipPath.split("/").length > 4 ? '+'(".../" + values.tooltipPath.split("/").slice(values.tooltipPath.split("/").length-3).join("/") + "/" ) : ( values.tooltipPath.length > 1 ? (values.tooltipPath.substr(1) + "/"): values.tooltipPath.substr(1) ) ]}';actuate.Class.extend(A,{_TEMPLATE_AVAILABLE_DATA_LIST:'<tpl for="."><div class="actuate-datamart-item actuate-list-item">'+'<tpl if="enableACL">'+'<div class="actuate-icon-expand actuate-item-disabled"></div>'+'<div class="actuate-icon-{icon} actuate-item-disabled"></div>'+'<div class="actuate-data-entry actuate-item-disabled" title="'+A._TOOLTIP_AVAILABLELIST_DIRECTORY+'{value}">'+A._SHORT_FILENAME_EXPRESSION+"</div>"+"</tpl>"+'<tpl if="!enableACL">'+'<div class="actuate-icon-expand"></div>'+'<div class="actuate-icon-{icon}"></div>'+'<div class="actuate-data-entry" title="'+A._TOOLTIP_AVAILABLELIST_DIRECTORY+'{value}">'+A._SHORT_FILENAME_EXPRESSION+"</div>"+"</tpl></div></tpl>",_TEMPLATE_SELECTED_DATA_LIST:'<tpl for="."><div class="actuate-datamart-item actuate-list-item">'+'<div class="actuate-icon-expand"></div>'+'<div class="actuate-icon-{icon}"></div>'+'<div class="actuate-data-entry actuate-data-entry-break" title="'+A._TOOLTIP_SELECTEDLIST_DIRECTORY+'{value}">'+A._SHORT_FILENAME_EXPRESSION+"</div>"+'<div style="float:right">'+'<div class="actuate-access-type" style="white-space:nowrap">{accessType}</div>'+'<tpl if="icon != \'file-datadesign\'"><div class="actuate-access-type-arrow"></div></tpl>'+'<tpl if="icon == \'file-datadesign\'"><div class="actuate-access-type-arrow-disabled"></div></tpl>'+'<tpl if="parameter">'+'<a title="'+A._TOOLTIP_PARAMETER_BINDING+'"><div class="actuate-icon-parameter-list">&nbsp;</div></a>'+"</tpl>"+'<tpl if="!parameter">'+'<div class="actuate-icon-parameter-list-hidden">&nbsp;</div>'+"</tpl>"+"</div></div></tpl>",_TEMPLATE_SELECTED_DATA_LIST_RESTRICTED:'<tpl for="."><div class="actuate-datamart-item actuate-list-item">'+'<div class="actuate-icon-expand"></div>'+'<div class="actuate-icon-{icon}"></div>'+'<div class="actuate-data-entry actuate-data-entry-break" title="'+A._TOOLTIP_SELECTEDLIST_DIRECTORY+'{value}">'+A._SHORT_FILENAME_EXPRESSION+"</div>"+'<div style="float:right">'+'<div class="actuate-access-type" style="white-space:nowrap">{accessType}</div>'+'<tpl if="!dataSourceName">'+'<tpl if="icon != \'file-datadesign\'"><div class="actuate-access-type-arrow"></div></tpl>'+'<tpl if="icon == \'file-datadesign\'"><div class="actuate-access-type-arrow-disabled"></div></tpl>'+'<tpl if="parameter">'+'<a title="'+A._TOOLTIP_PARAMETER_BINDING+'"><div class="actuate-icon-parameter-list">&nbsp;</div></a>'+"</tpl>"+'<tpl if="!parameter">'+'<div class="actuate-icon-parameter-list-hidden">&nbsp;</div>'+"</tpl>"+"</tpl>"+'<tpl if="dataSourceName">'+'<div class="actuate-access-type-arrow-disabled"></div>'+'<tpl if="parameter">'+'<a title="'+A._TOOLTIP_PARAMETER_BINDING+'"><div class="actuate-icon-parameter-list-disabled">&nbsp;</div></a>'+"</tpl>"+'<tpl if="!parameter">'+'<div class="actuate-icon-parameter-list-hidden">&nbsp;</div>'+"</tpl>"+"</tpl>"+"</div></div></tpl>",_TEMPLATE_DETAILS_LIST:'<tpl for="."><div class="actuate-details-item actuate-list-item">'+'<div class="actuate-icon-{icon}"></div>'+'<div class="actuate-data-name actuate-data-{icon}" title="'+'{name}">{name}</div>'+"</div></tpl>"});actuate.dialog.impl.helper.datamanager.ManageDataDialog=A;})();