actuate.util.Package.define("actuate.dialog.impl.helper.selectorbuilder");actuate.dialog.impl.helper.selectorbuilder.SelectorBuilder=actuate.Class.extendClass(actuate.dialog.impl.helper.BaseBuilderDialog,{_classname:"actuate.dialog.SelectorDialog",_FORMAT_NAMES:["SELECTOR_SLIDER_FORMAT_TAB","SELECTOR_RADIO_FORMAT_TAB","SELECTOR_LIST_FORMAT_TAB","SELECTOR_DROPDOWN_FORMAT_TAB","SELECTOR_CHECKBOX_FORMAT_TAB","SELECTOR_CALENDAR_FORMAT_TAB"],_PANEL_NAMES:["selectorSliderFormatTab","selectorRadioFormatTab","selectorListFormatTab","selectorDropdownFormatTab","selectorCheckboxFormatTab","selectorCalendarFormatTab"],_DATA_TAB_NAMES:{data:"SELECTOR_DATA_TAB",dataset:"SELECTOR_DATA_TAB",cube:"SELECTOR_DATA_TAB",parameter:"SELECTOR_DATA_TAB",version:"SELECTOR_DATA_VERSION_TAB",multiSelection:"MULTI_SELECTOR_DATA_TAB"},_DATA_PANEL_NAMES:{data:"selectorDataTab",version:"selectorDataVersionTab"},_tabPanel:null,_defaultType:null,_parameterBased:false,_typePanel:null,_dataPanel:null,_formatPanel:null,_formatPanelName:null,_firstTime:true,_fieldConfig:null,_dataObjectType:null,initialize:function(D,I){this._fieldConfig=null;this._width=594;var C=this._getId(this._classname);this._applyHtmlElementsNames(C);var G=actuate.util.Utility;actuate.dialog.impl.helper.selectorbuilder.SelectorBuilder.superclass.initialize.call(this,C,G.getLocalizedString("selectorDialog.title"),[this._height,this._width],I);var A=this.getPanel("actuate_dialog_impl_helper_selectorbuilder_selectorTypeTab");if(A){for(var F=0;F<A._radios.length;F++){A._radios[F].registerEventHandler("check",actuate.Method.bind(this._typeChanged,this),false);}}var E=this.getPanel("actuate_dialog_impl_helper_selectorbuilder_multiSelectorTypeTab");if(E){for(var F=0;F<E._radios.length;F++){E._radios[F].registerEventHandler("check",actuate.Method.bind(this._typeChanged,this),false);}}this._formatChangedHandler_c=actuate.Method.bind(this._formatChangedHandler,this);for(var F=0;F<this._FORMAT_NAMES.length;F++){this.hidePanel(this._FORMAT_NAMES[F]).on("change",this._formatChangedHandler_c);}actuate.widget.tips.QuickTips.init();for(var H in this._DATA_TAB_NAMES){var B=this.hidePanel(this._DATA_TAB_NAMES[H]);if(B){B.on("databound",actuate.Method.bind(this._dataBound,this));B.on("fieldchanged",actuate.Method.bind(this._fieldChanged,this));}}},_dataBound:function(A){if(this._typePanel){this._typePanel.fireEvent("showdata",A);}if(this._formatPanel){this._formatPanel.fireEvent("showdata",A);}},_showDataPanel:function(B){for(var A in this._DATA_TAB_NAMES){this.hidePanel(this._DATA_TAB_NAMES[A]);}var C=this._DATA_TAB_NAMES[B];this._dataPanelName=C;if(this._dataPanelName){return this.showPanel(this._dataPanelName);}},_bind:function(A){this._fieldConfig=null;if(A&&A.DataMartVersions){if(this._dataPanel){this._dataPanel.fireEvent("versionsloaded",A.DataMartVersions);}}return true;},_localBind:function(E){if(this._consumer&&this._consumer._componentData&&this._consumer._componentData.category=="Parameter"){E.parameter=this._consumer._componentData;this._defaultType=E.parameter.controlType;this._parameterBased=true;}else{this._parameterBased=false;}if(E.defaultType&&!E.Base){this._defaultType=E.defaultType;E.defaultType=null;}else{if(E.Base&&E.Base.type&&(E.Base.type=="listGroup")){this._defaultType="multiselection_list";}else{if(E.Base&&E.Base.type&&(E.Base.type=="dropdownGroup")){this._defaultType="multiselection_dropdown";}else{this._defaultType=null;}}}this.hidePanel("MULTI_SELECTOR_TYPE_TAB");this.hidePanel("SELECTOR_TYPE_TAB");if(this._defaultType&&(this._defaultType=="multiselection_list"||this._defaultType=="multiselection_dropdown")){this._typePanel=this.getPanel("actuate_dialog_impl_helper_selectorbuilder_multiSelectorTypeTab");this._loadTypePanel(E,this._typePanel);this.showPanel("MULTI_SELECTOR_TYPE_TAB");}else{this._typePanel=this.getPanel("actuate_dialog_impl_helper_selectorbuilder_selectorTypeTab");this._loadTypePanel(E,this._typePanel);this.showPanel("SELECTOR_TYPE_TAB");}if(this._defaultType&&(this._defaultType=="multiselection_list"||this._defaultType=="multiselection_dropdown")){this.hidePanel(this._formatPanelName);this._formatPanelName="MULTI_SELECTOR_FORMAT_TAB";this._formatPanel=this.getPanel("actuate_dialog_impl_helper_selectorbuilder_multiSelectorFormatTab");this.showPanel(this._formatPanelName);}else{this.hidePanel("MULTI_SELECTOR_FORMAT_TAB");var D=this._getFormatPanel();if(D){this._formatPanel=D;}}var F=null;this._dataPanel=null;this._controlType=null;if(E){if(E.operationData&&E.operationData.componentData){this._dataObjectType=E.operationData.componentData.dataObjectType;this._isGroupSelector=E.operationData.componentData.isGroupSelector;if(this._defaultType=="multiselection_list"||this._defaultType=="multiselection_dropdown"){this._dataObjectType="multiSelection";}if(this._isGroupSelector&&this._isGroupSelector=="true"){this._dataObjectType="multiSelection";}this._dataPanel=this._showDataPanel(this._dataObjectType);if(!E.operationData.componentData.gadgetSpec){E.isNew=true;}}this._parameterBased=this._isParameterBasedSelector(E);if(this._dataPanel&&this._dataPanel.getPanel()){this.getTabPanel().setActiveTab(this._dataPanel.getPanel());}if(this._dataPanel){this._dataPanel.loadData(E);this._fixDropShadow();}if(this._parameterBased){var B=E&&(E.Base||E.parameter);F=B.controlType;this._controlType=F;}}if(this._formatPanel){if(E.parameter&&E.parameter.defaultValue){if(!E.format){E.format={};}E.format.defaultValue=E.parameter.defaultValue;}if(this._formatPanel.setParameterBased){this._formatPanel.setParameterBased(this._parameterBased);}if(this._formatPanel.setControlType){this._formatPanel.setControlType(F);}this._formatPanel.loadData(E);if(E&&E.Base&&E.Base.dataFormat){this._formatPanel.fireEvent("dataformat",E.Base.dataFormat);}if(this._dataPanel&&this._dataPanel.setMultiValues&&this._formatPanel.isMultiValues){this._dataPanel.setMultiValues(this._formatPanel.isMultiValues());}}var A=this.getPanel("actuate_dialog_impl_helper_genericPropsTab");if(A&&!A.hidden&&E){if(!E.gadget){E.gadget=E[actuate.model.Constant.MetadataType.ELEMENT].gadget;}this._genericPropsPanel=A;if(E.parameter){E.operationData.parameter=E.parameter;}A.loadData(E.operationData,E.Base&&E.Base.type);}if(this._dataPanel){this._dataPanel.fireEvent("databound",E);}var C=null;if(this._dataObjectType=="multiSelection"){C=this.getPanel("actuate_dialog_impl_helper_selectorbuilder_multiSelectorDataTab");}else{C=this.getPanel("actuate_dialog_impl_helper_selectorbuilder_selectorDataTab");}if(C&&E.Base&&!C.getType()){C.setType(E.Base.type,true);}},_loadTypePanel:function(B,A){if((!B.Base||!B.Base.type)&&this._defaultType){if(!B.Base){B.Base={};}B.Base.type=this._defaultType;}if(!A){return ;}if(A){A.loadData(B);}},_getFormatPanel:function(C){var B=this._PANEL_NAMES;var A=this._FORMAT_NAMES;var C=this._typePanel.getSelectedIndex();var E=null;if(C==null){C=2;}if(C>=0){E=B[C];}var D;if(this._formatPanelName!=A[C]){this.hidePanel(this._formatPanelName);}if(E){this.showPanel(A[C]);this._formatPanelName=A[C];E="actuate_dialog_impl_helper_selectorbuilder_"+E;return this.getPanel(E);}},_afterHide:function(){if(this._filterPanel&&this._filterPanel._afterHide){this._filterPanel._afterHide();}if(this._genericPropsPanel&&this._genericPropsPanel._afterHide){this._genericPropsPanel._afterHide();}},_preHide:function(){if(this._dataPanel&&this._dataPanel._preHide){this._dataPanel._preHide();}if(this._typePanel&&this._typePanel._preHide){this._typePanel._preHide();}if(this._formatPanel&&this._formatPanel._preHide){this._formatPanel._preHide();}},_createBaseSoapNode:function(B){var A=actuate.util.XmlDom.createElement(B,actuate.Constant.tag.Json);B.documentElement.appendChild(A);return A;},_typeChanged:function(){if(!this._typePanel){return ;}var E=this._typePanel.getSelectedIndex();var H=this._typePanel.getOldSelectedIndex();if(E==H){return ;}if(!this._defaultType||this._defaultType!="multiselection_list"&&this._defaultType!="multiselection_dropdown"){if(E>=0){var C=this._FORMAT_NAMES;var B=C[E];var G=C[H];if(G){this.hidePanel(G);}if(B){this.showPanel(B);}this._typePanel._oldSelectedIndex=E;this._formatPanelName=B;}}if(this._dataPanel&&this._dataPanel.setType&&this._defaultType!="multiselection_list"&&this._defaultType!="multiselection_dropdown"){this._dataPanel.setType(this._typePanel.getType(),true);}var A=this._PANEL_NAMES;var F=this.getPanel("actuate_dialog_impl_helper_selectorbuilder_"+A[E]);if(this._defaultType=="multiselection_list"||this._defaultType=="multiselection_dropdown"){F=this.getPanel("actuate_dialog_impl_helper_selectorbuilder_multiSelectorFormatTab");}this._formatPanel=F;if(F){if(F.setParameterBased){F.setParameterBased(this._parameterBased);}if(F.setControlType){F.setControlType(this._controlType);}if(F.setType){F.setType(this._typePanel.getType(),true);}var D=this._fieldConfig||{};D.dataObjectType=this._dataObjectType;F.fireEvent("fieldchanged",D);if(this._dataPanel&&this._dataPanel.setMultiValues&&F.isMultiValues){this._dataPanel.setMultiValues(F.isMultiValues());}}},__generateUniqueGadgetTitle:function(B){if(B&&B.type=="version"){var C="editgadgetprops.panel.general.gadgetName.";var A=actuate.util.Utility;return A.getLocalizedString(C+"version",B.dataSourceName||"");}return actuate.dialog.impl.helper.selectorbuilder.SelectorBuilder.superclass.__generateUniqueGadgetTitle.apply(this,arguments);},__generateGadgetTitle:function(D){switch(D.type){case"version":case"reportParameter":case"datamartParameter":this._filterPanel.getPanel().setDisabled(true);break;case"dataset":case"cube":case"":this._filterPanel.getPanel().setDisabled(false);}var E="editgadgetprops.panel.general.gadgetName.";var A=actuate.util.Utility;var G=A.getLocalizedString(E+"selector");switch(D.type){case"version":G=A.getLocalizedString(E+"version",D.dataSourceName||"");break;case"dataset":G=A.getLocalizedString(E+"dataSet",D.columnDisplayName==null?(D.columnName==null?"":D.columnName):D.columnDisplayName);break;case"cube":if(D.levelName){var F=D.levelName.split("/");G=A.getLocalizedString(E+"cube",F[0],F[1]);}break;case"reportParameter":G=A.getLocalizedString(E+"reportParameter",D.parameterName,D.reportName);break;case"datamartParameter":var C=A.stripFileExtension(D.datamartName);C=A.stripPath(C);G=A.getLocalizedString(E+"datamartParameter",D.parameterName,C);break;case"":G=A.getLocalizedString(E+"noBinding");break;}if(G){var B=G.split("/");if(B&&B.length>0){G=B[B.length-1];}}return G;},_isParameterBasedSelector:function(A){if(A&&A.parameter){return true;}if(A&&A.Base&&A.Base.parameterName){return true;}return false;},_formatChangedHandler:function(A){if(A.isMultiValues&&this._dataPanel&&this._dataPanel.setMultiValues){this._dataPanel.setMultiValues(A.isMultiValues());}},_dataChanged:function(A){actuate.dialog.impl.helper.selectorbuilder.SelectorBuilder.superclass._dataChanged.call(this,A);if(this._formatPanel&&this._formatPanel.setDataType){this._formatPanel.setDataType(A.dataType);}},_fieldChanged:function(A){this._fieldConfig=A;if(this._formatPanel){this._formatPanel.fireEvent("fieldchanged",A);}if(this._typePanel){this._typePanel.fireEvent("fieldchanged",A);}},__getDataPanel:function(){return this._dataPanel;},__getGadgetTypeName:function(){return"Selector";},__getHelpTopic:function(){return"EditDataSelectorGadget";},establishTabs:function(J){var G=actuate.util.Utility;var I=actuate.util.Package;var A=actuate.util.Constants.MODULE_NAME_DIALOG;if(this._panels==null){this._panels=new Object();}if(J.children){this._hidePanels();for(var E=0;E<J.children.length;E++){var D=actuate.resource.module.feature.features[A][J.children[E]]._classInstance;if(D){for(var F=0;F<D.length;F++){var H=actuate.util.Package.getInstanceName(D[F]).replace(/\./g,"_");if(!this._panels[H]){var C=I.getNamespaceObjectReference(D[F]);var B=new C(null,true);if(B.getPanel){this._tabPanel.add(B.getPanel(),false);this._panels[H]=B;B.setParent(this);}}if(H&&this._panels[H]&&(H.indexOf("Format")<0||this._panels[H]==this._formatPanel)){this._tabPanel.unhideTabStripItem(this._panels[H].getPanel());this._panels[H].hidden=false;}}}}}}});